
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/DTD/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>BigWorld Technology Server Release Notes</title><link rel="stylesheet" href="generated_html/css/bigworld.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><script type="text/javascript" src="bigworld.js"></script></head><body onLoad="loader();"><div id="bigworld-header"><img src="bigworld_logo.gif" id="bwLogo" alt="bw logo"></div><div id="content"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="Server_Release_Notes"></a>BigWorld Technology Server Release Notes</h1></div><div><p class="releaseinfo">BigWorld Technology 1.9.1. Released 2008.</p></div><div><p class="copyright">Copyright &copy; 1999-2008 BigWorld Pty Ltd. All rights reserved. </p></div><div><div class="legalnotice"><a name="d0e17"></a><p>This document is proprietary commercial in confidence and access
  is restricted to authorised users. This document is protected by
  copyright laws of Australia, other countries and international treaties.
  Unauthorised use, reproduction or distribution of this document, or any
  portion of this document, may result in the imposition of civil and
  criminal penalties as provided by law.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="article"><a href="#d0e20">BigWorld Technology 1.9.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e798">BigWorld Technology 1.9.0.5 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e811">BigWorld Technology 1.9.0.4 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e844">BigWorld Technology 1.9.0.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e862">BigWorld Technology 1.9.0.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e867">BigWorld Technology 1.9.0.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e903">BigWorld Technology 1.9 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1785">BigWorld Technology 1.8.6.7 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1795">BigWorld Technology 1.8.6.6 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1873">BigWorld Technology 1.8.6.5 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1890">BigWorld Technology 1.8.6.4 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1903">BigWorld Technology 1.8.6.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1943">BigWorld Technology 1.8.6.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1956">BigWorld Technology 1.8.6.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e1995">BigWorld Technology 1.8.6 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2186">BigWorld Technology 1.8.5 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2441">BigWorld Technology 1.8.4.5 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2471">BigWorld Technology 1.8.4.4 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2525">BigWorld Technology 1.8.4.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2538">BigWorld Technology 1.8.4.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2551">BigWorld Technology 1.8.4.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2586">BigWorld Technology 1.8.4 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2818">BigWorld Technology 1.8.3.5 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2834">BigWorld Technology 1.8.3.4 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2844">BigWorld Technology 1.8.3.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2860">BigWorld Technology 1.8.3.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2956">BigWorld Technology 1.8.3.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e2998">BigWorld Technology 1.8.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e3214">BigWorld Technology 1.8.2.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e3230">BigWorld Technology 1.8.2.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e3314">BigWorld Technology 1.8.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e3903">BigWorld Technology 1.8.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e4128">BigWorld Technology 1.8 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e5040">BigWorld Technology 1.7.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e5351">BigWorld Technology 1.7.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e6279">BigWorld Technology 1.7 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e7337">BigWorld Technology 1.6.4 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e7452">BigWorld Technology 1.6.3 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e7540">BigWorld Technology 1.6.2 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e7553">BigWorld Technology 1.6.1 Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e7732">BigWorld Technology 1.6 -- Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e8225">BigWorld Technology 1.5.1 -- Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e8271">BigWorld Technology 1.5 -- Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e8597">BigWorld Technology 1.4.2 -- Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e8816">BigWorld Technology 1.4.1 -- Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e8876">BigWorld Technology 1.4 -- Server Release Notes</a></span></dt><dt><span class="article"><a href="#d0e9094">BigWorld Technology 1.3 -- Server Release Notes</a></span></dt></dl></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e20"></a>BigWorld Technology 1.9.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e23"></a>1.&nbsp;Overview</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>BigWorld Technology 1.9.1 is the latest version of the BigWorld
        Technology engine. This version should allow customers to develop and
        release their games and is considered a feature complete, fully tested
        version for the BigWorld 1.9 series.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e30"></a>2.&nbsp;Executive Summary</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The load on the DBMgr and primary MySQL database can now be
        significantly reduced. This is done via the use of intermediate,
        SQLite databases that are local to BaseApps to store entity archive
        data.</p><p>For further information please review the <em class="emphasis">Server Programming Guide</em>.</p></li><li><p>A new <em class="emphasis">Release Planning</em> document
        has been introduced. This document details the steps required to
        successfully release a game using the BigWorld Technology engine. It
        is recommended to review this document during the game development
        stages to ensure a successful game release.</p></li><li><p>The server has been ported to the x86-64 platform allowing
        server components to access much more memory and advanced performance
        and security features of all recent Intel and AMD processors.</p><p>In this release we do not recommend or support full scale
        commercial deployment using this platform, but do encourage and support
        development, testing and trial deployments. We anticipate it to be
        sufficiently tested by 1.9.2.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e53"></a>3.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Secondary databases can be enabled to provide better scalability
        for large systems where the MySQL database is the bottleneck.</p><p>For details, see the document <em class="emphasis">Server
        Programming Guide</em>'s section <em class="emphasis"> The
        Database Layer -&gt; Secondary Databases</em>.</p></li><li><p>Servers will log a stack trace when hitting a critical assertion
        for easier bug reports.</p></li><li><p>Added support for user-dependent bw.xml file to allow easier
        support for multiple users running from the same resource tree.</p><p>If a file with the name
        <code class="filename">bw_&lt;username&gt;.xml</code> exists, this is now used
        as the start of the server configuration chain instead of
        <code class="filename">bw.xml</code>.</p></li><li><p>A new profiling command, called
        <span class="literal">mercuryprofile</span>, has been added to the
        ControlCluster command line tool for profiling Mercury interface
        statistics. For each process specified, a report is generated with
        statistics based on the number and size of messages received by that
        process.</p></li><li><p>Added LoginApp login rate statistics to StatGrapher:</p><div class="itemizedlist"><ul type="circle"><li><p>Total Logins Per Second</p></li><li><p>Rate-limited Logins Per Second</p></li><li><p>Successful Logins Per Second</p></li><li><p>Failed Logins Per Second</p></li></ul></div><p>These statistics are 5-second exponentially weighted averages,
        sampled each second.</p></li><li><p>New server configuration options have been added to limit how
        many overflowed packets are allowed per channel type.</p><pre class="programlisting">
&lt;maxChannelOverflow&gt;
	&lt;external&gt; 1024 &lt;/external&gt;
	&lt;internal&gt; 8192 &lt;/internal&gt;
	&lt;indexed&gt;  4096 &lt;/indexed&gt;
	&lt;isAssert&gt; false &lt;/isAssert&gt;
&lt;/maxChannelOverflow&gt;
</pre></li><li><p>Added a new timer option called <span class="literal">gettime</span> which
        uses the high-resolution monotonic timer in the Linux kernel for
        better stability in environments where NTP is used.</p></li><li><p>Added a new configuration setting in
        <code class="filename">/etc/bwmachined.conf</code> called
        <code class="code">InternalInterface</code>. This option disables auto-discovery of
        the internal network interface by allowing the internal network
        interface to be specified. For more details, refer to the Server
        Installation Guide &#8594; <code class="filename">/etc/bwmachined.conf</code> and
        InternalInterface.</p></li><li><p>All server components can now be compiled as native 64 bit
         binaries to support &gt;4GB of memory per process, longer registers,
         faster integer maths, NX support etc.</p><p>This feature is not yet officially support. If you are interested
        in using pre-release, native 64-bit binaries, please contact
        support@bigworldtech.com.</p></li><li><p>Added a mechanism to help detect issues with ghost entities.</p><p>The option <code class="code">cellApp/enforceGhostDecorators</code> has been
        added to <code class="filename">bw.xml</code>. If enabled, a cell entity method
        that is not in the <code class="filename">.def</code> file can only be called on
        a potential ghost entity if it has the
        <code class="code">@bwdecorators.callableOnGhost</code> decorator.</p><p>This is disabled by default so that functionality does not change.
        It is recommended that you enable this and
        <code class="code">cellApp/treatAllOtherEntitiesAsGhosts</code> during debugging.
        </p></li><li><p>Added a new function named findRandomNeighbourPoint to find a
        nearby random point around a given point. The result point is guaranteed
         to be connectable to the given point.</p></li><li><p>Added <code class="code">BigWorld.registerFileDescriptor</code> and related
        methods to script on BaseApps and CellApps. These allow Python sockets
        and files to be added to the nub's select loop so that they can be
        processed in a non-blocking way. A callback will be called when there
        is something of interest on the file descriptor.</p></li><li><p>Added RPM implementation to allow the creation of BWMachined 
		RPM packages.  RPM implementation can be found in 
		<code class="code">bigworld/tools/server/rpm</code> directory.  For more 
		information on BWMachined installation using a RPM package, including 
		the location of the BWMachined RPM package, please see Server 
		Installation Guide.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e195"></a>4.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The Python navigation interface has been changed. A new, optional
        parameter <code class="code">maxDistance</code> has been added to a number of
        methods. This limits the search range to the specified distance to help
        avoid CellApp CPU spikes.</p><p><em class="emphasis">Important note:</em> All existing
        code calling these functions <em class="emphasis">must</em> be
        reviewed and modified accordingly to reflect the interface
        change.</p></li><li><p>Added configuration options
        <span class="literal">&lt;baseApp/shouldResolveMailBoxes&gt;</span> and
        <span class="literal">&lt;cellApp/shouldResolveMailBoxes&gt;</span> to
        <code class="filename">bw.xml</code>. These options are defaulted to
        false.</p><p>Previously, if a mailbox could be resolved to a local entity,
        the mailbox was immediately replaced with a reference to that entity.
        This lead to error-prone code as mailbox arguments were used
        incorrectly to access entity properties directly. This often occurred
        during development when running in an environment with a single
        BaseApp or CellApp.</p></li><li><p>New default server configuration files have been added. These
        files replace
        <code class="filename">bigworld/res/server/defaults.xml</code>.</p><p>You should update your <span class="literal">parentFile</span> entry in
        <code class="filename">bw.xml</code> to use
        <code class="filename">server/development_defaults.xml</code> during
        development and <code class="filename">server/production_defaults.xml</code>
        during production.</p><p>A new top level configuration option
        <span class="literal">&lt;production&gt;</span> has also been added which forces
        server processes to emit an <span class="literal">ERROR</span> message when bad
        production mode settings are encountered.</p></li><li><p>Certain warnings and debug messages relating to network
        reliability have been removed since they created excessive log
        messages and did not have any diagnostic merit.</p></li><li><p>Supporting better aggregation of messages sent on <em class="emphasis">
        irregular* </em> channels.</p><p>When making script calls on a BaseMailBox, for example,
        previously a network packet was created for each call. The sending of
        these messages have now been delayed slightly so that multiple
        messages to over the same channel can be aggregated.</p><p><em class="emphasis"> *An irregular channel is a channel that does not have
        a regular send interval. </em></p></li><li><p>CellApp's <code class="code"> Entity.findCover </code> function has been
        deprecated, since it relies in the deprecated reannotation
        information, previously generated by NavGen.</p></li><li><p>A cell mailbox is now available when the cell entity's creation
        is pending.</p></li><li><p>Primitive BigWorld data types as defined in
        <code class="filename">cstdmf/stdmf.hpp</code> such as
        <span class="type">int8</span>/<span class="type">uint16</span>/<span class="type">int32</span>/<span class="type">uint32</span>,
        have been modified to be fixed size types as opposed to 32 bit
        platform equivalents.</p></li><li><p>BigWorld message macros (<em class="emphasis">i.e.</em>
        <span class="literal">ERROR_MSG</span> ...) have enabled GCC's static argument
        checking.</p></li><li><p>Entities on the servers now expose an attribute "className" for
        consistency with ServerEntityMailbox.</p></li><li><p>Changed the behaviour of the callback when an error occurs when
        script calls any of the functions:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="methodname">BigWorld.createBaseRemotely()</code></p></li><li><p><code class="methodname">BigWorld.createBaseAnywhere()</code></p></li><li><p><code class="methodname">BigWorld.createBaseFromDB()</code></p></li><li><p><code class="methodname">BigWorld.createBaseFromDBID()</code></p></li><li><p><code class="methodname">BigWorld.createBaseAnywhereFromDB()</code></p></li><li><p><code class="methodname">BigWorld.createBaseAnywhereFromDBID()</code></p></li></ul></div><p>Previously in 1.9.0, if there was a problem while resolving the
        mailbox that was used to pass into the entity parameter of the
        callbacks registered with these functions, it would pass
        <span class="literal">None</span> for the entity parameter and fail silently.
        Error log output is now emitted in this case, and an invalid mailbox
        is passed through.</p></li><li><p>Space data is no longer archived by default in BigWorld servers.
        This feature appeared to not be used by most of our customers and
        disabling improves DBMgr performance.</p><p>To re-enable this feature use the
        <span class="literal">&lt;cellAppMgr/archivePeriod&gt;</span> option in
        <code class="filename">bw.xml</code>.</p></li><li><p>Setting Identifier properties (that is, defined entity
        properties that have <span class="literal">&lt;Identifier&gt; true
        &lt;/Identifier&gt;</span> ) for <span class="literal">BASE</span> properties
        for entities that have already been saved to the database (these
        entities have non-zero database IDs) will result in a Python
        <code class="classname">ValueError</code> exception being raised.</p><p>This is to prevent the situation where an entity that has been
        saved to the database with one identifier then changes that identifier
        to a new string. On this entity's next attempt to save itself to the
        database, the new value for the identifier property may break the
        uniqueness constraint on the identifier property if the same value for
        the identifier property exists for another entity in the
        database.</p><p>See also the associated entry in Known Issues regarding
        identifier properties.</p></li><li><p>Instances of the <span class="literal">baseApp/externalPorts</span>
        <code class="filename">bw.xml</code> option that appear in different
        <span class="literal">baseApp</span> sections (within the same file and across
        configuration files in the <span class="literal">ParentFile</span> chain) are
        now respected. Previously, only the <span class="literal">baseApp</span> section
        that appeared first had its <span class="literal">externalPort</span> elements
        respected.</p></li><li><p>Destroying the default space from Python is no longer
        allowed.</p></li><li><p>Allow a corresponding cell entity to be destroyed from the BaseApp
          as soon as it is requested.
        </p></li><li><p>The third party flashticle package used by the StatGrapher has
        been replaced by the PyAMF package.  </p></li><li><p>The virtual function
          <code class="code">handleTimeout( Mercury::TimerID id, void * arg )</code>
          now cannot be overloaded using an <code class="code">int</code> as its
          <code class="code">id</code> parameter.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e437"></a>5.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a potential CellApp crash caused by using a deleted
        Channel.</p><p>This could occur if a message in a packet on an entity's channel
        caused that entity to teleport. If there were further buffered packets
        on this channel, these would be processed after the channel was
        gone.</p></li><li><p>Fixed DBMgr compilation errors when <code class="code">
        USE_MYSQL_PREPARED_STATEMENTS=0 </code> in the make file.</p></li><li><p>The file specified by <code class="code"> resources.xml/system/terrain2
        </code> (by default, <code class="code"> system/data/terrain2.xml </code> ) is now
        loaded at startup, and no longer needs to be loaded and referenced in
        your cell's personality script to prevent disk access in the main
        thread</p></li><li><p>The file specified by <span class="literal">
        resources.xml/environment/materialKinds </span> (by default,
        <span class="literal"> system/data/material_kinds.xml </span> ) is now loaded at
        startup, and no longer needs to be loaded and referenced in your
        cell's personality script to prevent disk access in the main
        thread</p></li><li><p>Corrected spurious warning message when spaces are
        destroyed.</p></li><li><p>Improved navigation support when inside shells.</p></li><li><p>Fixed an issue where an uncontrolled BaseApp process death could
        cause corruption of the global bases registry.</p></li><li><p>The web integration module sources are now included, so now the
        server Makefile will not fail because of the missing
        subdirectory.</p></li><li><p>Fixed an issue with Base reference counting. If a Base is
        created and the Base Python script calls
        <code class="varname">self</code>.<code class="methodname">destroy</code>() in
        <code class="methodname">__init__</code>(), this can cause the Base object to
        be destructed prematurely which can cause dangling Python
        references.</p></li><li><p>Fixed an issue with the ControlCluster command line tool missing
        the <span class="literal">eventprofile</span> command.</p></li><li><p>Fixed an issue with BigWorld module being un-imported on script
        reload via <code class="methodname">BigWorld.reloadScript()</code>.</p></li><li><p>Fixed an issue with the cell counterparts to base entities that
        have not been successfully restored after a crash sending garbage to
        the baseapp it thinks it has been restored to.</p></li><li><p>Fixed shutting down the server when
        <code class="code">shutDownServerOnBadState</code> is <code class="code">true</code>.
        Previously, the server would not shut down cleanly if the last CellApp
        died.</p></li><li><p>The StatGrapher legend has been modified so that only values
        greater than or equal to one million are displayed in scientific
        notation. Previously the rollover was 1000.</p></li><li><p>Fixed a bug where an incoming bundle could time out and never be
        received even though it is on a channel.</p></li><li><p>Fixed the library scripts in
        <code class="code">bigworld/res/entities/common/Lib</code> which were of a previous
        version to the Python interpreter used in server apps.</p></li><li><p>Added <code class="code">BigWorld.getMaterialKinds</code> method to CellApp's
        Python API. This was previously only available on the client.</p></li><li><p>
		  Fixed the library scripts in
		  <code class="code">bigworld/res/entities/common/Lib</code> which were of a
		  previous version to the Python interpreter used in server apps.</p></li><li><p>
		  Fixed a bug where two seperate logins from the same client would
		  be mistaken for resending the request after the reply had been
		  dropped.</p></li><li><p>Fixed a bug where enabling <code class="code">baseApp/packetLog</code> would
		  cause the  BaseApp to immediately segfault when a client connected.
		</p></li><li><p>Fixed a bug where overflow packets are not cleared when the
		  channel is reset.
		</p></li><li><p>User data object circular references are now broken up when
      	chunks containing one or more of these user data objects are unloaded.
		</p></li><li><p>Bots will not needlessly time out when packet loss occurs.
		</p></li><li><p>The displaying of Python backtraces will become asynchronous if
		reading in the source file would cause the main thread to block.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e599"></a>6.&nbsp;Known Bugs &amp; Limitations</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Due to adding support to the <code class="code"><em class="replaceable"><code>*</code></em>_MSG</code>
        message macros for the <span class="literal">%z</span> format string modifier, log messages
        generated from 1.9.1 client / server processes using <span class="literal">%z</span> will
        be incorrectly saved by 1.9.0 or earlier instances of MessageLogger.</p><p>The recommended solution for this issue is to remove the old log directory
        when installing the 1.9.1 server tools and allow a completely fresh set of logs
        to be written.</p><p>For example:</p><pre class="programlisting">$ rm -rf /var/log/bigworld/message_logger</pre></li><li><p><em class="emphasis">Fedora 9</em></p><div class="itemizedlist"><ul type="circle"><li><p>Python hashlib does not function correctly in Bots process
            or BaseApp due to an incompatibility between versions of
            openssl.</p></li></ul></div></li><li><p><em class="emphasis">Secondary Databases</em></p><div class="itemizedlist"><ul type="circle"><li><p>When secondary databases are enabled and the final
            <code class="code">writeToDB</code> operation is disabled by passing
            <code class="code">False</code> in the <code class="code">writeToDB</code> parameter of the
            <code class="code">Base.destroy</code> function, all <code class="code">writeToDB</code>
            operations on the entity since the entity was loaded from the
            database may be disregarded. For example: </p><div class="orderedlist"><ol type="1"><li><p>Entity A is loaded from the database</p></li><li><p>Entity A's properties are changed.</p></li><li><p>Entity A is written to the database by calling the
                  <code class="code">Base.writeToDB</code> method.</p></li><li><p>Entity A is destroyed by calling the
                  <code class="code">Base.destroy</code> method but <code class="code">False</code> is
                  passed in the <code class="code">writeToDB</code> parameter.</p></li></ol></div><p> The <code class="code">writeToDB</code> operation in step 3,
            may be disregarded and the changes to entity A's properties in
            step 2 will be lost.</p><p>There is no guarantee that the changes will be lost so this
            cannot be used as a rollback facility. If the system is shutdown
            soon after the entity is destroyed (with <code class="code">writeToDB =
            False</code>), then the changes to the entity may be
            retained.</p><p>The correct behaviour should be to retain all the changes
            that were supposedly written to the database using the
            <code class="code">Base.writeToDB</code> method. BigWorld will conform to this
            behaviour in a future release. In the meantime, passing
            <code class="code">False</code> in the <code class="code">writeToDB</code> parameter to the
            <code class="code">Base.destroy</code> method should be avoided due to its
            unpredictable behaviour.</p></li></ul></div></li><li><p>This is associated with the Changed Feature regarding Identifier
        properties.</p><p>In 1.9.1, we do not catch instances of setting identifier
        properties that exist on the cell entity (e.g.
        <span class="literal">ALL_CLIENTS</span> properties), as we do for identifier
        properties on the base entity. In addition, modifications to a cell
        entity identifier property in the <code class="varname">Base.cellData</code>
        base property (which exists if the cell entity has not been created)
        are also not checked.</p><p>If an entity has been previously saved to the database
        successfully, and the identifier property on the cell entity (or the
        identifier property's entry in the <code class="varname">cellData</code>
        dictionary) subsequently changes, the next attempt to save to the
        database could fail due to the uniqueness constraint on that
        identifier property being broken in the event that another entity is
        keyed to the new value of the identifier property being set.</p></li><li><p>The file specified by <code class="code"> resources.xml/system/terrain2
        </code> (by default, <code class="code"> system/data/terrain2.xml </code> ) is
        loaded each time that terrain is loaded. This can cause disk access in
        the main thread.</p><p>To avoid this, load and store a reference to this file's data
        section in your cell's personality script. See <code class="code">
        fantasydemo/res/scripts/cell/FantasyDemo.py </code> for an
        example.</p></li><li><p>The file specified by <code class="code">
        resources.xml/environment/materialKinds </code> (by default, <code class="code">
        system/data/material_kinds.xml </code> ) is loaded the first time a
        collision test occurs that involves terrain. This can cause disk
        access in the main thread.</p><p>To avoid this, load and store a reference to this file's data
        section in your cell's personality script. See <code class="code">
        fantasydemo/res/scripts/cell/FantasyDemo.py </code> for an
        example.</p></li><li><p>The <code class="code"> UserDataObjectRef </code> module is loaded the first
        time that it is needed. This can cause disk access in the main
        thread.</p><p>To avoid this, import this module into your personality scripts.
        See <code class="code"> fantasydemo/res/scripts/cell/FantasyDemo.py </code> and
        <code class="code"> fantasydemo/res/scripts/base/FantasyDemo.py </code> for
        examples.</p></li><li><p><code class="code"> FIXED_DICT </code> properties that have an <code class="code">
        &lt;implementedBy&gt; </code> can cause a module to be imported the
        first time that the type is created. This can cause disk access in the
        main thread.</p><p>To avoid this, import the necessary modules in the script file
        of the relevant entities or the personality scritps.</p></li><li><p>Currently, MySQL stored procedures are not supported when used
        with the <code class="code"> BigWorld.executeRawDatabaseCommand </code>
        method.</p><p>For details on this method, see the document <em class="emphasis"> Server Programming Guide </em> 's section <em class="emphasis"> The Database Layer -&gt; Execute Arbitrary Commands On
        Database </em> .</p></li><li><p>Due to the Watcher protocol changing as of 1.9.0, the server
        tools (WebConsole, StatLogger, ControlCluster, ...) are not backwards
        compatible. If your operational environment is still running 1.8.x
        servers it is recommended to maintain the existing server tools as
        forward compatibility has been maintained.</p></li><li><p>Customers using Debian Etch will experience issues with
        WebConsole and StatLogger failing overnight due to a MySQL
        reconnection issue. The cause of this issue is due to MySQL timing out
        inactive connections after 8 hours. Currently the default package
        versions of MySQL-python and SQLObject provided by Debian Etch do not
        include a known fix for this issue. The suggested work around for this
        problem is to restart WebConsole every morning prior to the majority
        of developers starting work. This can be achieved by added a cron job
        to the root user of the machine running WebConsole as follows:</p><pre class="programlisting">
          # 06:30 Mon-Fri: Restart WebConsole to avoid MySQL reconnection issues
30 6 * * 1-5 /etc/init.d/bw_web_console restart
        </pre></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e798"></a>BigWorld Technology 1.9.0.5 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e801"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Extended the buffer size used when reading <code class="code"> /proc/cpuinfo
        </code> in bwmachined. The short buffer size was causing a crash when
        the processor flags line exceeded 256 characters (as seen on Opteron
        machines).</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e811"></a>BigWorld Technology 1.9.0.4 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e814"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a bug where any base entity with the <code class="code"> cellData
        </code> member (i.e. its cell entity has not yet been created or has
        already been destroyed) cannot be restored if the BaseApp that it is
        on crashes.</p></li><li><p>Fixed a bug where if the configuration setting <code class="code">
        &lt;baseApp&gt;/&lt;backUpUndefinedProperties&gt; </code> is set to
        false, entities cannot be backed up successfully.</p><p>Initially added in BigWorld 1.8.6.1.</p></li><li><p>Fixed an issue with Base reference counting. If a Base is
        created and the Base Python script calls <code class="code"> self.destroy() </code>
        in <code class="code"> __init__() </code> , this can cause the Base obejct to be
        destructed prematurely which can cause dangling Python
        references.</p></li><li><p>Fixed a bug that could cause a CellApp assertion to be hit if a
        BaseApp dies.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e844"></a>BigWorld Technology 1.9.0.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e847"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The web integration module sources are now included, The server
        Makefile will no longer fail due to these sources being missing (fixed
        since 1.9.0.1).</p></li><li><p>Fixed possible loss of ARRAY property data when two <code class="code">
        BigWorld.writeToDB </code> operations for the same entity are
        performed concurrently in different threads in the DBMgr.</p><p>Initially added in BigWorld 1.8.6.1.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e862"></a>BigWorld Technology 1.9.0.2 Server Release Notes</h2></div></div><hr></div><p>No changes were done to the server for 1.9.0.2.</p></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e867"></a>BigWorld Technology 1.9.0.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e870"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>If multiple entities teleported between the same spaces, at the
        same time, it was possible for property changes that occurred just
        before teleporting, not to be propagated. This has now been
        fixed.</p><p>Initially added in BigWorld 1.8.4.3.</p></li><li><p>Fixed a potential crash due channel being accessed after being
        deleted.</p><p>Initially added in BigWorld 1.8.4.2.</p></li><li><p>Fixed a memory leak associated with unacked packets.</p><p>Initially added in BigWorld 1.8.4.2.</p></li><li><p>Fixed a memory leak in the bots where calling <code class="code"> Bot.moveTo(
        position ) </code> was never releasing the memory associated with the
        previous movement destination.</p><p>Initially added in BigWorld 1.8.4.2.</p></li><li><p>Fixed a problem where two clients could log in with the same
        account details at the same time. If <code class="code"> Proxy.onLogOnAttempt
        </code> allowed the second login, an assertion on the BaseApp could be
        triggered if both logins succeeded.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e903"></a>BigWorld Technology 1.9 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e906"></a>1.&nbsp;Important Notes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Please refer to <em class="emphasis"> How To Convert to
        BigWorld 1.9 </em> for more detailed information on migrating
        from BigWorld 1.8 to 1.9.</p></li><li><p>MySQL databases created by BigWorld 1.8.x must be upgraded to
        work correctly with BigWorld 1.9. Before starting the new server,
        backup your database and run:</p><pre class="programlisting">
          dbmgr -upgrade
        </pre><p>Please note that this operation only works if the tables in the
        database currently matches the entity definition. Do not attempt to
        upgrade the database and change the entity definition at the same
        time.</p><p>In BigWorld 1.9, entity property columns have the "NOT NULL"
        specification. As part of the upgrade process, existing NULL values
        will be set to the default value of the property</p></li><li><p>The <code class="code"> seeingHeight </code> argument of the cell entity
        methods <code class="code"> addVision </code> and <code class="code"> addScanVision </code> has
        changed. See the details in the <em class="emphasis"> Changed Features
        </em> section.</p></li><li><p>The BigWorld Technology suite now does some simple XML
        validation.</p><p>Previously, badly formed XML was allowed, but this resulted in
        third-party applications being unable to parse XML resources.</p><p>The main source of these problems is spaces in tag names and tag
        names beginning with numbers, which mostly occurs in three
        places:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> .graph </code> files, which have tags based upon a
            UID, and frequently begin with numbers.</p></li><li><p>Particle systems, which could have spaces in the
            sub-particle system names.</p></li><li><p>Node names in model files, which quite often have spaces in
            certain tags.</p></li></ul></div><p>In version 1.9, the use of such tags result in a warning being
        issued. Future versions of BigWorld Technology will make this an
        error.</p><p>To fix these warnings, you can either manually edit the XML, or
        you can run AssetProcessor, which finds the locations of these errors
        (and in the cases of particle systems, models and graph files, fix
        them for you).</p><p>Badly formed tags should be fixed as follows: </p><div class="itemizedlist"><ul type="circle"><li><p>Spaces in tags should be replaced with <code class="code"> '..' </code>
              .</p><p>For example, <code class="code"> &lt;my tag&gt; </code> should be
              replaced with <code class="code"> &lt;my..tag&gt; </code> .</p><p>Internally what the tag refers to still retains the
              spaces, so for example, in Python or C++, a sub-particle
              system's name is referred to in exactly the same way as
              before.</p></li><li><p>UID tags in <code class="code"> .graph </code> files should be prefixed
              with <code class="code"> 'id.' </code> .</p><p>For example, <code class="code">
              &lt;0897F6FD.4B03ADAD.0F9401B6.C483C775&gt; </code> should be
              replaced with <code class="code">
              &lt;id.0897F6FD.4B03ADAD.0F9401B6.C483C775&gt; </code> .</p></li></ul></div></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e999"></a>2.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added the BigWorld Web Integration Module. This module allows
        web servers to make method calls to entities on a running BigWorld
        server, and allows for the creation of web interfaces into your game,
        which can be accessible via PC browsers, mobile phones and other
        mobile devices. There are two flavours currently supported: Python and
        PHP.</p><p>For details, see the document <em class="emphasis"> Web
        Integration Reference </em> and <em class="emphasis"> How to
        Implement Web Integration </em> .</p></li><li><p>Added the <code class="code"> FLOAT64 </code> data type, that corresponds to
        a IEEE 64-bit floating-point number.</p><p>For details, see the document <em class="emphasis"> Server
        Programming Guide </em> 's sections <em class="emphasis">
        Properties -&gt; Property Types -&gt; Primitive Types </em> and
        <em class="emphasis"> The Database Layer -&gt; Mapping BigWorld
        Properties Into SQL -&gt; Simple Data Types </em> .</p></li><li><p>Added context support to <code class="code"> mlcat.py </code> and the
        WebConsole's LogViewer module.</p><p>For details on <code class="code"> mlcat.py </code> , see the document
        <em class="emphasis"> Server Operations Guide </em> 's section
        <em class="emphasis"> Admin Tools -&gt; Logger Daemons -&gt;
        MessageLogger -&gt; Command-line Utilities </em> .</p><p>For details on WebConsole's LogViewer module, see the document
        <em class="emphasis"> Server Operations Guide </em> 's section
        <em class="emphasis"> Admin Tools -&gt; WebConsole -&gt; Modules
        -&gt; LogViewer </em> and WebConsole's online help.</p></li><li><p>Added the configuration options <code class="code"> cellApp/maxGhostsToDelete
        </code> and <code class="code"> cellApp/minGhostLifespan </code> to allow control
        of anti-hysteresis in creation and deletion of ghost entities.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Server
        Configuration With <code class="code"> bw.xml </code> -&gt; CellApp Configuration
        Options </em> .</p></li><li><p>Added support to use of more CellApps to initially load the
        geometry of a space (if it has not been loaded, then more cells will
        be added, to help load the space faster).</p><p>This is controlled by the <code class="code"> cellAppMgr/maxLoadingCells
        </code> and <code class="code"> cellAppMgr/minLoadingArea </code> configuration
        options in <code class="code"> bw.xml </code> .</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis">
        Software Configuration With <code class="code"> bw.xml </code> -&gt; CellAppMgr
        Configuration Options </em> .</p></li><li><p>The optional argument <code class="code"> shouldLoadOnServer </code> has been
        added to <code class="code"> BigWorld.addSpaceGeometryMapping </code> on the
        CellApp.</p><p>This argument also specifies whether the geometry should only be
        loaded on the client, but not on the server.</p><p>For details, see the <em class="emphasis"> CellApp Python API
        </em> and <em class="emphasis"> CellApp C++ API </em>
        documentations.</p></li><li><p>The BigWorld version is now accessible in code as a string using
        the <code class="code"> BWVersion::versionString() </code> method.</p></li><li><p>Added the <code class="code"> Entity.getDict </code> method to cell entities,
        which is useful for debugging while inspecting all <code class="code"> .def </code>
        file properties. On other processes, the <code class="code"> __dict__ </code>
        property can be used.</p><p>For details, see the <em class="emphasis"> CellApp Python API
        </em> and <em class="emphasis"> CellApp C++ API </em>
        documentations.</p></li><li><p>Added support for accessing entries in a <code class="code"> FIXED_DICT
        </code> using attribute syntax -- <em class="emphasis"> i.e. </em> , you
        can use <code class="code"> self.myDict.myValue </code> as an alternative to <code class="code">
        self.myDict[ "myValue" ] </code> .</p><p>For details, see the document <em class="emphasis"> Server
        Programming Guide </em> 's section <em class="emphasis">
        Properties -&gt; Property Types -&gt; Composite Types -&gt; <code class="code">
        FIXED_DICT </code> Data Type </em> .</p></li><li><p>Documentation strings can now be added to methods exposed to
        Python (via new macros like <code class="code"> PY_METHOD_DECLARE_WITH_DOC </code>
        ).</p><p>For details, see the <em class="emphasis"> C++ API </em>
        documentations, and <code class="code"> src/lib/pyscript/pyobject_plus.hpp </code>
        .</p></li><li><p>Added the configuration option <code class="code">
        cellApp/maxPhysicsNetworkJitter </code> to allow control of tolerance
        for network jitter when performing physics validation.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Server
        Configuration With <code class="code"> bw.xml </code> -&gt; CellApp Configuration
        Options </em> .</p></li><li><p>When entity definitions are parsed, a warning is now emitted to
        the logger if PYTHON arguments are used in exposed methods. The
        presence of PYTHON args in <code class="code"> Exposed </code> methods represent a
        security risk and should be converted to use more concrete types such
        as <code class="code"> FIXED_DICT </code> .</p></li><li><p>Added a new type of script object, the user data object, which
        allows embedding user-defined data in chunk files. A key feature of
        user data objects is their linkability, which allows both entities and
        user data objects to link to other user data objects. They can be
        instantiated in the client or the server.</p></li><li><p>Added the option <code class="code"> options/dbPrefix </code> to StatLogger
        which allows multiple instances to be run on the same host.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Admin
        Tools -&gt; StatLogger -&gt; Option Configuration </em> .</p></li><li><p>Added the python callback <code class="code"> onBotsReady() </code> to bots
        which is called when the process becomes initialised.</p></li><li><p>Added member <code class="code"> base </code> to <code class="code"> CellViaBaseMailBox
        </code> and <code class="code"> cell </code> to <code class="code"> BaseViaCellMailBox </code>
        which is a direct MailBox to the intermediary entity for
        convenience.</p></li><li><p>Added a Flush User Mappings page in the administrative page of
        Web Console. This allows the administrator to flush user mappings of
        all bwmachined processes in the network so that new UNIX users can be
        used to create a new Web Console account.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1253"></a>3.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The <code class="code"> seeingHeight </code> argument of the cell entity
        methods <code class="code"> Entity.addVision </code> and <code class="code">
        Entity.addScanVision </code> is no longer scaled down by 0.875.</p><p>This scaling has been removed and the actual value passed in is
        now used.</p></li><li><p><code class="code"> BigWorld.createBaseAnywhere </code> and <code class="code">
        BigWorld.createBaseRemotely </code> can now accept data sections to
        describe the entity's properties.</p><p><code class="code"> BigWorld.createBaseLocally </code> has changed slightly
        to be consistent. Like the other <code class="code"> BigWorld.createBase </code>
        methods, it accepts multiple data sections.</p></li><li><p>The stream-data-to-client functionality formerly provided by
        <code class="code"> Proxy.addProxyData </code> is now provided by <code class="code">
        Proxy.streamStringToClient </code> and <code class="code"> Proxy.streamFileToClient
        </code> .</p><p>The callbacks on both the client and server have been renamed
        from <code class="code"> onProxyDataDownloadComplete </code> to <code class="code">
        onStreamComplete </code> .</p><p>Server-only customers should be aware that the <code class="code">
        onProxyData </code> method in the <code class="code"> ServerMessageHandler </code>
        interface in <code class="code"> servconn.hpp </code> has been changed to <code class="code">
        onStreamComplete </code> , and has a slightly different
        signature.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis">
        Software Configuration With <code class="code"> bw.xml </code> -&gt; CellApp
        Configuration Options -&gt; Download Streaming Configuration Options
        </em> , and the <em class="emphasis"> BaseApp Python API
        </em> and <em class="emphasis"> BaseApp C++ API </em>
        documentations</p></li><li><p>CellApp's <code class="code"> Entity.fieldOfView </code> attribute has been
        deprecated, since it is confusing (it is actually half the field of
        view) -- please use <code class="code"> Entity.visionAngle </code> instead.</p><p>For details, see the <em class="emphasis"> CellApp Python API
        </em> and <em class="emphasis"> CellApp C++ API </em>
        documentations.</p></li><li><p>The initial witnessed state of cell entities, as queried by
        <code class="code"> Entity.isWitnessed </code> , has changed to False.</p><p>Previously, entities were created assuming that they had just
        been witnessed, causing <code class="code"> Entity.onWitnessed( False ) </code>
        being called 8-12 minutes after creation (assuming no witnessing
        occurs in this period).</p><p>It has been changed so that entities are created assuming that
        they have <em class="emphasis"> not </em> been witnessed, such
        that after entity creation, <code class="code"> Entity.onWitnessed( False ) </code>
        is now not called until after <code class="code"> Entity.onWitnessed( True )
        </code> has been called when the entity has been witnessed.</p><p>For details, see the <em class="emphasis"> CellApp Python API
        </em> and <em class="emphasis"> CellApp C++ API </em>
        documentations.</p></li><li><p>The <code class="code"> FLOAT </code> data type has been renamed to <code class="code">
        FLOAT32 </code> . However, <code class="code"> FLOAT </code> is an alias for <code class="code">
        FLOAT32 </code> , so existing entity definitions will still
        work.</p><p>For details, see the document <em class="emphasis"> Server
        Programming Guide </em> 's sections <em class="emphasis">
        Properties -&gt; Property Types -&gt; Primitive Types </em> and
        <em class="emphasis"> The Database Layer -&gt; Mapping BigWorld
        Properties Into SQL -&gt; Simple Data Types </em> .</p></li><li><p>Old-style BaseApp backups ( <em class="emphasis"> i.e. </em> , via
        change of the IP address) are no longer supported.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Fault
        Tolerance -&gt; BaseApp Fault Tolerance </em> , the document
        <em class="emphasis"> Server Overview </em> 's section
        <em class="emphasis"> Server Components -&gt; BaseApp -&gt; Fault
        Tolerance </em> , and the document <em class="emphasis"> Server
        Programming Guide </em> 's section <em class="emphasis"> Fault
        Tolerance -&gt; BaseApp Fault Tolerance </em> .</p></li><li><p>The Cell Viewer protocol has changed to support sending of space
        geometry mapping information to connected viewer clients.</p><p>The Cell Viewer now supports two extra message types to
        facilitate this: <code class="code"> GET_VERSION </code> and <code class="code">
        GET_SPACE_GEOMETRY_MAPPINGS </code> .</p><p>Space Viewer has added support for this by displaying the space
        geometry mapping in the top left corner of space viewer windows
        (however, this does not dynamically update at present).</p><p>For using the new protocol, see <code class="code"> cell_app_mgr_talker.py
        </code> .</p><p>For details on the new message types, see the <em class="emphasis"> CellAppMgr C++ API </em> documentation.</p></li><li><p>CellApp watchers under the <code class="code"> profiles/ </code> and <code class="code">
        python/ </code> directories have been standardised to camelCase
        format.</p></li><li><p>The macro to redefine when declaring <code class="code"> EntityExtra </code>
        derived class has changed from <code class="code"> PY_METHOD_ATTRIBUTE </code> to
        <code class="code"> PY_METHOD_ATTRIBUTE_WITH_DOC </code> .</p><p>For details, see the <em class="emphasis"> C++ API </em>
        documentation.</p></li><li><p>All database columns that map to entity properties now have the
        "NOT NULL" specification. Previously, this specification was missing
        but BigWorld never inserts NULL values into the database.</p></li><li><p>The <code class="code"> bigworldTableMetadata </code> has been removed. DBMgr
        now uses the table meta data provided by MySQL. If you have previously
        "tricked" DBMgr into accepting a schema which does not match the
        entity definition by modifying <code class="code"> bigworldTableMetadata </code> ,
        it will no longer work.</p></li><li><p>Converted database tables bigworldGameTime, bigworldSpaces and
        bigworldSpaceData to use InnoDB instead of MyISAM. Now all tables
        created by BigWorld uses the InnoDB engine. As the result of this
        conversion the version column became unnecessary and has been dropped
        from bigworldSpaces and bigworldSpaceData.</p></li><li><p>The configuration option <code class="code"> dbMgr/name </code> has been
        deprecated - please use <code class="code"> dbMgr/databaseName </code>
        instead.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Server
        Configuration With <code class="code"> bw.xml </code> -&gt; DBMgr Configuration
        Options </em> .</p></li><li><p>When using new style BaseApp backup, BaseApps will only back up
        to BaseApps located on different physical machines if such BaseApps
        exist. This means that the system can survive the hardware failure of
        a physical machine running multiple BaseApps.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1523"></a>4.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Reduced the creation of new <code class="code"> CellAppChannel </code>
        instances when a real entity is initially created on the wrong
        cell.</p><p>For details on this class, see the <em class="emphasis">
        CellApp C++ API </em> documentation.</p></li><li><p>Improved error checking when accessing <code class="code"> Entity.ownClient
        </code> of entities that do not have a <code class="code"> Witness </code> .</p><p>For details on this attribute, see the <em class="emphasis">
        BaseApp Python API </em> and <em class="emphasis"> CellApp
        Python API </em> documentations.</p></li><li><p>Delayed the calling of <code class="code"> Base.onGetCell </code> until after
        the cell entity has been informed that it should have a
        witness.</p><p>For details on this callback, see the <em class="emphasis">
        BaseApp Python API </em> documentation.</p></li><li><p>Fixed navigation mesh sharing, which was causing crashes in the
        case of different spaces with the same geometries mapped.</p></li><li><p>Fixed bug with base entity <code class="code"> cellData['position'] </code>
        and <code class="code"> cellData['direction'] </code> initially referencing the
        same <code class="code"> Vector3 </code> object.</p></li><li><p>Improved LoginApp's resilience to Denial-of-Server attacks by
        not using reliable communication mechanism for failed login
        attempts.</p></li><li><p>The zlib library has been updated from version 1.2.1 to version
        1.2.3. This version includes some security fixes. See <code class="code">
        mf/src/lib/zip/ChangeLog </code> for more details.</p></li><li><p>Fixed a bug that could cause entity positions on a client to be
        incorrect when travelling on a very fast moving vehicle. The vehicle's
        position must have changed by at least 128 metres in the round-trip
        time to the server.</p></li><li><p>Fixed a bug that caused entities riding on a vehicle to be
        restored to an incorrect position when restoring from their Base
        entity.</p></li><li><p>Fixed spurious error messages when trying to archive an entity
        that is in the process of destroying its cell part.</p></li><li><p>Fixed a DBMgr crash when writing an entity with a base property
        that does not match its type in the entity definition.</p></li><li><p>Fixed a bug in MLTar when extracting a log archive file, it was
        possible to create an unusable user log directory due to the
        particular user log directory not already existing before the
        extraction.</p></li><li><p>Fixed a bug with streaming on request messages onto packets in
        multi-packet bundles.</p></li><li><p>Fixed a bug where entities would get stuck when they passed
        through navpolys with zero distance between them.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1611"></a>5.&nbsp;Known Bugs &amp; Limitations</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>For Linux machines running a kernel version 2.6 or greater,
        bwmachined will report slightly incorrect load under certain
        circumstances due to a change in the format of <code class="code"> /proc/stat
        </code> from kernel version 2.4.</p><p>The load reporting issue will only manifest when the system is
        spending a significant time idling due to IOwait or IRQ handling
        situations. As this issue only impacts statistic reporting in
        StatLogger/StatGrapher as well as the values reported in the cluster
        view of WebConsole there should be no detrimental impact to your
        server cluster operation.</p></li><li><p>The file specified by <code class="code"> resources.xml/system/terrain2
        </code> (by default, <code class="code"> system/data/terrain2.xml </code> ) is
        loaded each time that terrain is loaded. This can cause disk access in
        the main thread.</p><p>To avoid this, load and store a reference to this file's data
        section in your cell's personality script. See <code class="code">
        fantasydemo/res/scripts/cell/FantasyDemo.py </code> for an
        example.</p></li><li><p>Terrain Data uses a large amount of memory but it is not taken
        into account in load balancing.</p></li><li><p>The file specified by <code class="code">
        resources.xml/environment/materialKinds </code> (by default, <code class="code">
        system/data/material_kinds.xml </code> ) is loaded the first time a
        collision test occurs that involves terrain. This can cause disk
        access in the main thread.</p><p>To avoid this, load and store a reference to this file's data
        section in your cell's personality script. See <code class="code">
        fantasydemo/res/scripts/cell/FantasyDemo.py </code> for an
        example.</p></li><li><p>The <code class="code"> UserDataObjectRef </code> module is loaded the first
        time that it is needed. This can cause disk access in the main
        thread.</p><p>To avoid this, import this module into your personality scripts.
        See <code class="code"> fantasydemo/res/scripts/cell/FantasyDemo.py </code> and
        <code class="code"> fantasydemo/res/scripts/base/FantasyDemo.py </code> for
        examples.</p></li><li><p><code class="code"> FIXED_DICT </code> properties that have an <code class="code">
        &lt;implementedBy&gt; </code> can cause a module to be imported the
        first time that the type is created. This can cause disk access in the
        main thread.</p><p>To avoid this, import the necessary modules in the script file
        of the relevant entities or the personality scritps.</p></li><li><p>Currently, MySQL stored procedures are not supported when used
        with the <code class="code"> BigWorld.executeRawDatabaseCommand </code>
        method.</p><p>For details on this method, see the document <em class="emphasis"> Server Programming Guide </em> 's section <em class="emphasis"> The Database Layer -&gt; Execute Arbitrary Commands On
        Database </em> .</p></li><li><p>Due to the Watcher protocol changing as of 1.9.0, the server
        tools (WebConsole, StatLogger, ControlCluster, ...) are not backwards
        compatible. If your operational environment is still running 1.8.x
        servers it is recommended to maintain the existing server tools as
        forward compatibility has been maintained.</p></li><li><p>Customers using Debian Etch will experience issues with
        WebConsole and StatLogger failing overnight due to a MySQL
        reconnection issue. The cause of this issue is due to MySQL timing out
        inactive connections after 8 hours. Currently the default package
        versions of MySQL-python and SQLObject provided by Debian Etch do not
        include a known fix for this issue. The suggested work around for this
        problem is to restart WebConsole every morning prior to the majority
        of developers starting work. This can be achieved by added a cron job
        to the root user of the machine running WebConsole as follows:</p><pre class="programlisting">
          # 06:30 Mon-Fri: Restart WebConsole to avoid MySQL reconnection issues

30 6 * * 1-5 /etc/init.d/bw_web_console restart
        </pre></li><li><p>Tools startup scripts may fail to report when a tool has a
        problem starting if it terminated after it had detached.</p></li><li><p>BWMachined can crash if the messages it sends exceeds its
        internal limits, for example if it reports too many coredumps in one
        request.</p></li><li><p>A race condition can occur when a cell entity is created then
        immediately distroyed. This will cause the script to raise an
        exception. We recommend to either avoid doing this or handling the
        exception.</p></li><li><p>Too many python tracebacks caused by unhanded exceptions can
        cause CellApp to time out. It is recommended to deal with python
        exceptions as they arise.</p></li><li><p>DBMgr does not compile or run without using prepared statements
        despite looking like it should.</p></li><li><p>DBMgr has a race condition when <code class="code"> destroy() </code> and
        <code class="code"> createBaseLocallyFromDBID() </code> are used quickly together
        on the same entity.</p><p>To reset an entity, it is better to create a method to delete
        non-persistant properties and call the destruction and creation
        callbacks than to reload it from DB.</p></li><li><p>Starting multiple copies of DBMgr simultaneously may cause
        system to crash. Please make sure an instance is not running before
        starting another.</p></li><li><p>Unreliable packets do not have a sequence number and can thus be
        replayed by malicious parties. BigWorld does not, as a general rule,
        use unreliable packets for highly sensitive data.</p></li><li><p>All internal server cluster traffic is regarded as trusted and
        may expose stability or security issues if invalid. This will not be
        an issue unless a server component has already become
        compromised.</p></li><li><p>Clients may report a negative latency. This will only happen
        when real latency is very close to zero.</p></li><li><p>The entity definition parser may assert when a def file contains
        contradictory information such as a default value that exceeds the
        maximum length of a property.</p></li><li><p><code class="code"> FIXED_DICT </code> properties ignores assignments from
        invalid dictionaries but does not raise an exception.</p><p>If a <code class="code"> FIXED_DICT </code> is not being propagated, please
        check that every key corresponds to key in the fixed dict.</p></li><li><p>Large servers cannot use multiple instances of stat logger or
        message logger to share the load.</p><p>A single instance however should be able to handle a very large
        cluster.</p></li><li><p>Log output only works correctly with latin-1 encoding, try not
        to log unicode messages.</p></li><li><p>Multiple copies of CellAppMgr, BaseAppMgr and DBMgr can be
        started from WebConsole even though this configuration is not
        supported.</p><p>Make sure a configuration makes sense before hitting
        "Go!".</p></li><li><p>Searching for very narrow time periods in LogViewer can sometime
        be slightly inaccurate.</p><p>Please give it a few seconds margin of error on either
        side.</p></li><li><p>StatGrapher will occasionally fail to display certain time
        periods or display the wrong time period.</p><p>Just give it another try.</p></li><li><p>StatGrapher has a memory leak.</p><p>Please reload the page if flash is taking all of your
        memory.</p></li><li><p>There is an issue when cell entities pass their own mailbox from
        their <code class="code"> __init__() </code> function to the BaseApp that spawned
        them, and this cell mailbox is used for a remote method call. You can
        workaround this by using a short timer to delay any method calls that
        may pass a cell entity's mailbox to base methods until the next
        tick.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1785"></a>BigWorld Technology 1.8.6.7 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1788"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a potential MessageLogger crash that could occur if an
        invalid message stream was received.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1795"></a>BigWorld Technology 1.8.6.6 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1798"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added a mechanism to help detect issues with ghost
        entities.</p><p>The option <code class="code"> cellApp/enforceGhostDecorators </code> has
        been added to <code class="code"> bw.xml </code> . If enabled, a cell entity method
        that is not in the <code class="code"> .def </code> file can only be called on a
        potential ghost entity if it has the <code class="code">
        @bwdecorators.callableOnGhost </code> decorator.</p><p>This is disabled by default so that functionality does not
        change. It is recommended that you enable this and <code class="code">
        cellApp/treatAllOtherEntitiesAsGhosts </code> during debugging.</p></li><li><p>Servers will log a stack trace when hitting a critical assertion
        for easier bug reports.</p></li><li><p>Fixed an issue with the example SpeedController (in <code class="code">
        bigworld/src/server/egextra </code> ) caused by a bug when offloading
        controllers that are both <code class="code"> DOMAIN_GHOST </code> and <code class="code">
        DOMAIN_REAL </code> .</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1839"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an issue with Base reference counting. If a Base is
        created and the Base Python script calls <code class="code"> self.destroy() </code>
        in <code class="code"> __init__() </code> , this can cause the Base object to be
        destructed prematurely which can cause dangling Python
        references.</p></li><li><p>Fixed a bug where if the configuration setting <code class="code">
        &lt;baseApp&gt;/&lt;backUpUndefinedProperties&gt; </code> is set to
        false, entities cannot be backed up successfully.</p></li><li><p>Fixed a bug where a Proxy would assert if the client is given to
        (via giveClientTo) it after it has been restored from a crashed
        BaseApp.</p></li><li><p>Fixed a bug where an incoming bundle could time out and never be
        received even though it is on a channel.</p></li><li><p>Fixed a bug where two seperate logins from the same client would
        be mistaken for resending the request after the reply had been
        dropped.</p></li><li><p>Fixed a bug where enabling baseApp/packetLog would cause the
        baseapp to immediately segfault when a client connected.</p></li><li><p>Fixed a bug where newly teleported cell entities will sometimes
        cause another cellapp to crash after a cellapp crashes.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1873"></a>BigWorld Technology 1.8.6.5 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1876"></a>1.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Removed a development assert when we are resolving a base
        mailbox that points to the current BaseApp and the base does not
        exist. Now an invalid mailbox is returned.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1883"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a bug where overflow packets are not cleared when the
        channel is reset.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1890"></a>BigWorld Technology 1.8.6.4 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1893"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a bug where two seperate logins from the same client would
        be mistaken for resending the request after the reply had been
        dropped.</p></li><li><p>Fixed a bug where enabling baseApp/packetLog would cause the
        baseapp to immediately segfault when a client connected.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1903"></a>BigWorld Technology 1.8.6.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1906"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added a new timer option called <code class="code"> gettime </code> which
        uses the high-resolution monotonic timer in the Linux kernel for
        better stability in environments where NTP is used.</p></li><li><p>New server configuration options have been added to limit how
        many overflowed packets are allowed per channel type.</p><pre class="programlisting">
          

&lt;maxChannelOverflow&gt;

	&lt;external&gt; 1024 &lt;/external&gt;

	&lt;internal&gt; 8192 &lt;/internal&gt;

	&lt;indexed&gt;  4096 &lt;/indexed&gt;

	&lt;isAssert&gt; false &lt;/isAssert&gt;

&lt;/maxChannelOverflow&gt;


        </pre></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1921"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>It was possible for the client to lose track of the space data
        for the current space if the player teleported to a new space and then
        back to the original space almost immediately. This has now been
        fixed.</p></li><li><p>Fixed a bug where an incoming bundle could time out and never be
        received even though it is on a channel.</p></li><li><p>Fixed the library scripts in <code class="code">
        bigworld/res/entities/common/Lib </code> which were of a previous
        version to the Python interpreter used in server apps.</p></li><li><p>Extended the buffer size used when reading <code class="code"> /proc/cpuinfo
        </code> in bwmachined. The short buffer size was causing a crash when
        the processor flags line exceeded 256 characters (as seen on Opteron
        machines).</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1943"></a>BigWorld Technology 1.8.6.2 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1946"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The StatGrapher now explicitly specifies that Python pickle
        protocol 0 (original ASCII protocol) should be used. This makes the
        StatGrapher compatible with SQLObject 0.10.</p></li><li><p>Fixed a bug related to an assertion being triggered because
        piggyback messages are added too early.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1956"></a>BigWorld Technology 1.8.6.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1959"></a>1.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The StatLogger now deletes un-used data using the following
        algorithm: <br> </p><div class="itemizedlist"><ul type="circle"><li><p>Upon startup, delete un-used data less than a calculated
              tick, and there is no limit on the number of rows
              deleted.</p></li><li></li><li><p>During normal operation, for each tick, delete un-used
              data less than a calculated tick but each delete statement is
              restricted to delete at most 20 rows in a table.</p></li></ul></div></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1976"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed possible loss of ARRAY property data when two <code class="code">
        BigWorld.writeToDB </code> operations for the same entity are
        performed concurrently in different threads in the DBMgr.</p></li><li><p>Fixed issues with the management of network channel send window
        overflow. Previously, it would be possible for critical assertions to
        fail when packets overflow the channel send window.</p></li><li><p>Fixed a problem in the LogViewer module of the WebConsole so
        that when the <code class="code"> more </code> link is clicked, the next page of
        search results will be displayed rather than the first page of the
        search results.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1995"></a>BigWorld Technology 1.8.6 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1998"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added a new LoginApp configuration option <code class="code">
        shouldShutDownIfPortUsed </code> , which is a Boolean flag indicating
        whether the LoginApp should shut down if the specified port to listen
        to is not available.</p><p>If set to true, the LoginApp will shut down if the specified
        port to listen to is not available. If set to false, the LoginApp will
        find another port to listen to.</p></li><li><p>CellApp now has a function pointer <code class="code">
        g_entityMovementCallback </code> . If set, this will be called
        whenever an entity moves (whether the entity is a real or ghost). This
        can be used, for example, to implement custom range triggers or add a
        velocity property to ghost entities using the <code class="code"> EntityExtra
        </code> mechanism.</p></li><li><p>Added configuration options <code class="code">
        baseApp/shouldResolveMailBoxes </code> and <code class="code">
        cellApp/shouldResolveMailBoxes </code> to <code class="code"> bw.xml </code> .
        These options are defaulted to true so that the default behaviour is
        consistent with 1.8.5.</p><p>When enabled, if a mailbox can be resolved to a local entity,
        the mailbox will be immediately replaced with a reference to that
        entity. This leads to error-prone code as mailbox arguments can be
        used incorrectly to access entity properties directly. This often
        occurs during development when running in an environment with a single
        BaseApp or CellApp. Disabling these options is a good way to track
        down these types of issues.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2033"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Channels can now handle overflowing the send window.</p><p>Any send that occurs while the send window is full will go into
        an overflow queue. These packets will only be sent when space in the
        send window becomes available (due to ACKs being received).</p></li><li><p>Added configuration option <code class="code"> baseApp/clientOverflowLimit
        </code> to <code class="code"> bw.xml </code> .</p><p>Previously, if more than 256 packets were sent to a client
        without being acknowledged, the client would be disconnected. This
        limit is now configurable.</p></li><li><p>Added support for throttling the archive process if the channel
        to the DBMgr gets too full.</p><p>This helps to avoid the channel to the DBMgr overflowing if the
        DBMgr stalls.</p></li><li><p>Errors are now suppressed for external nubs when packets arrive
        with what appear to be bad flags.</p><p>This can occur soon after clients have been disconnected by the
        server.</p></li><li><p>Base entity backups now also include a copy of the cell entity
        backup data. This allows for the fault tolerance to handle nearly
        simultaneous BaseApp and CellApp crashes.</p></li><li><p>A new status code is returned when login fails due to rate
        limiting.</p><p>This has been written to be backwards compatible with older
        clients. If a client logs in with an older login version, the existing
        status code is returned instead of the new one.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2071"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a rare BaseApp crash on shutdown if a reply to <code class="code">
        BigWorld.executeRawDatabaseCommand </code> is received after the
        Python interpreter has been finalised.</p></li><li><p>Prevented incorrect clients from being disconnected on network
        send failure.</p><p>Previously, if a <em class="emphasis"> No Route to Host </em> error
        was received, it was possible for the wrong client to the
        disconnected.</p></li><li><p>Improved security by checking that all external messages are
        coming in across the right channel.</p></li><li><p>Previously, time queues could get very large if many timers with
        long expiry times were created and cancelled. This situation is now
        avoided by purging cancelled timers if there are too many of
        them.</p></li><li><p>Fixed a bug where retried login requests from the client are
        rejected immediately because of rate-limiting, if the original request
        was still pending. Now, subsequent requests are dropped and not
        considered for rate-limiting if the request is pending, or the cached
        login result is sent back to the client if the request has recently
        finished being processed.</p></li><li><p>Fixed the accounting of external nub off-channel packet receives
        and sends available as watcher values <code class="code">
        nubExternal/totals/packetsReceivedOffChannel </code> and <code class="code">
        nubExternal/totals/packetsSentOffChannel </code> respectively.
        Previously, these counts were being based on encrypted data instead of
        decrypted data.</p></li><li><p>Reject logins when required number of BaseApps or CellApps have
        not started. Previously, logins were accepted but will most likely
        cause script errors since bootstrap functions such as <code class="code">
        <em class="emphasis"> BWPersonality </em> .onBaseAppReady </code> have not
        been called.</p></li><li><p>Fixed a potential BaseApp crash that could occur if two clients
        attempt to log in to the same account at the same time.</p><p>This could only occur if <code class="code"> Base.onLogOnAttempt </code>
        returns <code class="code"> True </code> (i.e. accept re-login attempt).</p></li><li><p>Previously, if a stale mailbox* was used to create a cell
        entity, an assertion would be hit. A failure is now sent back to the
        base entity instead and <code class="code"> Base.onCreateCellFailure </code> is
        called.</p><p>*A stale mailbox is one that refers to a cell entity that no
        longer exists on that indicated CellApp because it has been destroyed
        or teleported away.</p></li><li><p>Fixed a LoginApp crash that would occur when shutting down while
        outstanding logins were in progress.</p></li><li><p>Fixed a problem with printing strings containing null bytes when
        connected to a Python console via a telnet session.</p></li><li><p>Fixed a security vulnerability where it was possible for a
        malformed bundle to contain messages that would be delivered to a
        Proxy that was not attached to that Proxy</p></li><li><p>Fixed a problem that could cause the client to crash when
        logging in. This could occur if a logout message was received before
        <code class="code"> ServerConnection::logOnComplete </code> was called.</p></li><li><p>Modified an assertion that could be triggered on a
        BaseApp.</p><p>In the very rare situation that a cell is created via the
        CellAppMgr, it is possible (although unlikely) for the CellApp to have
        responded with success but the CellAppMgr responds with
        failure.</p><p>This should only really occur if something has caused the
        CellApp to become unresponsive just after creating the cell
        entity.</p><p>This is now only a development-time only assertion.</p></li><li><p>Fixed a memory leak in <code class="code"> BigWorld.fetchEntitiesFromChunks
        </code> on the BaseApp. The <code class="code"> handler </code> argument had a
        reference leak causing it to never be deleted.</p></li><li><p>If a newly created cell entity is offloaded to another CellApp
        before it has a chance to send any data to its attached client, there
        was a chance that the space data associated with that space would not
        be sent to the client. This could result in the client not know what
        geometry to map into its space.</p></li><li><p>Removed an invalid assertion from CellApp's EntityVision class.
        It was accessing a property of an object that may have been
        deleted.</p></li><li><p>An optimisation to send cell entity creation messages directly
        to a CellApp when only a space id is known has been disabled. This
        worked by finding a Base entity on the same BaseApp in the same space
        id and using this as the reference mailbox. If the chosen mailbox
        referred to an entity that was in the process of being destroyed, this
        could cause the cell entity creation to fail.</p></li><li><p>The order that base entities are now backed up and archived is
        now randomised. This reduces the likelihood of spikes caused by
        handling expensive entities in close succession.</p></li><li><p>Fixed a potential CellApp assertion that could occur when
        teleporting to a stale mailbox. On failure, the teleported entity is
        now returned to the original space and <code class="code"> Entity.onTeleportFailure
        </code> is called on that entity.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2186"></a>BigWorld Technology 1.8.5 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2189"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added member <code class="code"> base </code> to <code class="code"> CellViaBaseMailBox
        </code> and <code class="code"> cell </code> to <code class="code"> BaseViaCellMailBox </code>
        which is a direct MailBox to the intermediary entity for
        convenience.</p></li><li><p>Added a new BaseApp configuration option <code class="code">
        backUpUndefinedProperties </code> , which is a Boolean flag indicating
        whether undefined properties should be backed up.</p><p>Properties of an entity are defined in the entity's definition
        file. However, it is possible to define additional properties for this
        entity in the base script of this entity. For example, an additional
        property can be defined by initialising it in the constructor of this
        entity class. These additional properties are referred to as undefined
        properties.</p><p>If this option is set to true, undefined properties will be
        backed up and an error will be emitted for each of the properties that
        cannot be pickled. If this option is set to false, undefined
        properties will not be backed up. Default value is true.</p></li><li><p>Added <code class="code"> Hard Kill </code> action to the Actions menu of
        each process in the Cluster Control module of the WebConsole. This new
        action enables the user to kill the process with the SIGKILL
        signal.</p></li><li><p>Added <code class="code"> Quit (Dump Core) </code> action to the Actions menu
        of each process in the Cluster Control module of the WebConsole. This
        new action enables the user to terminate the process with the SIGQUIT
        signal and dump core.</p></li><li><p>Added support for user-dependent bw.xml file to allow easier
        support for multiple users running from the same resource tree.</p><p>If a file with the name <code class="code"> bw_&lt;username&gt;.xml </code>
        exists, this is now used as the start of the server configuration
        chain instead of <code class="code"> bw.xml </code> .</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2241"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Python version has been upgraded to 2.5.2.</p></li><li><p>When using new style BaseApp backup, BaseApps will only back up
        to BaseApps located on different physical machines if such BaseApps
        exist. This means that the system can survive the hardware failure of
        a physical machine running multiple BaseApps.</p></li><li><p>Supporting better aggregation of messages sent on <em class="emphasis">
        irregular* </em> channels.</p><p>When making script calls on a BaseMailBox, for example,
        previously a network packet was created for each call. The sending of
        these messages have now been delayed slightly so that multiple
        messages to over the same channel can be aggregated.</p><p><em class="emphasis"> *An irregular channel is a channel that does not have
        a regular send interval. </em></p></li><li><p>Optimised writing of ARRAY properties into MySQL database by
        updating existing rows instead of deleting and re-inserting
        rows.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2265"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a potential CellApp crash caused by using a deleted
        Channel.</p><p>This could occur if a message in a packet on an entity's channel
        caused that entity to teleport. If there were further buffered packets
        on this channel, these would be processed after the channel was
        gone.</p></li><li><p>Fixed a bug where entities recently teleported to a crashed
        cellapp may not be restored correctly</p></li><li><p>Fixed a problem where two clients could log in with the same
        account details at the same time. If <code class="code"> Proxy.onLogOnAttempt
        </code> allowed the second login, an assertion on the BaseApp could be
        triggered if both logins succeeded.</p></li><li><p>Fixed a vulnerability that allowed a bad network packet to move
        an entity to an invalid position. This could later cause an infinite
        loop in the CellApp process.</p><p>The y-coordinate sent from clients was not being appropriately
        validated.</p></li><li><p>Fixed an issue where terrain collision could fail at the edge of
        a terrain block.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2291"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>For Linux machines running a kernel version 2.6 or greater,
        bwmachined will report slightly incorrect load under certain
        circumstances due to a change in the format of <code class="code"> /proc/stat
        </code> from kernel version 2.4.</p><p>The load reporting issue will only manifest when the system is
        spending a significant time idling due to IOwait or IRQ handling
        situations. As this issue only impacts statistic reporting in
        StatLogger/StatGrapher as well as the values reported in the cluster
        view of WebConsole there should be no detrimental impact to your
        server cluster operation.</p></li><li><p><code class="code"> Nub::cancelTimers() </code> cannot be called from within
        <code class="code"> handleTimeout </code> to cancel the current timer. Use <code class="code">
        Nub::cancelTimer() </code> instead.</p></li><li><p>When loading a space on a CellApp, the <code class="code"> space.settings
        </code> file is accessed. If this is not currently loaded, this causes
        disk access in the main thread. This may cause the CellApp to timeout
        if disk access is slow.</p><p>To work around this, it is recommended that you load and store
        all possible <code class="code"> space.settings </code> files when CellApps start.
        See <code class="code"> onInit </code> in
        fantasydemo/res/entities/cell/FantasyDemo.py for an example.</p></li><li><p>The XML database has many limitations that preclude its use in a
        production system. <br> It is not recommended for serious
        development work, as some of its limitations may be time-consuming to
        work around. <br> The limitations are listed below:</p><div class="itemizedlist"><ul type="circle"><li><p>There is single namespace for all entities. <br> Entities
            with an <code class="code"> &lt;Identifier&gt; </code> property must ensure
            that its value is unique amongst all entities. <br> In
            contrast, the MySQL database implements a separate namespace for
            each entity type, so that it is sufficient to ensure only that the
            <code class="code"> &lt;Identifier&gt; </code> property is unique amongst all
            entities of the same type</p></li><li><p>There is no equivalent of the <code class="code"> bigworldLogOnMapping
            </code> table feature.</p></li><li><p>Support for the following configuration options is not
            implemented correctly:</p><div class="itemizedlist"><ul type="square"><li><p><code class="code"> dbMgr/createUnknown </code></p></li><li><p><code class="code"> dbMgr/rememberUnknown </code></p></li><li><p><code class="code"> dbMgr/loadUnknown </code></p></li></ul></div><p>The <code class="code"> dbMgr/loadUnknown </code> option is always true.
            <br> If <code class="code"> dbMgr/createUnknown </code> is true, then <code class="code">
            dbMgr/rememberUnknown </code> is automatically also true.</p></li><li><p>Support for disaster recovery is not implemented.</p></li></ul></div></li><li><p>There is a known memory leak in Macromedia Flash's server
        communication library used by StatGrapher. <br> If StatGrapher is
        run continuously for many days, then the browser might consume large
        amounts of memory. <br> The workaround is to refresh the page when
        memory usage becomes noticeably large.</p></li><li><p>By default, server components cannot cope with variable CPU
        speeds. <br> Running the server on a CPU with SpeedStep technology
        can cause the server's timer to be incorrect. If this occurs, need to
        set <code class="code"> [TimingMethod] </code> to <code class="code"> gettimeofday </code> in
        <code class="code"> /etc/bwmachined.conf </code> .</p></li><li><p>Any comments added to the default configuration files (such as
        <code class="code"> message_logger.conf </code> and <code class="code"> /etc/bigworld.conf
        </code> ) are lost when updated through the install script.</p></li><li><p>When using the Adblock extension to Firefox, the StatGrapher
        display can appear compressed. <br> To work around this issue,
        disable the Adblock extension.</p></li><li><p>When reading a <code class="code"> UINT32 </code> property from a data
        section, the value is initially read as an <code class="code"> int32 </code> . To
        input numbers greater than 231 - 1, enter the value cast as an <code class="code">
        int </code> . <br> For example, for a value of 232, enter -1.
        <br> If you encounter this problem in the XML database, it is
        recommended that you use MySQL for DBMgr's data storage.</p></li><li><p>Entities cannot navigate across chunk boundaries where there
        exists navigation polygons at multiple heights.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2441"></a>BigWorld Technology 1.8.4.5 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2444"></a>1.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Supporting better aggregation of messages sent on <em class="emphasis">
        irregular* </em> channels.</p><p>When making script calls on a BaseMailBox, for example,
        previously a network packet was created for each call. The sending of
        these messages have now been delayed slightly so that multiple
        messages to over the same channel can be aggregated.</p><p><em class="emphasis"> *An irregular channel is a channel that does not have
        a regular send interval. </em></p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2459"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>It was possible for a database operation to fail due to a lock
        wait timeout error. DBMgr now retries the transaction if this error is
        encountered.</p></li><li><p>Fixed a potential CellApp crash caused by using a deleted
        Channel.</p><p>This could occur if a message in a packet on an entity's channel
        caused that entity to teleport. If there were further buffered packets
        on this channel, these would be processed after the channel was
        gone.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2471"></a>BigWorld Technology 1.8.4.4 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2474"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>It is now possible to change the minimum resend timeout for
        packets that are sent from the server to the client. You do this via
        the <code class="code"> bw.xml </code> configuration option <code class="code">
        baseApp/minClientInactivityResendDelay </code> .</p></li><li><p>The volume of network-related log output has been
        reduced.</p><p>The <code class="code"> bw.xml </code> configuration options <code class="code">
        baseApp/verboseExternalNub </code> and <code class="code">
        loginApp/verboseExternalNub </code> have been added to allow
        re-enabling.</p></li><li><p>New watcher values <code class="code"> totals/numDuplicatePacketsReceived
        </code> and <code class="code"> totals/numPiggybacks </code> have been added to
        nubs.</p></li><li><p>Added <code class="code"> FLOAT64 </code> data type, that corresponds to a
        IEEE 64-bit floating-point number.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2516"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>It was possible for the load on the CellApp to increase due to
        pauses on the client.</p><p>This was caused by the BaseApp not responding to the CellApp
        quickly enough before it was waiting for a client packet causing
        resends. This has now been fixed.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2525"></a>BigWorld Technology 1.8.4.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2528"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>If multiple entities teleported between the same spaces, at the
        same time, it was possible for property changes that occurred just
        before teleporting, not to be propagated. This has now been
        fixed.</p></li><li><p>It was possible to cause a client connection failure during the
        transition from LoginApp to BaseApp if the reply to sendBaseAppLogin
        was lost. This issue has now been resolved.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2538"></a>BigWorld Technology 1.8.4.2 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2541"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a memory leak in the bots where calling <code class="code"> Bot.moveTo(
        position ) </code> was never releasing the memory associated with the
        previous movement destination.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2551"></a>BigWorld Technology 1.8.4.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2554"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Incoming message traffic from clients to the server is now
        rate-limited. The time-based limits are specific to frequency as well
        as size of messages from clients. Refer to the <em class="emphasis">
        Server Operations Guide -&gt; Server Configuration with <code class="code"> bw.xml
        </code> -&gt; BaseApp configuration options -&gt; Client upstream
        limits </em> section for more information.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2567"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an issue where terrain collision could fail at the edge of
        a terrain block.</p></li><li><p>Fixed an issue where encryption of messages fails due to message
        sizes being too large for the public/private key used.</p></li><li><p>Fixed a BaseApp crash that would occur when calling <code class="code">
        BigWorld.createBaseAnywhere </code> without keyword arguments.</p></li><li><p>No longer asserts when trying to invert a matrix with zero
        determinant via Python.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2586"></a>BigWorld Technology 1.8.4 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2589"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added two new watchers for the number of bytes resent ( <code class="code">
        nub/totals/bytesResent </code> ) and the number of packets resent (
        <code class="code"> nub/totals/packetsResent </code> ).</p></li><li><p>Added a ControlCluster command called <code class="code"> eventprofile
        </code> . This is a tool for profiling the bandwidth used by script
        methods and property propagations to clients. See the ControlCluster
        online help (use the command line switch <code class="code"> --help </code> ) for
        more information.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2611"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The number of core dumps reported by bwmachined to a UserMessage
        query has been limited to 10.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2618"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Bwmachined will now ignore any CreateMessage's where the
        executable name (eg: cellapp), or the configuration (eg: Hybrid)
        contains a "..". This prevents a malicious hand crafted CreateMessage
        from running arbitrary executables.</p></li><li><p>Bwmachined will no longer respond to messages if the response
        exceeds the maximum MGMPacket size of 32K.</p></li><li><p>Reviver now stops running after reviving a server
        component.</p></li><li><p>Fixed BaseAppMgr building to not have a dependency on
        OpenSSL.</p></li><li><p>Cancelling a Nub timer from within Nub::handleTimeout() will now
        correctly remove the timer.</p></li><li><p><code class="code"> BigWorld.createBaseAnywhere </code> and <code class="code">
        BigWorld.createBaseRemotely </code> can now accept data sections to
        describe the entity's properties.</p><p><code class="code"> BigWorld.createBaseLocally </code> has changed slightly
        to be consistent. Like the other <code class="code"> BigWorld.createBase </code>
        methods, it accepts multiple data sections.</p></li><li><p>Entity definition inheritance now no longer causes a critical
        assertion in DBMgr.</p></li><li><p>Message Logger will now correctly remove its pid file on
        shutdown if it is unable to communicate with BWMachined on
        startup.</p></li><li><p>Watcher values for cell entities will now be displayed
        correctly.</p></li><li><p>Calling <code class="code"> BigWorld.createEntityOnBase() </code> on a
        CellApp with a property argument of <code class="code"> None </code> will no longer
        cause the process to segfault.</p></li><li><p>Running SpaceViewer across subnets with only the -c option
        specified no longer causes an user resolution error.</p></li><li><p>Fixed a bug with packing and unpacking Mercury messages with
        variable length described by N bytes (where N is one of {1, 2, 3}). If
        the size of the message was exactly 2N - 1, then the receiving side
        was unpacking invalid length data.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2676"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> Nub::cancelTimers() </code> cannot be called from within
        <code class="code"> handleTimeout </code> to cancel the current timer. Use <code class="code">
        Nub::cancelTimer() </code> instead.</p></li><li><p>When loading a space on a CellApp, the <code class="code"> space.settings
        </code> file is accessed. If this is not currently loaded, this causes
        disk access in the main thread. This may cause the CellApp to timeout
        if disk access is slow.</p><p>To work around this, it is recommended that you load and store
        all possible <code class="code"> space.settings </code> files when CellApps start.
        See <code class="code"> onInit </code> in
        fantasydemo/res/entities/cell/FantasyDemo.py for an example.</p></li><li><p>The XML database has many limitations that preclude its use in a
        production system. <br> It is not recommended for serious
        development work, as some of its limitations may be time-consuming to
        work around. <br> The limitations are listed below:</p><div class="itemizedlist"><ul type="circle"><li><p>There is single namespace for all entities. <br> Entities
            with an <code class="code"> &lt;Identifier&gt; </code> property must ensure
            that its value is unique amongst all entities. <br> In
            contrast, the MySQL database implements a separate namespace for
            each entity type, so that it is sufficient to ensure only that the
            <code class="code"> &lt;Identifier&gt; </code> property is unique amongst all
            entities of the same type</p></li><li><p>There is no equivalent of the <code class="code"> bigworldLogOnMapping
            </code> table feature.</p></li><li><p>Support for the following configuration options is not
            implemented correctly:</p><div class="itemizedlist"><ul type="square"><li><p><code class="code"> dbMgr/createUnknown </code></p></li><li><p><code class="code"> dbMgr/rememberUnknown </code></p></li><li><p><code class="code"> dbMgr/loadUnknown </code></p></li></ul></div><p>The <code class="code"> dbMgr/loadUnknown </code> option is always true.
            <br> If <code class="code"> dbMgr/createUnknown </code> is true, then <code class="code">
            dbMgr/rememberUnknown </code> is automatically also true.</p></li><li><p>Support for disaster recovery is not implemented.</p></li></ul></div></li><li><p>There is a known memory leak in Macromedia Flash's server
        communication library used by StatGrapher. <br> If StatGrapher is
        run continuously for many days, then the browser might consume large
        amounts of memory. <br> The workaround is to refresh the page when
        memory usage becomes noticeably large.</p></li><li><p>By default, server components cannot cope with variable CPU
        speeds. <br> Running the server on a CPU with SpeedStep technology
        can cause the server's timer to be incorrect. If this occurs, need to
        set <code class="code"> [TimingMethod] </code> to <code class="code"> gettimeofday </code> in
        <code class="code"> /etc/bwmachined.conf </code> .</p></li><li><p>Any comments added to the default configuration files (such as
        <code class="code"> message_logger.conf </code> and <code class="code"> /etc/bigworld.conf
        </code> ) are lost when updated through the install script.</p></li><li><p>When using the Adblock extension to Firefox, the StatGrapher
        display can appear compressed. <br> To work around this issue,
        disable the Adblock extension.</p></li><li><p>When reading a <code class="code"> UINT32 </code> property from a data
        section, the value is initially read as an <code class="code"> int32 </code> . To
        input numbers greater than 231 - 1, enter the value cast as an <code class="code">
        int </code> . <br> For example, for a value of 232, enter -1.
        <br> If you encounter this problem in the XML database, it is
        recommended that you use MySQL for DBMgr's data storage.</p></li><li><p>Entities cannot navigate across chunk boundaries where there
        exists navigation polygons at multiple heights.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2818"></a>BigWorld Technology 1.8.3.5 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2821"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an issue with buffered ghost message playback that could
        occur if entities alternately offload between two CellApps repeatedly.
        This was causing buffered messages to be incorrectly replayed twice,
        which caused an assertion to fail.</p></li><li><p>Fixed an issue with restoring entities with witnesses.
        Previously, the backup witness data may not have matched the current
        game state (e.g. if the cell has dropped or enabled witnesses since
        the backup). At restore, the witness state is corrected with an
        explicit enable/disable witness message if necessary.</p></li><li><p>Fixed an issue with ghost message buffering if entities were
        teleporting and part or all of the resulting message sequence is
        buffered and then played back.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2834"></a>BigWorld Technology 1.8.3.4 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2837"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an issue with some CellApp real entity messages being
        buffered for later playback as if they were ghost entity
        messages.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2844"></a>BigWorld Technology 1.8.3.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2847"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an issue where delete operations to <code class="code">
        BigWorld.globalData </code> were not being propagated.</p></li><li><p>Fixed an issue with some remote method calls using some mailbox
        types streaming incorrectly sized method indices, causing corruption
        on the stream.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2860"></a>BigWorld Technology 1.8.3.2 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2863"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added login rate limiting. This is to alleviate load problems
        when LoginApp is facing high frequency of login requests, and the
        limiting factor is its ability to RSA decrypt the login parameters. At
        some point, the backlog reaches a state where the LoginApp is
        uselessly decrypting login parameters for requests that are likely to
        have already expired on the client-side.</p><p>With this feature, a quota per time period is specified, for
        example, 500 requests per 10 seconds. Any requests past the initial
        500 in each 10 second period is not decrypted and a message is sent
        back to the client indicating that logins are not allowed.</p><p>This is controlled via the new bw.xml options:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> loginApp/loginRateDuration </code></p></li><li><p><code class="code"> loginApp/loginRateLimit </code></p></li></ul></div><p>There are also corresponding LoginApp watchers:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> config/rateLimit/duration </code></p></li><li><p><code class="code"> config/rateLimit/loginLimit </code></p></li></ul></div></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2894"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>You can now specify the port used when transferring profile data
        over <code class="code"> scp </code> while running the ControlCluster <code class="code">
        pyprofile </code> command by adding the argument <code class="code"> --port </code>
        to the command line.</p></li><li><p>The ControlCluster <code class="code"> stop </code> command no longer forces
        server processes to stop (using SIGINT and SIGQUIT) after 10 seconds.
        It will continue polling the state of server processes. They can still
        be manually killed using ControlCluster's kill command.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2916"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed random crashes in DBMgr caused by concurrent access to a
        pool allocator from multiple threads without a lock.</p></li><li><p>Fixed an assert in BaseApp when proxy data (provided by <code class="code">
        Proxy.addProxyData </code> ) is added to a nearly full downstream
        client packet.</p></li><li><p>Fixed a CellApp crash due to an internal channel overflow if the
        base entity was destroyed while the cell entity is in the process of
        being created.</p></li><li><p>Fixed a bug where LoginApp would never leave the state of
        rejecting logins due to LoginApp being in the <em class="emphasis"> system
        overloaded </em> state, which was being perpetuated if there
        were more than one login request per second.</p></li><li><p>Fixed an assertion failure that can be triggered when a method
        is called on a mailbox to a newly created cell as a result of a base
        method call from that cell entity's <code class="code"> __init__ </code>
        method.</p></li><li><p>Fixed a bug with cell entity timers being expired too soon if
        they had just been offloaded.</p></li><li><p>Fixed a bug when creating cell entities from the base entity,
        caused by not clearing a flag indicating cell creation is pending if
        the cell creation failed.</p></li><li><p>Fixed an incorrect assertion failure that could be triggered by
        the client calling exposed script methods on mailboxes to entities
        that no longer exist.</p></li><li><p>Fixed a type casting issue which was causing overflow of method
        indices when calling BaseViaCellMailBox method calls.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2956"></a>BigWorld Technology 1.8.3.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2959"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added &lt;cellApp/defaultAoIRadius&gt; option. This sets the
        default AoI radius of cell entities associated with a connected
        client. Previously, script had to set this per-entity by calling
        <code class="code"> BigWorld.Entity.setAoIRadius() </code> .</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2969"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The process for entity backups is now randomised to normalise
        entity backup load, and no longer backs up in the order that entities
        were added. This improves the situation where many large-sized
        entities are added in a contiguous block. Previously, this would have
        caused large load spikes when the backup process reached this block of
        large-sized entities.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2976"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an issue if a base entity had a corresponding cell entity
        which was destroyed, and the base entity subsequently recreated its
        cell entity, then both the cell and base parts of the entity would be
        in a bad state.</p></li><li><p>BaseApp now survives any errors when writing entity data from
        the base entity back to the database, such as when streaming cell data
        fails. Previously this caused the entity data stream to the database
        to be incomplete, and was causing entity properties to be written as
        if they'd been streamed from zeroed bytes.</p></li><li><p>Fixed a bug where an entity enters the AoI of a bot, the
        entity's position appeared to be (0, 0, 0) for a brief period of time
        before being set to the correct value.</p></li><li><p>Fixed a bug where calling the 64th or above exposed cell or base
        methods from a bot will cause it to call some random method on the
        base.</p></li><li><p>Fixed an occasional CellAppMgr crash when the DBMgr is
        non-responsive for longer than 10 seconds.</p></li><li><p>Fixed OpenSSL includes to use non-system includes.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e2998"></a>BigWorld Technology 1.8.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3001"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added &lt;cellApp/maxGhostsToDelete&gt; bw.xml option. Controls
        the maximum number of ghosts to be deleted from other cells every
        offload check. The frequency of this check is set via
        &lt;cellApp/checkOffloadsPeriod&gt;. This option is useful for adding
        some antihysteresis and smoothing the load caused by ghost
        deletion.</p></li><li><p>Added &lt;cellApp/minGhostLifespan&gt; bw.xml option. Controls
        minimum number of seconds that a real entity will keep a ghost entity
        alive for. This is useful for adding antihysteresis to the ghost
        creation and deletion process.</p></li><li><p>All traffic between pairs of server processes is now guaranteed
        to be ordered and reliable. This was achieved by the introduction of
        "anonymous" channels.</p></li><li><p>Packets sent on the internal network can now optionally use
        checksums to verify data integrity. This is in addition to the UDP
        checksum provided by the kernel and was introduced after discovering
        that the kernel's checksum can be defeated when using (suspected)
        dodgy network drivers. This checksum is enabled by default for the
        internal network but can be disabled with the
        &lt;shouldUseChecksums&gt; bw.xml option if you have confidence in the
        kernel checksum. If you are getting checksum failures you will see
        messages like this: </p><pre class="programlisting">
            
	ERROR Nub::processFilteredPacket( 10.40.9.103:32823 ): Packet (flags 178,
	size 1459) failed checksum (wanted 3dc56738, got 9fe7000a)
	
          </pre></li><li><p>The default for the maximum size of UDP packets sent between the
        client and the server has been reduced.</p><p>This avoids issues when connecting over a network that cannot
        handle large UDP packets such as some VPNs.</p></li><li><p>Added reviver support to control_cluster.py. Servers can now be
        started with revivers on each used machine automatically, and revivers
        are displayed correctly in the `display` output.</p></li><li><p>Added &lt;logSpamPatterns&gt; bw.xml option. It is a list of log
        message prefixes which will be suppressed on a per-second basis if the
        number sent to MessageLogger exceeds a certain threshold.</p><p>Note that this is not intended a mechanism to sweep error
        messages "under the carpet"; it is designed to reduce the network load
        that can be generated by log traffic, which tests have indicated can
        be in excess of actual game traffic in some situations if suppression
        is disabled.</p><p>This option can be overridden by a tag with the same name in any
        app section. Note that the overriding does not merge the suppression
        lists, it simply replaces the global list with the one defined at the
        app level. Additionally, the list of suppression patterns can be
        modified at runtime using the logger/addSpamSuppressionPattern and
        logger/delSpamSuppressionPattern watchers. Please see
        bigworld/res/server/defaults.xml for an example of a suppression
        list.</p></li><li><p>Added &lt;logSpamThreshold&gt; bw.xml option. It controls the
        number of a particular log message that can be sent to MessageLogger
        in a single second before suppression will take place. Note that only
        messages matching one of the &lt;logSpamPatterns&gt; (see above) will
        be suppressed.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3037"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>All traffic between the client and server is now fully
        encrypted. The login transaction is encrypted using 2048-bit RSA and
        the Proxy-Client channel is encrypted using 128-bit Blowfish. Tests
        indicate this will result in at most a 5% performance hit on each
        BaseApp. The g_pProxyFilterCreator hook is no longer supported and
        customers who were using it to implement their own encryption will
        have to edit the new EncryptionFilter class if they want to continue
        using a different type of encryption.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3044"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Previously, it was possible that restoring a cell entity could
        fail due to a timeout. If this occurred, the base entity could be left
        in a bad state and invalid data could be written to the
        database.</p><p>This timeout has now been removed. Restoring cell entities will
        always succeed if there are remaining CellApps.</p></li><li><p>Fixed bugs in the handling of fragmented unreliable
        bundles.</p><p>Previously, if not all fragments were received, the received
        fragments would be held on to indefinitely.</p></li><li><p>Fixed an issue where an app that has had a temporary network
        brown-out could "come back from the dead" and send traffic that would
        conflict with the traffic from the app that had replaced it.</p></li><li><p>Messages sent from a real to its ghosts are now guaranteed to be
        ordered.</p><p>This fixes crashes related to properties being updated
        out-of-order. An example of this was hitting an assertion when
        updating an element of an ARRAY property before its size had been
        updated.</p></li><li><p>Exceptions raised by the callback function provided to <code class="code">
        Base.registerGlobally </code> are now caught and logged.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3072"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> Nub::cancelTimers() </code> cannot be called from within
        <code class="code"> handleTimeout </code> to cancel the current timer. Use <code class="code">
        Nub::cancelTimer() </code> instead.</p></li><li><p>When loading a space on a CellApp, the <code class="code"> space.settings
        </code> file is accessed. If this is not currently loaded, this causes
        disk access in the main thread. This may cause the CellApp to timeout
        if disk access is slow.</p><p>To work around this, it is recommended that you load and store
        all possible <code class="code"> space.settings </code> files when CellApps start.
        See <code class="code"> onInit </code> in
        fantasydemo/res/entities/cell/FantasyDemo.py for an example.</p></li><li><p>The XML database has many limitations that preclude its use in a
        production system. <br> It is not recommended for serious
        development work, as some of its limitations may be time-consuming to
        work around. <br> The limitations are listed below:</p><div class="itemizedlist"><ul type="circle"><li><p>There is single namespace for all entities. <br> Entities
            with an <code class="code"> &lt;Identifier&gt; </code> property must ensure
            that its value is unique amongst all entities. <br> In
            contrast, the MySQL database implements a separate namespace for
            each entity type, so that it is sufficient to ensure only that the
            <code class="code"> &lt;Identifier&gt; </code> property is unique amongst all
            entities of the same type</p></li><li><p>There is no equivalent of the <code class="code"> bigworldLogOnMapping
            </code> table feature.</p></li><li><p>Support for the following configuration options is not
            implemented correctly:</p><div class="itemizedlist"><ul type="square"><li><p><code class="code"> dbMgr/createUnknown </code></p></li><li><p><code class="code"> dbMgr/rememberUnknown </code></p></li><li><p><code class="code"> dbMgr/loadUnknown </code></p></li></ul></div><p>The <code class="code"> dbMgr/loadUnknown </code> option is always true.
            <br> If <code class="code"> dbMgr/createUnknown </code> is true, then <code class="code">
            dbMgr/rememberUnknown </code> is automatically also true.</p></li><li><p>Support for disaster recovery is not implemented.</p></li></ul></div></li><li><p>There is a known memory leak in Macromedia Flash's server
        communication library used by StatGrapher. <br> If StatGrapher is
        run continuously for many days, then the browser might consume large
        amounts of memory. <br> The workaround is to refresh the page when
        memory usage becomes noticeably large.</p></li><li><p>Server components cannot cope with variable CPU speeds. <br>
        Running the server on a CPU with SpeedStep technology can cause the
        server's timer to be incorrect. If this occurs, need to set <code class="code">
        [TimingMethod] </code> to <code class="code"> gettimeofday </code> in <code class="code">
        /etc/bwmachined.conf </code> .</p></li><li><p>Any comments added to the default configuration files (such as
        <code class="code"> message_logger.conf </code> and <code class="code"> /etc/bigworld.conf
        </code> ) are lost when updated through the install script.</p></li><li><p>When using the Adblock extension to Firefox, the StatGrapher
        display can appear compressed. <br> To work around this issue,
        disable the Adblock extension.</p></li><li><p>When reading a <code class="code"> UINT32 </code> property from a data
        section, the value is initially read as an <code class="code"> int32 </code> . To
        input numbers greater than 231 - 1, enter the value cast as an <code class="code">
        int </code> . <br> For example, for a value of 232, enter -1.
        <br> If you encounter this problem in the XML database, it is
        recommended that you use MySQL for DBMgr's data storage.</p></li><li><p>Entities cannot navigate across chunk boundaries where there
        exists navigation polygons at multiple heights.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e3214"></a>BigWorld Technology 1.8.2.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3217"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a client property counting problem that could lead to
        property indexes being out of sync between the client and server.
        Would usually lead to a crash in the client.</p></li><li><p>Fixed a CellApp crash caused by rapidly offloading an entity
        between four CellApps.</p></li><li><p>Fixed a bug with streaming on request messages onto packets in
        multi-packet bundles.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e3230"></a>BigWorld Technology 1.8.2.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3233"></a>1.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added <code class="code"> Entity.topSpeedY </code> to allow independent
        horizontal and vertical speed checks.</p><p>If set to a positive value, <code class="code"> Entity.topSpeed </code> will
        only check horizontal movement while <code class="code"> Entity.topSpeedY </code>
        will be used to check vertical movement.</p></li><li><p>A key file, <code class="code"> bigworld.key </code> , is now required to run
        the server.</p><p>The idea is to add a level of security and identification when
        packages are received via the new, subversion-based distribution
        process.</p></li><li><p>OpenSSL is now redistributed as part of the BigWorld package. If
        you are building a server from source mounted from a Windows box via
        CIFS, you will need to make sure the default file mask doesn't include
        the setuid bit, which it seems to by default. To get around this, add
        the following to the mount options for your Windows share:
        "file_mask=0777,dir_mask=0777".</p></li><li><p>Removed a warning message generated if the initial offset for a
        call to <code class="code"> Entity.addTimer </code> on a cell entity would have
        been less than one tick.</p><p>Note that, in this situation, the initial offset is still
        rounded up to one tick.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3270"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Removed <code class="code"> reliableByDefault </code> from <code class="code">
        defaults.xml </code> since this value is no longer read.</p></li><li><p>Reviver now binds to the network interface indicated by
        bwmachined instead of binding to all interfaces.</p></li><li><p>Fixed a bug that could cause a client's view of other entities
        to be incorrect.</p><p>When viewing another entity, it was possible for a client to
        think that the other entity was on a vehicle when it actually was not.
        This would cause that entity to appear far from its actual
        location.</p></li><li><p>Calling <code class="code"> Entity.destroy </code> inside of <code class="code"> __init__
        </code> now generates a Python exception. Previously, this would cause
        a development assertion and possibly leave the base entity in a bad
        state.</p></li><li><p>Fixed a problem that could cause the callback passed to <code class="code">
        BigWorld.connect </code> to not be called if a login attempt times
        out.</p></li><li><p>Fixed a bug that caused the pitch and roll of a vehicle to be
        incorrect when dismounting a Ripper in FantasyDemo.</p><p>When switching to <code class="code"> DumbFilter </code> , the pitch and roll
        were not initialised and could cause arbitrary values to be sent to
        the server.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e3314"></a>BigWorld Technology 1.8.2 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3317"></a>1.&nbsp;Important Notes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The column types of MySQL tables have been changed slightly in
        BigWorld 1.8.2 -- if the <code class="code"> dbMgr/syncTablesToDefs </code>
        configuration option is set to <code class="code"> false </code> , then the
        following command should be run to update the column types: <code class="code">
        dbmgr -syncTablesToDefs </code> .</p><p>Although this operation should not cause any data to be
        modified, it is still recommended to backup the database before
        attempting it.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis">
        Software Configuration With <code class="code"> bw.xml </code> -&gt; DBMgr
        Configuration Options </em> .</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3346"></a>2.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added the callbacks <code class="code"> onEnteringCell </code> , <code class="code">
        onEnteredCell </code> , <code class="code"> onLeavingCell </code> and <code class="code">
        onLeftCell </code> , which can be used to identify when a cell entity
        is transitioning between being a ghost and real entity.</p><p>For details, see the <em class="emphasis"> Client Python API
        </em> documentation.</p></li><li><p>The BaseApp no longer disconnects the client immediately on a
        <code class="code"> NO_SUCH_PORT </code> error -- it must now be sustained over the
        period specified by the <code class="code"> baseApp/noSuchPortTimeout </code>
        configuration option before the client is disconnected.</p><p>This is to prevent griefers from easily disrupting another
        client's connection. Similarly, the client will now tolerate some
        network errors, instead of disconnecting from the server immediately
        upon encountering such an error.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis">
        Software Configuration With <code class="code"> bw.xml </code> -&gt; BaseApp
        Configuration Options </em> .</p></li><li><p>The optional argument <code class="code"> shouldLoadOnServer </code> has been
        added to <code class="code"> BigWorld.addSpaceGeometryMapping </code> on the
        CellApp.</p><p>This argument specifies whether the geometry should only be
        loaded on the client, but not on the server.</p><p>For details, see the <em class="emphasis"> CellApp Python API
        </em> and <em class="emphasis"> CellApp C++ API </em>
        documentations.</p></li><li><p>Added the <code class="code"> cellApp/fastShutdown </code> configuration
        option, which allows bypassing the normal chunk unloading code when
        the system is being shut down. This considerably speeds up the
        shutdown process.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis">
        Software Configuration With <code class="code"> bw.xml </code> -&gt; CellApp
        Configuration Options </em> .</p></li><li><p>Improved the example in <code class="code">
        bigworld/src/server/baseapp/eg_tcpEcho.cpp </code> , adding a Python
        callback on reception of message.</p><p>For details, see inline comments in the source file.</p></li><li><p>Additional information is now logged when the maximum number of
        controllers per entity is exceeded.</p></li><li><p>Added support for retrieving the same watcher value from all
        components using <code class="code"> control_cluster.py get all </code> . For
        example, <code class="code"> control_cluster.py get all nub/address </code>
        .</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Admin
        Tools -&gt; Server Command-Line Utilities -&gt; <code class="code">
        control_cluster.py </code> </em> .</p></li><li><p>Added configurable warnings in <code class="code"> cellApp/profiles </code>
        to catch oversized entities.</p><p>These settings should be tuned to match your game's behaviour,
        otherwise a large number of warning messages may be issued.</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis">
        Software Configuration With <code class="code"> bw.xml </code> -&gt; CellApp
        Configuration Options </em> .</p></li><li><p>Added the following options to <code class="code"> control_cluster.py </code>
        : <code class="code"> pyprofile </code> (runtime entity script profiling), <code class="code">
        cprofile </code> (runtime engine profiling), and <code class="code"> netinfo
        </code> (network interface statistics).</p><p>For details, see the document <em class="emphasis"> Server
        Operations Guide </em> 's section <em class="emphasis"> Admin
        Tools -&gt; Server Command-Line Utilities -&gt; <code class="code">
        control_cluster.py </code> </em> .</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3504"></a>3.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The initial witnessed state of cell entities, as queried by
        <code class="code"> Entity.isWitnessed </code> , has changed to False.</p><p>Previously, entities were created assuming that they had just
        been witnessed, causing <code class="code"> Entity.onWitnessed(False) </code> to be
        called 8-12 minutes after creation (assuming no witnessing occurs in
        this period).</p><p>It has been changed so that entities are created assuming that
        they have <em class="emphasis"> not </em> been witnessed, such
        that after entity creation, <code class="code"> Entity.onWitnessed(False) </code>
        is now not called until after <code class="code"> Entity.onWitnessed(True) </code>
        has been called when the entity has been witnessed.</p><p>For details, see the <em class="emphasis"> CellApp Python API
        </em> and <em class="emphasis"> CellApp C++ API </em>
        documentations.</p></li><li><p>Added new linker option to enable binaries built using Fedora
        Core 6 to run on previous version of Fedora Core and Debian.</p></li><li><p>The last two parameters to the <code class="code"> BigWorld.addTimer </code>
        function in the CellApp have been made optional</p></li><li><p>Log files generated by MessageLogger are now time-prefixed --
        the default is <code class="code"> /var/log/bigworld/message_logger.log </code>
        .</p></li><li><p>The MySQL column type is changed to include the default value
        specification. This means that whenever the default value of a
        property is changed, the <code class="code"> syncTablesToDefs </code> operation
        must be invoked.</p><p>If a new property is added in the entity definition, then the
        new column will default to the default value instead of NULL. As MySQL
        does not support a default value specification for TEXT and BLOB
        columns, STRING properties will not have their default value included
        into the column definition. However, when adding a STRING property,
        DBMgr will manually set all values of the new column to the default
        value of the property.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3561"></a>4.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The network layer has benefited from a major overhaul, to
        achieve reliable messaging between server components on a lossy LAN
        environment.</p></li><li><p>Support for encrypted client/server channels, via a customer
        extension, has been fixed -- it involved changes to the <code class="code">
        Mercury::PacketFilter </code> interface, and the new <code class="code">
        proxyFilterData </code> string, which is passed by the client during
        login.</p></li><li><p>Reordered the calling of <code class="code"> Base.onGetCell </code> until
        after the cell entity has been informed that it should have a witness
        -- this means that calls to the cell entity made in this callback will
        arrive with the cell entity having its <code class="code"> ownClient </code>
        property set.</p></li><li><p>Offloading an entity or canceling its vision controller no
        longer causes the CellApp's <code class="code"> Entity.canBeSeen </code> attribute
        to change from True to False.</p></li><li><p>CellApp's <code class="code"> Entity.setVisionRange </code> method when
        invoked on a real entity no longer throws the exception " <code class="code">
        TypeError: This method can only be called on a real entity </code>
        ".</p></li><li><p>The BigWorld server no longer attempts to shut itself down
        multiple times when a controlled shutdown is performed if the <code class="code">
        shutDownServerOnBadState </code> configuration option is true.</p></li><li><p>Adding or deleting entities in a range trigger leave callback no
        longer crashes the CellApp (examples of range trigger leave callbacks
        include <code class="code"> Entity.onLeaveTrap </code> and <code class="code">
        Entity.onStopSeeing </code> ).</p></li><li><p>Empty SpeedTree BSPs no longer cause the server to crash.</p></li><li><p>MessageLogger and associated tools now correctly handle printing
        <code class="code"> float </code> values of NaN and +/-Infinity.</p></li><li><p>BaseApp fault tolerance now correctly updates the <code class="code">
        globalBases </code> dictionary.</p></li><li><p>Overriding a property in a <code class="code"> .def </code> file that is not
        a client/server property now works correctly.</p></li><li><p>Calling <code class="code"> *_MSG("%s", charPtr) </code> with a NULL <code class="code">
        charPtr </code> no longer causes a segfault.</p></li><li><p>Extreme load balancing situations no longer cause CellApp
        assert.</p></li><li><p>Processes created by BWMachined now have their <code class="code"> gid
        </code> correctly set.</p></li><li><p>BWMachined now handles system time going backwards.</p></li><li><p>Blank lines in <code class="code"> .bwmachined.conf </code> are now
        ignored.</p></li><li><p>Failure when deleting an entity now causes DBMgr to print an
        error message, instead of asserting.</p></li><li><p>Different spaces with the same geometries mapped no longer
        crashes navigation mesh sharing.</p></li><li><p>SpaceViewer will now run on Windows machines without the <code class="code">
        UID </code> environment variable being set.</p></li><li><p>The Python attribute <code class="code"> Entity.ownClient </code> on the
        CellApp is now documented.</p></li><li><p>LogViewer now automatically exits the Live Output mode when a
        fetch is issued.</p></li><li><p>Server tools now report a failure to start a singleton process
        (such as CellAppMgr) if the new process did not replace an existing
        one.</p></li><li><p>The <code class="code"> bw.xml </code> configuration option <code class="code">
        baseApp/externalInterface </code> is now read instead of <code class="code">
        baseApp/extInterface </code> .</p></li><li><p>Resolved an issue using ccache to build server, which was caused
        by <code class="code"> src/lib/network/Makefile </code> and <code class="code">
        bigworld/src/server/cellapp/Makefile </code> custom <code class="code"> .o </code>
        targets overwriting <code class="code"> .d </code> files -- note that ccache is
        installed by default on FC7.</p></li><li><p>A revived CellAppMgr is now immediately notified of a BaseApp.
        This is needed to allow new CellApps to start.</p></li><li><p>When retiring a cell, the cell taking over the area of the
        retiring cell now ensures that it has loaded the chunks in the new
        area before taking over.</p></li><li><p>Added database schema verification to WebConsole, to allow table
        changes between releases if necessary.</p></li><li><p>Renamed WebConsole database columns from <code class="code"> uid </code> to
        <code class="code"> user </code> , to work around a bug in some releases of
        SQLObject.</p></li><li><p>Resolved a template inheritance issue in WebConsole that
        prevented it from working on newer versions of TurboGears.</p></li><li><p>Fixed a bug with entities navigating to edges of chunks for
        which those chunks adjacent to that edge may not be loaded yet. A
        warning message is issued.</p></li><li><p>Fixed potential CellApp crash when forwarding a message destined
        for the real entity from a ghost cell entity. The forwarded message
        was added to the stream incorrectly.</p></li><li><p>Implemented better handling of a rare race-condition where
        certain events from the real entity propagating to the ghost entity
        were arriving out-of-order in the presence of packet loss and when an
        entity cell was being offloaded to another cell. This was causing an
        assertion to fail. These particular message events are now being
        buffered and replayed.</p><p>New watchers in CellApp have been added to monitor this
        situation. They are: </p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> stats/numBufferedHistoryEvents </code> : the total
              number of application-wide buffered messages that are
              pending</p></li><li><p><code class="code"> stats/numBufferedHistoryEventsEver </code> : the
              total number of application-wide messages that we have ever
              buffered in this application's lifetime</p></li></ul></div></li><li><p>Fixed problem that could cause a space to be deleted
        prematurely. This could have occurred when offloading a small space to
        a new CellApp.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3761"></a>5.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> Nub::cancelTimers() </code> cannot be called from within
        <code class="code"> handleTimeout </code> to cancel the current timer. Use <code class="code">
        Nub::cancelTimer() </code> instead.</p></li><li><p>When loading a space on a CellApp, the <code class="code"> space.settings
        </code> file is accessed. If this is not currently loaded, this causes
        disk access in the main thread. This may cause the CellApp to timeout
        if disk access is slow.</p><p>To work around this, it is recommended that you load and store
        all possible <code class="code"> space.settings </code> files when CellApps start.
        See <code class="code"> onInit </code> in
        fantasydemo/res/entities/cell/FantasyDemo.py for an example.</p></li><li><p>The XML database has many limitations that preclude its use in a
        production system. <br> It is not recommended for serious
        development work, as some of its limitations may be time-consuming to
        work around. <br> The limitations are listed below:</p><div class="itemizedlist"><ul type="circle"><li><p>There is single namespace for all entities. <br> Entities
            with an <code class="code"> &lt;Identifier&gt; </code> property must ensure
            that its value is unique amongst all entities. <br> In
            contrast, the MySQL database implements a separate namespace for
            each entity type, so that it is sufficient to ensure only that the
            <code class="code"> &lt;Identifier&gt; </code> property is unique amongst all
            entities of the same type</p></li><li><p>There is no equivalent of the <code class="code"> bigworldLogOnMapping
            </code> table feature.</p></li><li><p>Support for the following configuration options is not
            implemented correctly:</p><div class="itemizedlist"><ul type="square"><li><p><code class="code"> dbMgr/createUnknown </code></p></li><li><p><code class="code"> dbMgr/rememberUnknown </code></p></li><li><p><code class="code"> dbMgr/loadUnknown </code></p></li></ul></div><p>The <code class="code"> dbMgr/loadUnknown </code> option is always true.
            <br> If <code class="code"> dbMgr/createUnknown </code> is true, then <code class="code">
            dbMgr/rememberUnknown </code> is automatically also true.</p></li><li><p>Support for disaster recovery is not implemented.</p></li></ul></div></li><li><p>There is a known memory leak in Macromedia Flash's server
        communication library used by StatGrapher. <br> If StatGrapher is
        run continuously for many days, then the browser might consume large
        amounts of memory. <br> The workaround is to refresh the page when
        memory usage becomes noticeably large.</p></li><li><p>Server components cannot cope with variable CPU speeds. <br>
        Running the server on a CPU with SpeedStep technology can cause the
        server's timer to be incorrect. If this occurs, need to set <code class="code">
        [TimingMethod] </code> to <code class="code"> gettimeofday </code> in <code class="code">
        /etc/bwmachined.conf </code> .</p></li><li><p>Any comments added to the default configuration files (such as
        <code class="code"> message_logger.conf </code> and <code class="code"> /etc/bigworld.conf
        </code> ) are lost when updated through the install script.</p></li><li><p>When using the Adblock extension to Firefox, the StatGrapher
        display can appear compressed. <br> To work around this issue,
        disable the Adblock extension.</p></li><li><p>When reading a <code class="code"> UINT32 </code> property from a data
        section, the value is initially read as an <code class="code"> int32 </code> . To
        input numbers greater than 231 - 1, enter the value cast as an <code class="code">
        int </code> . <br> For example, for a value of 232, enter -1.
        <br> If you encounter this problem in the XML database, it is
        recommended that you use MySQL for DBMgr's data storage.</p></li><li><p>Entities cannot navigate across chunk boundaries where there
        exists navigation polygons at multiple heights.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e3903"></a>BigWorld Technology 1.8.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3906"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> BigWorld.reloadScript </code> now has the option to skip
        reloading the entity definitions, to speed up the operation.
        <br></p><p>Documented in <em class="emphasis"> CellApp Python API
        </em> reference guide, entry <em class="emphasis">
        Modules-&gt;BigWorld </em> .</p></li><li><p>Added the special tag <code class="code"> TimingMethod </code> to <code class="code">
        /etc/bwmachined.conf </code> . <br> It can be used to select
        between using RDTSC and <code class="code"> gettimeofday </code> for timing. This
        only works for processes started by BWMachined -- if you are running
        server processes via BWPanel or the console, setting the <code class="code">
        BW_TIMING_METHOD </code> environment variable has the same effect.
        <br></p><p>Documented in <em class="emphasis"> Server Installation Guide
        </em> , section <em class="emphasis"> Installing the BigWorld
        Server-&gt;Installing BWMachined-&gt;Create <code class="code"> bwmachined.conf
        </code> files-&gt; <code class="code"> /etc/bwmachined.conf </code> and <code class="code">
        TimingMethod </code> </em> .</p></li><li><p>Added the root-level configuration option <code class="code">
        shutDownServerOnBadState </code> , which controls whether a controlled
        shutdown will be done when it is detected that the server is in a bad
        state. <br> At the moment, this includes failure to restore base
        entities after a BaseApp death, and the death of all CellApps. This
        configuration option is set to <code class="code"> true </code> by default.
        <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , section <em class="emphasis"> Server Configuration with
        <code class="code"> bw.xml </code> -&gt;General Configuration Options </em>
        .</p></li><li><p>BWMachined can now be restarted whilst child processes are still
        running, and the table of processes will be preserved. <br> This
        avoids the problem of having to shut down all servers before being
        able to update BWMachined on a particular machine.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3987"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Mercury now supports piggybacking dropped packets on ordered
        channels to the client. <br> Previously, ordered channels had to
        resend dropped packets whole, and could not utilise spare space at the
        end of outgoing packets under MTU size.</p></li><li><p>DBMgr will now exit after updating the database if <code class="code">
        -syncTablesToDefs </code> or <code class="code"> -upgrade </code> is specified on
        the command line.</p></li><li><p>The XML database now behaves more like the MySQL database, for
        example: </p><div class="itemizedlist"><ul type="circle"><li><p>Each entity type now has its own namespace. <br>
              Previously, entities with an <code class="code"> &lt;Identifier&gt; </code>
              property had to ensure that their value was unique amongst all
              entities. <br> Now, the entity's identifier is required to be
              unique only amongst entities of the same type.</p></li><li><p>Added an equivalent of <code class="code"> bigworldLogOnMapping </code>
              table.</p></li><li><p>The following options are now implemented correctly:
              </p><div class="itemizedlist"><ul type="square"><li><p><code class="code"> dbMgr/createUnknown </code></p></li><li><p><code class="code"> dbMgr/rememberUnknown </code></p></li><li><p><code class="code"> dbMgr/loadUnknown </code></p></li></ul></div><p>Previously, the <code class="code"> dbMgr/loadUnknown </code> option
              was always <code class="code"> true </code> , and <code class="code">
              dbMgr/rememberUnknown </code> was automatically set to true if
              <code class="code"> dbMgr/createUnknown </code> was also <code class="code"> true </code>
              .</p></li></ul></div></li><li><p>TurboGears installation instructions in the <em class="emphasis"> Server Tools Installation Guide </em> have been
        changed to only reference installation via the re-distributed
        TurboGears packages. This is due to a known bug with the official
        TurboGears 1.0.1 packages that causes WebConsole to fail.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4064"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a fairly serious bug in the DBMgr when multi-threading is
        enabled and the MySQL server is under heavy load. Under some
        circumstances, it can cause ARRAY of ARRAY data to be dropped or
        swapped. For example: </p><div class="itemizedlist"><ul type="circle"><li><p>[ [1,2], [3,4,5] ] -&gt; [ [3,4,5], [1,2] ]</p></li><li><p>[ [1,2], [3,4,5] ] -&gt; [ [], [1,2] ]</p></li></ul></div><p>This bug affects any combination of types that maps to two or
        more levels of sub-tables. For example, ARRAY of FIXED_DICT with a
        TUPLE member.</p></li><li><p>Fixed a bug that caused a broadcast storm when <code class="code">
        BigWorld.setSpaceData </code> was called multiple times with the same
        key, in rapid succession.</p></li><li><p>Setting an entity's position to an invalid position now causes a
        Python exception, instead of a CellApp assert.</p></li><li><p>Improved the chunk loading speed for CellApps.</p></li><li><p>Fixed a bug with <code class="code"> Entity.addYawRotator </code> where the
        turn could occur in the wrong direction.</p></li><li><p>Fixed <code class="code"> message_logger </code> 's parsing code for <code class="code">
        /etc/bigworld.conf </code> to handle blank lines midway through a
        configuration section.</p></li><li><p>Fixed navigation mesh sharing, which was causing crashes in the
        case of different spaces with the same geometries mapped.</p></li><li><p>Fixed bug with base entity <code class="code"> cellData['position'] </code>
        and <code class="code"> cellData['direction'] </code> initially referencing the
        same Vector3 object.</p></li><li><p>The WatcherData class in <code class="code">
        bigworld/tools/server/pycommon/cluster.py </code> will now correctly
        compare against <code class="code"> None </code> instead of raising an
        exception.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e4128"></a>BigWorld Technology 1.8 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4131"></a>1.&nbsp;Important Notes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>MySQL databases created by BigWorld 1.7 must be upgraded to work
        correctly with BigWorld 1.8. <br> Before starting the new server,
        backup your database and run: </p><pre class="programlisting">
            dbmgr -upgrade
          </pre></li><li><p>GCC 4.1 is now the recommended compiler for building BigWorld
        server. The object files included in this release are built using GCC
        4.1. <br> To avoid compatibility problems, we recommend to build
        GCC 4.1 using the default build configuration from source downloaded
        from GNU's GCC site.</p></li><li><p>BigWorld now includes all standard Python modules. <br> They
        are located in <code class="code"> bigworld/res/entities/common/Lib </code> (and
        <code class="code"> bigworld/res/entities/common/lib-dynload </code> on Linux).
        <br> If you have added any standard Python modules to the resource
        tree of your game, then it is recommended that you remove them, in
        order to avoid conflicts with the modules that are now included with
        BigWorld 1.8. <br> For example, in FantasyDemo, standard modules in
        <code class="code"> fantasydemo/res/entities/common/Lib </code> and <code class="code">
        fantasydemo/res/entities/common/lib-dynload </code> have been
        removed.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4168"></a>2.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The server tools have been significantly improved -- most of
        them now have web-based equivalents, and are integrated together to
        form the WebConsole. <br> </p><div class="itemizedlist"><ul type="circle"><li><p>BWPanel and Server Viewer have been replaced by
              ClusterControl. <br> Note that BWPanel is still
              supported.</p></li><li><p>Server statistics are now continually logged by
              StatLogger.</p></li><li><p>GMeter has been replaced by StatGrapher and StatLogger.
              <br> StatGrapher offers a more intuitive UI for viewing
              historical and current statistics at different time
              resolutions.</p></li><li><p><code class="code"> bwlogger </code> has been replaced by
              MessageLogger. <br> The log format has also been changed to
              binary, in order to reduce disk space usage and improve search
              performance.</p></li><li><p>New Web-based Python console.</p></li><li><p><code class="code"> bw_log_viewer.cgi </code> has been replaced by
              LogViewer. <br> LogViewer has a better search interface, and
              the ability to save search settings.</p></li><li><p>Watcher web interface is now part of WebConsole's
              ClusterControl module.</p></li></ul></div><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Admin Tools </em> chapter,
        section <em class="emphasis"> WebConsole </em> .</p></li><li><p>New commands have been added to <code class="code"> control_cluster.py
        </code> . <br> Please see the <code class="code"> --help </code> for a full list
        of commands. <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Admin Tools </em> chapter,
        section <em class="emphasis"> Server Command-Line Utilities
        </em> , <em class="emphasis"> <code class="code"> control_cluster.py </code>
        </em> .</p></li><li><p>New script <code class="code"> setup_win_dev.py </code> was created, for easy
        setup of a shared Windows-Linux BigWorld deployment for game
        programmers and artists. <br> This allows primarily Windows-based
        developers to run a Linux BigWorld server that reads game script and
        assets from their Windows box. <br> The script is located on <code class="code">
        bigworld/tools/server/install </code> . <br></p><p>Documented in <em class="emphasis"> Client Programming Guide
        </em> , <em class="emphasis"> Simplified Server Usage
        </em> chapter.</p></li><li><p>Added option to tweak the collision detection algorithm for
        speed <em class="emphasis"> vs. </em> size. <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Software Configuration with
        <code class="code"> bw.xml </code> </em> chapter, section <em class="emphasis"> CellApp Configuration Options </em> , entry
        <em class="emphasis"> <code class="code"> obstacleTreeDepth </code> </em>
        .</p></li><li><p>Added option to backup base entities to other (non-backup)
        BaseApps. <br> When a BaseApp fails, its entities are redistributed
        to the remaining ones. All clients connected to the failed BaseApp
        will be disconnected. <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Software Configuration With
        <code class="code"> bw.xml </code> </em> chapter, section <em class="emphasis"> BaseAppMgr Configuration Options </em> , entries
        <em class="emphasis"> <code class="code"> useNewStyleBackup </code> </em>
        and <code class="code"> <em class="emphasis"> baseAppTimeout </em> </code>
        .</p></li><li><p>Added option to restrict the <em class="emphasis"> backup BaseApps
        </em> to only perform the backup of BaseApps on its own machine.
        <br> This removes the need to change the IP address of the backup
        BaseApp machine during a fail-over. <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Software Configuration With
        <code class="code"> bw.xml </code> </em> chapter, section <em class="emphasis"> BaseAppMgr Configuration Options </em> , entry
        <em class="emphasis"> <code class="code"> onlyUseBackupOnSameMachine </code>
        </em> .</p></li><li><p>Added support for client-only entities. <br> These entities
        are distinguished by their lack of base and cell scripts.
        <br></p><p>Documented in <em class="emphasis"> Client Programming Guide
        </em> , <em class="emphasis"> Entities </em> chapter,
        section <em class="emphasis"> Entities Are Python Script Objects
        </em> .</p></li><li><p>Create callback <code class="code">
        BWPersonality-&gt;onAllSpaceGeometryLoaded </code> , invoked when all
        cells participating in a space have loaded the geometry for their
        area. <br></p><p>Documented in <em class="emphasis"> CellApp Python API
        </em> reference guide.</p></li><li><p>Created <code class="code"> BigWorld-&gt;lookUpDBIDByName </code> function,
        which retrieves an entity's database ID by its name. <br></p><p>Documented in <em class="emphasis"> BaseApp Python API
        </em> reference guide.</p></li><li><p>Improved support for debugging the common mistake of adding
        controllers without stopping an existing one. <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Software Configuration With
        <code class="code"> bw.xml </code> </em> chapter, section <em class="emphasis"> CellApp Configuration Options </em> , entries
        <em class="emphasis"> <code class="code"> maxControllersExpected </code>
        </em> and <em class="emphasis"> <code class="code"> maxControllersAbsolute
        </code> </em> .</p></li><li><p>Added callback <code class="code"> BWPersonality.onProxyDataDownloadComplete
        </code> , invoked when Proxy data download is complete. <br></p><p>Documented in <em class="emphasis"> Client Python API
        </em> reference guide.</p></li><li><p>Added an example in FantasyDemo of a moving platform that can
        transport players. <br></p><p>Documented in <em class="emphasis"> How to Build a
        Server-Controlled Moving Platform </em> .</p></li><li><p>Navmesh data is now shared between instances of the same space.
        <br> This reduces the memory usage when there are many instances of
        the same space.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4458"></a>3.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Python 2.5 is now integrated into BigWorld. <br> See
        Python.org's What's new in Python 2.5.</p></li><li><p>Python garbage collection is now disabled by default, in order
        to prevent pauses. <br> This was mistakenly re-enabled in the
        previous release.</p></li><li><p>Support for original callback type for <code class="code">
        BigWorld.executeRawDatabaseCommand() </code> was dropped. <br> Only
        the new callback type introduced in BigWorld 1.7.2 is supported.
        <br></p><p>Documented in <em class="emphasis"> BaseApp Python API
        </em> reference guide.</p></li><li><p>The parameters provided to the callback argument associated with
        the functions below have changed: </p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> BigWorld.createBaseFromDB() </code></p></li><li><p><code class="code"> BigWorld.createBaseFromDBID() </code></p></li><li><p><code class="code"> BigWorld.createBaseLocallyFromDB() </code></p></li><li><p><code class="code"> BigWorld.createBaseLocallyFromDBID() </code></p></li><li><p><code class="code"> BigWorld.createBaseRemotelyFromDB() </code></p></li><li><p><code class="code"> BigWorld.createBaseRemotelyFromDBID()
              </code></p></li><li><p><code class="code"> BigWorld.createBaseAnywhereFromDB() </code></p></li><li><p><code class="code"> BigWorld.createBaseAnywhereFromDBID()
              </code></p></li></ul></div><p>The behaviour of these functions has also changed slightly --
        previously, if the entity was already active, these functions would
        return <code class="code"> None </code> , indicating that the operation had failed.
        <br> Now, these functions return a mailbox to the active entity,
        and a separate Boolean flag indicating that the entity was already
        active. <br></p><p>Documented in <em class="emphasis"> BaseApp Python API
        </em> reference guide.</p></li><li><p>Functions that return a <code class="code"> PyVector </code> now return a
        reference to the underlying <code class="code"> PyVector </code> or a read-only
        copy. <br> Previously, a writable copy of the <code class="code"> PyVector
        </code> was returned, and it was a common mistake to modify the copy
        when the intention was to modify the original.</p></li><li><p><code class="code"> PyVector </code> s that represent colours now have
        members <code class="code"> red </code> , <code class="code"> green </code> , <code class="code"> blue
        </code> , and, optionally, <code class="code"> alpha </code> to improve code
        readability.</p></li><li><p>Non-responsive BaseApps will be terminated with a SIGQUIT
        signal. <br></p><p>Documented in <em class="emphasis"> Server Operations Guide
        </em> , <em class="emphasis"> Software Configuration With
        <code class="code"> bw.xml </code> </em> chapter, section <em class="emphasis"> BaseAppMgr Configuration Options </em> , entry
        <em class="emphasis"> <code class="code"> hardKillDeadBaseApps </code> </em>
        .</p></li><li><p>The <code class="code"> dbMgr/nameProperty </code> configuration option has
        been deprecated. <br> The name property of an entity is now
        specified by adding the <code class="code"> &lt;Identifier&gt; true
        &lt;/Identifier&gt; </code> tag to a property in the entity definition
        file. <br> This allows for each entity type to have a different
        name property, but there is still a limit of one name property per
        entity type. <br></p><p>Documented in <em class="emphasis"> Server Programming Guide
        </em> , <em class="emphasis"> The Database Layer </em>
        chapter, section <em class="emphasis"> Persistent properties
        </em> , <em class="emphasis"> The <code class="code"> Identifier </code> tag
        </em> .</p></li><li><p>The default <code class="code"> &lt;DatabaseLength&gt; </code> of an entity
        property has been increased from 255 to 65535.</p></li><li><p>The mapping of STRING, BLOB and PYTHON types to MySQL column
        types has changed: </p><div class="altrow"><table border="0"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>BigWorld type (DatabaseLength)</th><th>Previous MySQL column type</th><th>New MySQL column type</th></tr></thead><tbody><tr><td><code class="code"> STRING </code> (less than 255)</td><td>
                    <code class="code">VARCHAR</code>
                  </td><td>
                    <code class="code">VARCHAR</code>
                  </td></tr><tr><td><code class="code"> STRING </code> (between 256 and 65535)</td><td>
                    <code class="code">BLOB</code>
                  </td><td>
                    <code class="code">TEXT</code>
                  </td></tr><tr><td><code class="code"> STRING </code> (between 65536 and
                  16777215)</td><td>Not supported</td><td>
                    <code class="code">MEDIUMTEXT</code>
                  </td></tr><tr><td><code class="code"> BLOB </code> and <code class="code"> PYTHON </code> (less
                  than 255)</td><td>
                    <code class="code">VARCHAR</code>
                  </td><td>
                    <code class="code">TINYBLOB</code>
                  </td></tr><tr><td><code class="code"> BLOB </code> and <code class="code"> PYTHON </code>
                  (between 256 and 65535)</td><td>
                    <code class="code">BLOB</code>
                  </td><td>
                    <code class="code">BLOB</code>
                  </td></tr><tr><td><code class="code"> BLOB </code> and <code class="code"> PYTHON </code>
                  (between 65536 and 16777215)</td><td>Not supported</td><td>
                    <code class="code">MEDIUMBLOB</code>
                  </td></tr></tbody></table></div><p> </p><p> Documented in <em class="emphasis"> Server
        Programming Guide </em> , <em class="emphasis"> The Database
        Layer </em> chapter, section <em class="emphasis"> Mapping
        Bigworld Properties Into SQL </em> . </p></li><li><p>The watcher <code class="code"> python server port </code> has been renamed
        to <code class="code"> pythonServerPort </code> on both the BaseApp and
        CellApp.</p></li><li><p>Base and cell entities are now destroyed during shutdown.</p></li><li><p>Movement controllers have been made exclusive. <br> At most
        one movement controller per entity can be active at any time. <br>
        If a new movement controller is added, then the previous one (if any)
        is stopped.</p></li><li><p>The client now sends a <em class="emphasis"> disconnect </em> message
        to the server when <code class="code"> BigWorld.disconnect() </code> is called.
        <br> The message will cause the <code class="code"> Proxy.onClientDeath()
        </code> callback to be invoked on the server. <br> Previously, this
        would be done manually in script or, alternatively, the server would
        be left to timeout.</p></li><li><p>The server now sends a <em class="emphasis"> disconnect </em> message
        to the client when the Proxy is destroyed. <br> Previously this
        would be done manually in script or, alternatively, the client would
        be left to timeout.</p></li><li><p>CellApp's <code class="code"> BigWorld.collide() </code> method now returns
        the material type of the hit triangle. <br></p><p>Documented in <em class="emphasis"> CellApp Python API
        </em> reference guide.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4804"></a>4.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Backup BaseApps are now informed of a system shutdown, so that
        they no longer try to restore a BaseApp that has been shut
        down.</p></li><li><p>Several fixes were made to XML data sections: </p><div class="itemizedlist"><ul type="circle"><li><p>Reserved characters are now escaped when they are written
              to a file.</p></li><li><p>Comments at beginning of an XML file no longer cause the
              entire file to be treated as an empty file.</p></li><li><p>XML declarations ( <em class="emphasis"> e.g. </em> , <code class="code">
              &lt;?xml version="1.0"?&gt; </code> ) are now ignored, instead
              of being treated as a tag.</p></li><li><p>Trailing spaces in tag names are now ignored.</p></li></ul></div></li><li><p>Fixed a bug where the game time was restored too late during
        crash recovery. <br> This meant that timers set during the recovery
        process would be called a great number of times when the game was
        started.</p></li><li><p>Fixed bug where BaseAppMgr created too many timers while
        recovering a crashed BaseApp.</p></li><li><p>BaseApp backups now will retry five times when they fail to bind
        to the port of a recently dead BaseApp.</p></li><li><p>Fixed bug in BWMachined where CPU statistics were calculated
        incorrectly for SMP systems.</p></li><li><p>Reduced the time window after cell entity creation where the
        cell entity does not have any backup data on the base. <br> If the
        CellApp crashes while in this window, then the cell entity is
        lost.</p></li><li><p>Reduced log spamming that was caused by Mercury errors.</p></li><li><p>Database IDs assigned by the XML database are now persistent
        across server restarts. <br> Previously, all entities were assigned
        new database IDs when the server was restarted.</p></li><li><p>Fixed a memory leak that occurred when a chunk was ejected
        before it was fully loaded.</p></li><li><p>Fixed a bug where the Python built-in <code class="code"> execfile </code>
        function could not find the specified file.</p></li><li><p>Fixed a crash that occurred when opening a file using the Python
        built-in <code class="code"> file </code> function.</p></li><li><p>Fixed a bug where Python exceptions were not logged if they
        occurred inside a callback function.</p></li><li><p>A ghost entity now remains for a short period of time after an
        entity has been teleported to another space, in order to forward any
        messages destined for that entity.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4881"></a>5.&nbsp;Known Bugs &amp; Limitations</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The XML database has many limitations that preclude its use in a
        production system. <br> It is not recommended for serious
        development work, as some of its limitations may be time-consuming to
        work around. <br> The limitations are listed below: </p><div class="itemizedlist"><ul type="circle"><li><p>There is single namespace for all entities. <br>
              Entities with an <code class="code"> &lt;Identifier&gt; </code> property must
              ensure that its value is unique amongst all entities. <br> In
              contrast, the MySQL database implements a separate namespace for
              each entity type, so that it is sufficient to ensure only that
              the <code class="code"> &lt;Identifier&gt; </code> property is unique amongst
              all entities of the same type</p></li><li><p>There is no equivalent of the <code class="code"> bigworldLogOnMapping
              </code> table feature.</p></li><li><p>Support for the following configuration options is not
              implemented correctly:</p><div class="itemizedlist"><ul type="square"><li><p>
                    <code class="code">dbMgr/createUnknown</code>
                  </p></li><li><p>
                    <code class="code">dbMgr/rememberUnknown</code>
                  </p></li><li><p>
                    <code class="code">dbMgr/loadUnknown</code>
                  </p></li></ul></div><p>The <code class="code"> dbMgr/loadUnknown </code> option is always
              true. <br> If <code class="code"> dbMgr/createUnknown </code> is true,
              then <code class="code"> dbMgr/rememberUnknown </code> is automatically also
              true.</p></li><li><p>Support for disaster recovery is not implemented.</p></li></ul></div></li><li><p>There is a known memory leak in Macromedia Flash's server
        communication library used by StatGrapher. <br> If StatGrapher is
        run continuously for many days, then the browser might consume large
        amounts of memory. <br> The workaround is to refresh the page when
        memory usage becomes noticeably large.</p></li><li><p>Restarting BWMachined causes loss of registered components.
        <br> MessageLogger registers itself with BWMachined at startup --
        this registration is lost if BWMachined is restarted, causing server
        component started after this to not log. <br> Similarly, server
        components started before the restart will no longer be registered,
        and will no longer be displayed in tools.</p></li><li><p>Setting the system clock to an earlier time may cause StatLogger
        to crash.</p></li><li><p>LogViewer treats the last field as milliseconds. <br> In the
        <em class="emphasis"> Time </em> field of LogViewer, <code class="code"> Wed
        06 Dec 2006 10:57:00.84 </code> and <code class="code"> Wed 06 Dec 2006
        10:57:00.084 </code> are treated the same.</p></li><li><p>Server components cannot cope with variable CPU speeds. <br>
        Running the server on a CPU with SpeedStep technology can cause the
        server's timer to be incorrect.</p></li><li><p>Any comments added to the default configuration files (such as
        <code class="code"> message_logger.conf </code> and <code class="code"> /etc/bigworld.conf
        </code> ) are lost when updated through the install script.</p></li><li><p>When using the Adblock extension to Firefox, the StatGrapher
        display can appear compressed. <br> To work around this issue,
        disable the Adblock extension.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5000"></a>6.&nbsp;Deprecated Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The use of the <code class="code"> MF_ROOT </code> and <code class="code"> BW_RES_PATH
        </code> environment variables is now discouraged, and support may be
        removed in a future release. </p><div class="itemizedlist"><ul type="circle"><li><p>BigWorld Server and server tools now read <code class="code"> MF_ROOT
              </code> and <code class="code"> BW_RES_PATH </code> from the <code class="code">
              .bwmachined.conf </code> file in the user's home
              directory.</p></li><li><p>Makefiles have been updated to use relative paths.</p></li><li><p>If the <code class="code"> MF_ROOT </code> or <code class="code"> BW_RES_PATH
              </code> environment variables are set, then they still take
              precedence over the other ways of locating files. <br>
              However, we recommend that they are left unset, as we may remove
              this feature in a future release.</p></li></ul></div></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e5040"></a>BigWorld Technology 1.7.2 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5043"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Improved support for BaseApp load balancing with additional API
        functions to load an entity from the database and create it on a
        remote BaseApp. <br> See <em class="emphasis"> BaseApp Python API
        Documentation </em> , entries:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">
            Modules-&gt;BigWorld-&gt;createBaseAnywhereFromDB
            </em></p></li><li><p><em class="emphasis">
            Modules-&gt;BigWorld-&gt;createBaseAnywhereFromDBID
            </em></p></li><li><p><em class="emphasis">
            Modules-&gt;BigWorld-&gt;createBaseRemotelyFromDB
            </em></p></li><li><p><em class="emphasis">
            Modules-&gt;BigWorld-&gt;createBaseRemotelyFromDBID
            </em></p></li></ul></div></li><li><p>It is now possible for an entity to determine whether it is
        being witnessed. This can be used, for example, to suspend NPCs that
        are not visible to players in order to lower the system load. <br>
        See <em class="emphasis"> CellApp Python API Documentation
        </em> , entry <em class="emphasis"> Class
        List-&gt;Entity-&gt;onWitnessed </em> .</p></li><li><p>DBMgr support for automatically switching to another MySQL
        database if it loses connection to the current one. The backup MySQL
        database is assumed to be an up to date replica of the primary
        database. <br> Configuration syntax: <br></p><pre class="programlisting">
          
          
          
 &lt;dbMgr&gt;
   &lt;backupDatabases&gt;
     &lt;tagname&gt;
       &lt;host&gt; 
          
          
          <em class="emphasis">
            
            
            hostname
          
          
          </em>
          
          
           &lt;/host&gt;
         &lt;username&gt; 
          
          
          <em class="emphasis">
            
            
            username
          
          
          </em>
          
          
                &lt;/username&gt;
         &lt;password&gt; 
          
          
          <em class="emphasis">
            
            
            password
          
          
          </em>
          
          
                &lt;/password&gt;
         &lt;name&gt;     
          
          
          <em class="emphasis">
            
            
            database_name
          
          
          </em>
          
          
           &lt;/name&gt;
     &lt;/tagname&gt;
   &lt;/backupDatabases&gt;
 &lt;/dbMgr&gt;
        
        
        </pre><p>More than one backup database may be specified but they must
        have a unique <code class="code"> &lt;tagname&gt; </code> . DBMgr will connect to
        them in the order listed. When the last backup database fails, DBMgr
        will then try to connect to the primary database again and so on.
        Settings are also inherited from the primary database so if, for
        example, <code class="code"> &lt;username&gt; </code> and <code class="code"> &lt;password&gt;
        </code> are not specified then the username and password from the
        primary database is used. This also applies to <code class="code"> &lt;host&gt;
        </code> and <code class="code"> &lt;name&gt; </code> . <br> See <em class="emphasis"> Server Operations Guide </em> , section <em class="emphasis"> Software Configuration with <code class="code"> bw.xml </code>
        </em> , <em class="emphasis"> DBMgr Configuration Options
        </em> .</p></li><li><p>New watchers <code class="code"> nub/receive queue max </code> and <code class="code">
        nub/transmit queue max </code> that show the maximum receive and
        transmit queues of a process.</p></li><li><p>New callback when a portal configuration is changed. <br> See
        <em class="emphasis"> CellApp Python API Documentation </em> ,
        entry <em class="emphasis"> Class List-&gt;
        Entity-&gt;onPortalConfigChange </em> .</p></li><li><p>New configuration option <code class="code"> baseApp/dbRequestTimeout </code>
        to specify the timeout for all database operations. This configuration
        setting is in seconds. The default is 10.</p></li><li><p>Ability to specify default values for types in alias.xml. The
        &lt;Default&gt; section should appear under the type alias section.
        For example:</p><pre class="programlisting">
          
          
          
 &lt;MONEY&gt; INT32 &lt;Default&gt; 100 &lt;/Default&gt; &lt;/MONEY&gt;

 &lt;BASICPLAYER&gt;
   FIXED_DICT
   &lt;Properties&gt;
     &lt;name&gt;  &lt;Type&gt; STRING &lt;/Type&gt; &lt;/name&gt;
     &lt;model&gt; &lt;Type&gt; INT8   &lt;/Type&gt; &lt;/model&gt;
   &lt;/Properties&gt;
   &lt;Default&gt;
     &lt;name&gt;  BigWorld &lt;/name&gt;
     &lt;model&gt; 1        &lt;/model&gt;
   &lt;/Default&gt;
 &lt;/BASICPLAYER&gt;
        
        
        </pre><p><br> The syntax for the default value is identical to the one
        used in entity definitions. <br> See <em class="emphasis"> Server
        Programming Guide </em> , section <em class="emphasis">
        Properties </em> .</p></li><li><p><code class="code"> BigWorld.executeRawDatabaseCommand() </code> now supports
        a different type of callback where it provides the result in a Python
        list eliminating the need for script writers to decode the raw data.
        <br> See <em class="emphasis"> BaseApp Python API Documentation
        </em> , entry <em class="emphasis"> Modules-&gt;
        BigWorld-&gt;executeRawDatabaseCommand </em> .</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5189"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> Proxy.onClientDeath() </code> is now called when a Proxy
        has timed out waiting for its client to connect. It is now up to
        script to destroy the Proxy. Previously, the Proxy was destroyed
        without receiving any callbacks.</p></li><li><p>Exposed the time delta to custom physics validators so that
        speed related validation can be done.</p></li><li><p>Increased the maximum <code class="code"> &lt;DatabaseLength&gt; </code> for
        <code class="code"> STRING </code> , <code class="code"> BLOB </code> and <code class="code"> PYTHON </code>
        types from 64KB to 16MB.</p></li><li><p>Increased maximum size of <code class="code">
        BigWorld.executeRawDatabaseCommand() </code> message from 64KB to
        16MB.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5222"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed an occasional assert in DBMgr when it looses connection to
        MySQL server.</p></li><li><p>Fixed a BaseApp crash on shutdown when an <code class="code"> ARRAY </code>
        of wrapped <code class="code"> FIXED_DICT </code> objects is used.</p></li><li><p>Fixed a problem with <code class="code"> BigWorld.createEntityOnBaseApp()
        </code> after <code class="code"> BigWorld.reloadScript() </code> has been
        called.</p></li><li><p>Fixed an assert if an entity is destroyed in its <code class="code">
        __init__() </code> method.</p></li><li><p>Fixed a pathing problem with indoor chunks.</p></li><li><p>Staggered responses from bwmachined to avoid switch flooding on
        large clusters.</p></li><li><p>Fixed BaseApp deadlock while Proxy data is being
        transferred.</p></li><li><p>Turned on reliability for many messages in order to better cope
        with packet losses.</p></li><li><p>Fixed a bug when the number of ACKs sent in a message exceeded
        255. This bug caused some ACKs to be lost, eventually causing an
        assert when the buffer for unACK'ed messages overflowed.</p></li><li><p>Better handling of multiple simultaneous CellApp
        failures.</p></li><li><p>Fixed some portal configuration bugs.</p></li><li><p>Fixed a BaseApp crash if a Proxy is destroyed before the first
        message from its client arrives. When the first message arrives, the
        BaseApp crashes trying to access the destroyed Proxy.</p></li><li><p>Reduced likelihood of entity messages being lost if they arrive
        at a cell after the target entity has been offloaded. Ghosts are now
        kept around to forward messages to the real entity for a short period
        of time after the entity has been offloaded.</p></li><li><p>Reduced likelihood of entity messages being lost if they arrive
        out of order at a cell prior to the target entity being unloaded.
        Messages for non-existent entities are now buffered for a short period
        of time and replayed to the entity when it finally arrives.</p></li><li><p>Fixed many messages that did not respect the <code class="code">
        reliableByDefault </code> configuration option.</p></li><li><p>Fixed some portal search problems.</p></li><li><p>Better handling of case where DBMgr thinks an entity is
        checked-out but there is no corresponding base entity. This situation
        can be the result of a timeout during the process of loading the
        entity from the database. During a login attempt, DBMgr will now
        create the base entity instead of returning an error if it fails to
        find the base entity of a supposedly checked-out entity.</p></li><li><p>Fixed a bug where the point at which four indoor chucks meet is
        considered an invalid position.</p></li><li><p>Better handling of time synchronisation between server
        components.</p></li><li><p>Added pickling support for the <code class="code"> cellData </code> property
        since it was causing BaseApp backup to fail.</p></li><li><p>Fixed a bug where a backup BaseApp could not take over for a
        failed BaseApp if it was using an aliased network interface.</p></li><li><p>Fixed an infinite recursion in the BaseApp while trying to send
        proxy data to client.</p></li><li><p>DBMgr now logs an error if data is truncated due to the <code class="code">
        &lt;DatabaseLength&gt; </code> attribute.</p></li><li><p>Fixed a problem that caused a player to fall off a vehicle when
        the vehicle jumps.</p></li><li><p>Fixed a bug where dynamic obstacles are not added to the chunk's
        collision tree.</p></li><li><p>Fixed a bug where the server components incorrectly binds to an
        IPv6 interface on machines with IPv6 configured.</p></li><li><p>Fixed BaseApp crash caused by the <code class="code">
        BigWorld.createBaseAnywhere() </code> function not correctly
        incrementing the reference count of the newly created base
        entity.</p></li><li><p>Fixed a bug in DBMgr where an entity can be left in the "pending
        checkout" state if the connection to the MySQL database is lost. While
        in this state, all attempts to load the entity will fail even after
        the connection to the MySQL database is restored.</p></li><li><p>Fixed a bug in DBMgr where it would fail to start with a "Query
        was empty" error. This bug only appears when there is an entity with
        only <code class="code"> ARRAY </code> or <code class="code"> TUPLE </code> properties.</p></li><li><p>Fixed a problem with physics correction that occurred when the
        player was a passenger. <br> Entity positions could become
        temporarily incorrect.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e5351"></a>BigWorld Technology 1.7.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5354"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> bwmachined </code> now supports tags on a per-machine
        basis. <br> These can be used for starting machines from a subset
        of available machines, or for restricting what process types each
        machine can start. <br> This is done via <code class="code">
        bigworld/src/server/tools/bwmachined/bwmachined.conf </code> and the
        <code class="code"> start </code> section in <code class="code"> control_cluster.py </code> .
        <br> See <em class="emphasis"> Server Operations Guide </em>
        , section <em class="emphasis"> Miscellaneous Command-line Tools
        </em> , <em class="emphasis">
            <code class="code">control_cluster.py</code>
          </em> , and <em class="emphasis"> Server Overview </em>
        , section <em class="emphasis"> Server Components </em> ,
        <em class="emphasis">
            <code class="code">bwmachined</code>
          </em> .</p></li><li><p>Added <code class="code"> onInit() </code> callback to CellApp and BaseApp's
        personality scripts. <br> See <em class="emphasis"> CellApp Python
        API Documentation </em> and <em class="emphasis"> BaseApp
        Python API Documentation </em> , entry <em class="emphasis">
        Modules-&gt;BWPersonality </em> .</p></li><li><p>Implemented <code class="code"> BigWorld.executeRawDatabaseCommand() </code>
        in CellApp. <br> This is similar to the BaseApp method. <br> See
        <em class="emphasis"> CellApp Python API Documentation </em> ,
        entry <em class="emphasis"> Modules-&gt; BigWorld </em>
        .</p></li><li><p>Added a new option to <code class="code"> bw.xml </code> -- <code class="code">
        cellApp/entitySpamSize </code> . <br> It causes a warning message
        to be displayed if a single entity adds more than this number of bytes
        to another one in a single update. <br> This can be useful to
        identify entities that are causing a lot of network traffic. <br>
        See <em class="emphasis"> Server Operations Guide </em> ,
        section <em class="emphasis"> Software Configuration with <code class="code">
        bw.xml </code> </em> , <em class="emphasis"> CellApp
        Configuration Options </em> .</p></li><li><p>Added <code class="code"> BigWorld.isBackup() </code> method to return
        whether a BaseApp is a backup. <br> See <em class="emphasis">
        BaseApp Python API Documentation </em> , entry <em class="emphasis"> Modules-&gt; BigWorld </em> .</p></li><li><p>Optimised <code class="code"> BigWorld.createInDefaultSpace() </code> to not
        go via CellAppMgr if it can find a local base entity with a cell
        entity in the same space. <br> See <em class="emphasis"> BaseApp
        Python API Documentation </em> , entry <em class="emphasis">
        Class List-&gt; Base </em> .</p></li><li><p>Added ability for Reviver to limit the types of components to
        revive based on the Components tags in <code class="code"> bwmachined </code> .
        <br> See <em class="emphasis"> Server Operations Guide </em>
        , section <em class="emphasis"> Fault Tolerance </em> ,
        <em class="emphasis"> Fault Tolerance With Reviver </em> ,
        <em class="emphasis"> Specifying Components To Support </em>
        .</p></li><li><p>Added command-line options to Reviver so that the types of
        components to be revived can be specified. <br> See <em class="emphasis"> Server Operations Guide </em> , section <em class="emphasis"> Fault Tolerance </em> , <em class="emphasis">
        Fault Tolerance With Reviver </em> , <em class="emphasis">
        Command-line Options </em> .</p></li><li><p>Added extra <code class="code"> bw.xml </code> options for Reviver so that
        the configuration for each revivable component can be specified.
        <br> See <em class="emphasis"> Server Operations Guide </em>
        , section <em class="emphasis"> Software Configuration with <code class="code">
        bw.xml </code> </em> , <em class="emphasis"> Reviver
        Configuration Options </em> .</p></li><li><p>Exposed local position and direction of a cell entity to script
        via property <code class="code"> Entity.localPosition </code> . <br> See
        <em class="emphasis"> CellApp Python API Documentation </em> ,
        entry <em class="emphasis"> Class List-&gt; Entity </em>
        .</p></li><li><p>Added the <code class="code"> querytags </code> command to <code class="code">
        control_cluster.py </code> . <br> See <em class="emphasis"> Server
        Operations Guide </em> , section <em class="emphasis">
        Miscellaneous Command-line Tools </em> , <em class="emphasis">
            <code class="code">control_cluster.py</code>
          </em> .</p></li><li><p>The following changes were made to <code class="code"> control_cluster.py
        </code> :</p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> killproc </code> option now accepts process names (
            <em class="emphasis"> e.g. </em> , <code class="code"> cellapp01 </code> ) as well
            as the old specification (PID, machine).</p></li><li><p><code class="code"> watch </code> option now only returns information for
            the current user's processes, and now is able to query single
            processes when names are given ( <em class="emphasis"> e.g. </em> ,
            <code class="code"> cellapp01 </code> ).</p></li><li><p><code class="code"> cinfo </code> option now accepts a list of machine
            names for which to retrieve information (previously, information
            was retrieved for the whole cluster.</p></li></ul></div><p>See <em class="emphasis"> Server Operations Guide </em> ,
        section <em class="emphasis"> Miscellaneous Command-line Tools
        </em> , <em class="emphasis"> <code class="code"> control_cluster.py </code>
        </em> .</p></li><li><p>Communication between client and server can now be ordered using
        the a new option in <code class="code"> bw.xml </code> -- <code class="code">
        baseApp/useOrderedChannelToClient </code> . <br> This option is set
        by default. <br> See <em class="emphasis"> Server Operations Guide
        </em> , section <em class="emphasis"> Software Configuration
        with <code class="code"> bw.xml </code> </em> , <em class="emphasis">
        BaseApp Configuration Options </em> .</p></li><li><p><em class="emphasis"> Cluster Configuration </em> section was added
        to Server Installation Guide, dealing with:</p><div class="itemizedlist"><ul type="circle"><li><p>Firewall settings to secure BigWorld machines with public
            IPs.</p></li><li><p>Routing settings to ensure broadcast packets will be routed
            correctly.</p></li></ul></div><p>See <em class="emphasis"> Server Installation Guide </em>
        , section <em class="emphasis"> Cluster Configuration </em>
        .</p></li><li><p>Added support for reliably sending once-off bundles in Mercury.
        <br> This is configured by the general configuration option <code class="code">
        reliableByDefault </code> in <code class="code"> bw.xml </code> . <br> See
        <em class="emphasis"> Server Operations Guide </em> , section
        <em class="emphasis"> Software Configuration with <code class="code"> bw.xml
        </code> </em> , <em class="emphasis"> General Configuration
        Options </em> .</p></li></ul></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5702"></a>1.1.&nbsp;Space Viewer</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Space Viewer now features colouring relative to load. <br>
          When activated (via the Colour menu), the available colour range is
          scaled between the least and most loaded cells. <br> This is
          useful for quickly assessing load distribution across many cells.
          <br> See <em class="emphasis"> Server Operations Guide
          </em> , section <em class="emphasis"> Admin Tools </em>
          , <em class="emphasis"> Space Viewer </em> , <em class="emphasis"> Menu Items </em> .</p></li><li><p>Background images are now automatically scaled to space
          bounds. <br> See <em class="emphasis"> Server Operations Guide
          </em> , section <em class="emphasis"> Admin Tools </em>
          , <em class="emphasis"> Space Viewer </em> , <em class="emphasis"> Menu Items </em> , entry <em class="emphasis">
          Display Image Overlay </em> .</p></li><li><p>When starting <code class="code"> svlogger.py </code> manually, you can now
          specify the listening address with just the port (instead of <code class="code">
              <em class="emphasis">ip:port</em>
            </code> ). <br> See <em class="emphasis"> Server Operations
          Guide </em> , section <em class="emphasis"> Admin Tools
          </em> , <em class="emphasis"> Space Viewer </em> ,
          <em class="emphasis"> Running The Client And Server Parts Of Space
          Viewer Separately </em> .</p></li><li><p>The following changes were made to <code class="code"> space_viewer.py
          </code> :</p><div class="itemizedlist"><ul type="circle"><li><p>Added the <code class="code"> --autoselect </code> option, which
              enables automatic selection of the first cell on startup.</p></li><li><p>Added <code class="code"> -d/--dump-db </code> options, which display
              the contents of a Space Viewer log database ( <em class="emphasis"> i.e.
              </em> , the bit that has the <code class="code"> spaceID </code> stored
              in it). <br> This is useful for finding out what space a
              particular log is for.</p></li></ul></div><p>See <em class="emphasis"> Server Operations Guide </em>
          , section <em class="emphasis"> Admin Tools </em> , <em class="emphasis"> Space Viewer </em> , <em class="emphasis">
          Command-line Options </em> .</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5814"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> onBaseAppReady() </code> method now is only called for
        non-backup BaseApps. <br> <code class="code"> onBaseAppRestore() </code> is
        called when a backup BaseApp restores a BaseApp. <br> See <em class="emphasis"> BaseApp Python API Documentation </em> , entry
        <em class="emphasis"> Modules-&gt;BWPersonality </em> .</p></li><li><p><code class="code"> DirectoryWatcher </code> class is now sorted--the values
        of the watcher are sorted alphabetically. <br> See <em class="emphasis"> Client Python API Documentation </em> , entry
        <em class="emphasis"> Class List-&gt; <code class="code"> DirectoryWatcher </code>
        </em> .</p></li><li><p><code class="code"> pythonPort </code> option in <code class="code"> defaults.xml </code>
        for CellApps, BaseApps and Bots processes now defaults to <code class="code"> 0
        </code> ( <em class="emphasis"> i.e. </em> , bind to any port). <br>
        This is to avoid a serious port contention issue that can occur with
        some Linux kernels. <br> See <em class="emphasis"> Server
        Operations Guide </em> , section <em class="emphasis"> Software
        Configuration with <code class="code"> bw.xml </code> </em> ,
        sub-sections:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"> The Entry <code class="code"> &lt;parentFile&gt;
            </code> </em></p></li><li><p><em class="emphasis"> Command-line options
            </em></p></li><li><p><em class="emphasis"> BaseApp Configuration Options
            </em></p></li><li><p><em class="emphasis"> Bots Configuration Options
            </em></p></li><li><p><em class="emphasis"> CellApp Configuration Options
            </em></p></li></ul></div></li><li><p>Re-enabled data propagation when an entity property is
        reassigned to itself. <br> This allows the user to manually force
        data propagation for wrapped <code class="code"> FIXED_DICT </code> , <code class="code">
        USER_TYPE </code> and <code class="code"> PYTHON </code> types. <br> Optimally,
        self-assignment should be ignored for <code class="code"> ARRAY </code> and
        unwrapped <code class="code"> FIXED_DICT </code> types, since they are always
        up-to-date, but this is not done. <br> For the other types,
        self-assignment has no effect. <br> See <em class="emphasis">
        Server Operations Guide </em> , section <em class="emphasis">
        Properties </em> , <em class="emphasis"> Data Distribution
        </em> , <em class="emphasis"> Data Propagation </em>
        .</p></li><li><p>For the Bots process, <code class="code"> pythonServerPort </code> watcher
        has been created to replace <code class="code"> python server port </code> .
        <br> This was done to make Bots consistent with other
        processes.</p></li><li><p>DBMgr now defaults to using prepared statements when using
        MySQL.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5955"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Altered order of network initialisation calls for BaseApps and
        CellApps to fix potential problem of receiving birth notifications
        before the interface is being served correctly.</p></li><li><p>Fixed a few problems with <code class="code"> BigWorld.reloadScript() </code>
        method. <br> Previously, Python objects associated with <code class="code">
        FIXED_DICT </code> and <code class="code"> CLASS </code> data types were not
        reloaded. <br> Also, accessing mailboxes after a reload could cause
        a crash.</p></li><li><p>Fixed a problem that occurred when shutting down CellApp using
        <code class="code"> Ctrl+C </code> . <br> CellApp process was shutting down
        normally, which includes destructing all entities. This was causing
        spaces 2 and 3 of FantasyDemo to become empty and destroy the space.
        FantasyDemo would then be left with one space instead of three.</p></li><li><p>Fixed problem where the global direction was being sent to
        clients, instead of the local one.</p></li><li><p>A Python exception is now thrown when you try to teleport an
        entity that has passengers. <br> 'Teleporting' in the same space is
        supported by setting the entity's position.</p></li><li><p>Wrapped <code class="code"> FIXED_DICT </code> scripts are now accessed on
        demand-- previously, they were reported on system startup. <br>
        This allows components that do not use the particular <code class="code">
        FIXED_DICT </code> type to not have the associated script present in
        their <code class="code"> res </code> tree. <br> As a result, if there is an
        error in the script ( <em class="emphasis"> e.g. </em> , functions named
        incorrectly), it will not be reported until you try to access
        it.</p></li><li><p>Fixed a problem where deleting an item from an <code class="code"> ARRAY
        </code> -typed property would crash in <code class="code">
        PyArrayDataInstance::pySeq_ass_item </code> .</p></li><li><p>Fixed problem that occurred sometimes with entity's navigation
        between indoors and outdoors. <br> The problem could be seen in
        FantasyDemo with guards not being able to navigate into the
        underground tunnels.</p></li><li><p>Fixed the BaseApp crash that sometimes occurred when attaching
        and detaching a client to a proxy multiple times.</p></li><li><p>Added a check so that <code class="code"> Base.createCellEntity() </code> ,
        <code class="code"> Base.createInNewSpace() </code> , <code class="code">
        Base.createInDefaultSpace() </code> cannot be called on a destroyed
        entity.</p></li><li><p>Removed <code class="code"> Proxy::selfMotivator_ </code> after witness is
        enabled. <br> In some situations, more information than necessary
        was being sent to the client, while in others (if a cell entity was
        destroyed and then re-created), a BaseApp crash could occur.</p></li><li><p>Fixed a problem where Python objects could be accessed after
        <code class="code"> Py_Finalize() </code> had been called. <br> Now, any Python
        object referenced by an <code class="code"> EntityDescriptionMap </code> is
        dereferenced before <code class="code"> Py_Finalize() </code> occurs.</p></li><li><p>Added a flag to <code class="code"> ChannelData </code> to indicate that the
        remote end has died. <br> This is used to stop processing of
        further packets on this channel. When another CellApp dies, a CellApp
        now makes sure not to create ghosts and entities from this dead
        CellApp after the cleanup has already been done.</p></li><li><p><code class="code"> EntityDescription::add[Dictionary|Section]ToStream
        </code> now returns <code class="code"> false </code> when an invalid value is
        passed, instead of hitting a <code class="code"> CRITICAL_MSG </code> . <br>
        This fixes a problem where a BaseApp would hit a <code class="code"> CRITICAL_MSG
        </code> if an invalid value was passed in a call to <code class="code">
        BigWorld.createBaseAnywhere </code> .</p></li><li><p>Made <code class="code"> FIXED_DICT </code> and <code class="code"> CLASS </code>
        instances pickleable, so BaseApp backups now work correctly. <br>
        However, pickling and then unpickling does not result in the original
        object:</p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> PyFixedDictDataInstanc </code> e becomes a normal
            Python dictionary.</p></li><li><p><code class="code"> PyClassDataInstance </code> becomes a normal Python
            class instance.</p></li></ul></div></li><li><p><code class="code"> PyArrayDataInstance </code> is now picklable, so BaseApp
        backups now work correctly.</p></li><li><p>Fixed a problem that occurred when <code class="code">
        treatAllOtherEntitiesAsGhosts </code> was <code class="code"> true </code> --
        <code class="code"> isReal </code> was not always returning the correct result.
        <br> This could occur, for example, when using the interactive
        Python console.</p></li><li><p>Better handling of deserialisation errors when loading an entity
        from the database (which avoids a server crash on bad Python
        scripts):</p><div class="itemizedlist"><ul type="circle"><li><p><code class="code"> createBaseFromDB() </code> callback will return
            <code class="code"> None </code> if deserialisation fails, instead of a
            half-constructed base.</p></li><li><p>Accessing <code class="code"> cellData </code> will raise an exception
            when deserialisation fails, instead of getting <code class="code"> cellData
            </code> with part of the data missing.</p></li><li><p>Creating the cell part will call <code class="code">
            onCreateCellFailure() </code> on the base if deserialisation
            fails, instead of crashing with <code class="code"> CRITICAL </code> error
            message.</p></li></ul></div></li><li><p>Fixed the crash that occurred when accessing a <code class="code"> FIXED_DICT
        </code> property with an invalid key.</p></li><li><p>Fixes for handling multi-level NAT situations where one client's
        proxy address could be the same address used for another client's
        login attempt. <br> The client can now try multiple source ports
        until one is successful.</p></li><li><p>Fixed a problem that could occur when adding more than the
        maximum number of controllers. <br> The controller was being added
        to the <code class="code"> controllers_ </code> map, but not having <code class="code">
        startReal() </code> called or being returned.</p></li><li><p>Fixed a bug where the wrong value was being passed to the
        callback of <code class="code"> BigWorld.fetchDataSection </code> .</p></li><li><p>Fixed a problem where <code class="code"> setSpaceViewport </code> and <code class="code">
        setVehicle </code> messages were not being reliably sent to the
        client.</p></li><li><p><code class="code"> BOTS_EXCLUSIVE </code> in <code class="code"> pycommon/cluster.py
        </code> now works correctly.</p></li><li><p>Bug fixes for cluster library where some process types (
        <em class="emphasis"> e.g. </em> , Bots, Reviver) would not be picked up
        properly during server discovery.</p></li><li><p>Fixed a problem with <code class="code"> bwmachined </code> where birth and
        death notifications were being sent to <code class="code"> 127.0.0.1 </code>
        instead of the component's <code class="code"> internalInterface </code> option in
        <code class="code"> bw.xml </code> . <br> This caused a problem when a specific
        interface was chosen for <code class="code"> internalInterface </code> in <code class="code">
        bw.xml </code> .</p></li><li><p>Fixed the problem in Space Viewer where input events would fall
        longer and longer behind when updates were taking longer than the
        sample interval ( <em class="emphasis"> i.e. </em> , when the logger and
        viewer had a slow connection).</p></li><li><p>The title bar is now set correctly in Space Viewer.</p></li><li><p>Fixed up incorrect default file and improved usage information
        in <code class="code"> logaround.py </code> .</p></li><li><p>Removed an overzealous <code class="code"> WARNING_MSG </code> related to
        quickly adding and removing Controllers. <br> This message could
        often be seen in FantasyDemo when two Avatars were standing at the
        same position. A Guard's <code class="code"> VisionController </code> could get two
        <code class="code"> onStartSeeing </code> messages during its update. Each of these
        could cause <code class="code"> Guard.think </code> to be called, which could
        cancel and add movement Controllers.</p></li><li><p>Fixed a DBMgr problem in <code class="code">
        mysql_typemapping.cpp/classifyColumns() </code> where it used an
        iterator that had been removed from the container.</p></li><li><p>Added extra support for handling dropped UDP packets between
        server components. <br> Previously, dropped UDP packets caused
        server problems.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e6279"></a>BigWorld Technology 1.7 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6282"></a>1.&nbsp;Important Notes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>To ensure that only authorised users can run the BigWorld
        server, a system has been put in place so that part of the server
        functionality is run remotely. <br> This is done via the CellAppMgr
        server component. When it is run, this process contacts a remote
        machine to implement some of its functionality. Only those users
        authorised to run the server will be allowed to connect to this
        service. <br> For details on how to register an authentication key,
        see the <em class="emphasis"> Server Installation Guide </em>
        .</p></li><li><p>MySQL databases created by BigWorld 1.6 must be upgraded to work
        correctly with BigWorld 1.7. <br> Before running BigWorld 1.7,
        backup your database and run:</p><pre class="programlisting">
          
          
          dbmgr -upgrade
        
        
        </pre></li><li><p>There is an additional constraint when implementing persistent
        <code class="code"> USER_TYPE </code> s: the implementation of methods <code class="code">
        addToStream </code> and <code class="code"> createFromStream </code> must match the
        <code class="code"> bindSectionToDB </code> method. <br> DBMgr will most likely
        assert if your implementation does not meet this constraint. <br>
        See Server Programming Guide, chapter The Database Layer, section
        Mapping BigWorld Properties Into MySQL, sub-section User-Defined
        Types.</p></li><li><p>Due to the optimisation of sending only persistent data to and
        from DBMgr, the password pass-through feature for account entities
        will only work if the property " <code class="code"> password </code> " is
        persistent.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6328"></a>2.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added support for loading entities from chunks in a loading
        thread on BaseApp's. <br> This is achieved by using the script
        methods <code class="code"> BigWorld.fetchEntitiesFromChunks </code> and <code class="code">
        BigWorld.fetchFromChunks </code> . <br> See Base Python API
        Documentation for more information.</p></li><li><p>Added support for loading data sections in a loading thread on
        BaseApp's via the method <code class="code"> BigWorld.fetchDataSection </code> .
        <br> See Base Python API Documentation.</p></li><li><p>Improved support for balancing the load between BaseApp's. Using
        the method <code class="code"> BigWorld.createBaseAnywhere </code> allows for a
        base entity to be created on an appropriate BaseApp, according to its
        load. <br> See Base Python API Documentation, entries <code class="code">
        createBaseAnywhere </code> , <code class="code"> createBaseLocally </code> , <code class="code">
        createBaseRemotely </code> .</p></li><li><p><code class="code"> ARRAY </code> properties can now be modified, with the
        changes being propagated. <br> Previously, if an entity had a
        <code class="code"> CELL_PUBLIC </code> attribute of type <code class="code"> ARRAY </code> ,
        for example, then changes to an element of the array would not be
        propagated to ghost entities. <br> See Server Programming Guide,
        chapter The Database Layer, section Mapping BigWorld Properties Into
        SQL, sub-section ARRAYs. <br> See also Server Programming Guide,
        chapter Properties, section Data Distribution. See also Server
        Overview, chapter Server Components, section Scripting And Entities,
        sub-section Properties.</p></li><li><p>Added a <code class="code"> FIXED_DICT </code> data type, which is a
        dictionary-like type with a fixed set of string keys. This type can
        also be customised by replacing its dictionary-like type with a
        user-defined type. Most of the functionality of the <code class="code"> USER_TYPE
        </code> data type can now be achieved using <code class="code"> FIXED_DICT </code>
        . <br> Changing the value of a <code class="code"> FIXED_DICT </code> property
        that needs to be propagated (e.g. <code class="code"> ALL_CLIENTS </code> ) will
        cause this change to be propagated efficiently. <br> This data type
        is also an efficient way to add optional properties to an entity.
        <br> Enabling the <code class="code"> AllowNone </code> option of a <code class="code">
        FIXED_DICT </code> property means that <code class="code"> None </code> may be used
        as the value of the whole dictionary. <br> See Server Programming
        Guide, chapter Properties, section Property Types, sub-section <code class="code">
        FIXED_DICT </code> data type.</p></li><li><p>Support has been added to allow certain assertions to be enabled
        during development, but disabled in a production environment. <br>
        For example, if enabled, a corrupted packet from a client will cause
        an assertion on the server, while if disabled, only an error message
        is generated, and the server component continues to run. <br> See
        the <code class="code"> hasDevelopmentAssertions </code> option in the Server
        Operations Guide, chapter Software Configuration With <code class="code"> bw.xml
        </code> , section General configuration options.</p></li><li><p>On the client, entity types are now compressed to exclude
        server-only types. <br> This means that it is no longer necessary
        for the client to know about server-only entity types. <br> See
        Client Programming Guide, chapter Entities, section Entities Are
        Python Script Objects.</p></li><li><p>Added support for denying logins if the server load is above
        levels set by the user in <code class="code"> bw.xml </code> . <br> See Server
        Operations Guide, chapter Software Configuration With <code class="code"> bw.xml
        </code> :</p><div class="itemizedlist"><ul type="circle"><li><p>Section BaseAppMgr Configuration Options, option <code class="code">
            baseAppOverloadLevel </code> .</p></li><li><p>Section CellAppMgr Configuration Options, option <code class="code">
            cellAppOverloadLevel </code> .</p></li><li><p>Section DBMgr Configuration Options, option <code class="code">
            overloadLevel </code> .</p></li></ul></div></li><li><p>A configuration option was added to <code class="code"> bw.xml/dbMgr </code>
        to prevent accidental deletion of data in MySQL tables due to
        unintentional changes to DEF files or user type implementation.
        <br> See the <code class="code"> syncTablesToDefs </code> option in Server
        Operations Guide, chapter Software Configuration With <code class="code"> bw.xml
        </code> , section DBMgr Configuration Options.</p></li><li><p>Type <code class="code"> UINT64 </code> is now supported in <code class="code"> .def
        </code> files. <br> Previously, only <code class="code"> INT64 </code> was
        supported. <br> See Server Programming Guide, chapter Property
        Types, section Primitive Types.</p></li><li><p>Added new data section type <code class="code"> PackedSection </code> for
        binary XML files. <br> See Server Overview, chapter Other Features,
        section Packed Files. <br> See also Server Operations Guide,
        chapter Miscellaneous Command-line Tools, sections <code class="code">
        bin_convert.py </code> and <code class="code"> res_packer </code> .</p></li><li><p>The network interface for internal communication can now be
        specified for each server component. <br> Many components also
        support specifying a monitoring interface. <br> See the <code class="code">
        internalInterface </code> and <code class="code"> monitoringInterface </code>
        options in Server Operations Guide, chapter Software Configuration
        With <code class="code"> bw.xml </code> :</p><div class="itemizedlist"><ul type="circle"><li><p>Section BaseApp Configuration Options</p></li><li><p>Section BaseAppMgr Configuration Options</p></li><li><p>Section CellApp Configuration Options</p></li><li><p>Section CellAppMgr configuration Options</p></li><li><p>Section DBMgr Configuration Options</p></li><li><p>Section LoginApp Configuration Options</p></li></ul></div></li><li><p>The <code class="code"> enum.xml </code> file is no longer required. <br>
        The existing enumerations are now implemented in the source code.
        <br> See Server Programming Guide, chapter Properties, section Data
        Distribution.</p></li><li><p>A debugging mode to help detect problems with inter-cell entity
        communication has been added. <br> This simulates the situation
        that all other entities appear as ghost entities to the currently
        executing entity. <br> See the <code class="code"> treatAllOtherEntitiesAsGhosts
        </code> option in Server Operations Guide, chapter Software
        Configuration With <code class="code"> bw.xml </code> , section CellApp
        Configuration Options.</p></li><li><p>Ghost entities now support the properties <code class="code"> ownClient
        </code> , <code class="code"> allClients </code> , and <code class="code"> otherClients </code>
        . <br> Previously, these properties were only supported by real
        entities. <br> They work by first forwarding to the real entity any
        method calls on these objects. <br> See Server Programming Guide,
        chapter Methods, section Intra-entity Communication.</p></li><li><p>Data can now be streamed opportunistically from the proxy to the
        client. <br> See Server Programming Guide, chapter Methods, section
        Sending Data To The Client Via Proxy.</p></li><li><p>Improvements have been made to the error messages generated when
        client fails to log in. <br> The client now receives an enumeration
        and a string describing what caused the login attempt to fail. <br>
        See Client Python API Documentation, entry <code class="code"> connect </code>
        .</p></li><li><p>Added support for handling write status changes on file
        descriptors. This can be used, for example, to initiate a TCP
        connection to a server that does not require blocking or polling a
        file descriptor. <br> See Server Programming Guide, chapter
        Non-Blocking Socket I/O Using Mercury.</p></li><li><p>On CellApp's, Updatables now have an ordering. <br> A level
        can now be specified when registering an Updatable. At each tick, all
        Updatables with a lower level are updated before those with a higher
        one. <br> This is currently used to ensure that all controllers are
        updated before witnesses are updated.</p></li><li><p>Archiving of space data can now be disabled. <br> See the
        <code class="code"> archiveSpaceData </code> option in the Server Operations Guide,
        chapter Software Configuration With <code class="code"> bw.xml </code> , section
        CellAppMgr Configuration Options.</p></li><li><p>The handling of CellApp death when running multiple CellApp's on
        a single machine has been improved. <br> The server will try to
        restore orphaned entities to a different CellApp machine if one is
        available.</p></li><li><p>Enabled ordering of downstream messages by default. <br> This
        ensures that if a client receives packets out-of-order from the
        server, messages to an entity will still be processed in order.
        <br> This can be disabled by removing the <code class="code">
        ORDERED_ENTITY_MESSAGES #define </code> in <code class="code">
        bigworld/src/common/servconn.hpp </code> .</p></li><li><p>Added support for ordered upstream entity messages. <br> This
        ensures that if the server receives packets out-of-order from a
        client, messages to an entity will still be processed in order.
        <br> Use the <code class="code"> baseApp/orderedUpstreamEntityMessages </code>
        option of <code class="code"> bw.xml </code> . <br> See the <code class="code">
        orderedUpstreamEntityMessages </code> option in the Server Operations
        Guide, chapter Software Configuration With <code class="code"> bw.xml </code> ,
        section BaseApp Configuration Options.</p></li><li><p>Entities can now be automatically loaded when the server is
        started. <br> See Server programming Guide, Loading Entities from
        Chunk Files.</p></li><li><p>Configuration options have been added for ID distribution.
        <br> See the <code class="code"> ids/criticallyLowSize </code> , <code class="code">
        ids/desiredSize </code> , <code class="code"> ids/lowSize </code> , and <code class="code">
        ids/desiredSize </code> options in the Server Operations Guide,
        chapter Software Configuration With <code class="code"> bw.xml </code> .</p></li><li><p>Added a configuration option <code class="code"> bots/enable </code> that now
        needs to be set to connect bots to the server. This replaces the need
        to set <code class="code"> baseApp/sendAuthToClient </code> when running bots.
        <br> See Server Operations Guide, chapter Software Configuration
        With <code class="code"> bw.xml </code> , sub-section Bots Configuration
        Options.</p></li><li><p>Added <code class="code"> BigWorld.globalData </code> and <code class="code">
        BigWorld.cellAppData </code> to CellApp, and <code class="code">
        BigWorld.globalData </code> and <code class="code"> BigWorld.baseAppData </code> to
        BaseApp. <br> These dictionary-like objects can be used to share
        information between server components.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6730"></a>3.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed problem with doors not working across cells. <br> Note
        that the method <code class="code"> BigWorld.configureConnection </code> has been
        deprecated. It has been replaced by <code class="code"> Entity.addPortalConfig
        </code> . <br> See Server Programming Guide, chapter Entity Extras
        and Controllers, section Implementing Controllers, sub-section
        Configuring Portal's Permissivity.</p></li><li><p>Proximity triggers are now only set off when an entity lands in
        the area. <br> Previously, if an entity moved quickly through the
        area by teleporting, for example, then the <em class="emphasis"> enter
        </em> and <em class="emphasis"> leave </em> events would be
        triggered.</p></li><li><p>On the client, entities that enter at a low level of detail
        level now have their unsent properties set to their default value.
        <br> Previously, the properties were not set until the entity
        entered the appropriate LOD level. <br> See Server Programming
        Guide, chapter Properties, section LOD (Level of Detail) On
        Properties.</p></li><li><p>Archiving no longer rounds up to doing the nearest entity per
        tick. <br> Each entity will now only be archived at a rate of
        roughly once every archive period (as specified in <code class="code"> bw.xml
        </code> ), instead of this being a lower bound. <br> Previously,
        each BaseApp would always archive at least one base entity per tick
        once it had a base entity. <br> See the <code class="code"> archivePeriod
        </code> option in the Server Operations Guide, chapter Software
        Configuration With <code class="code"> bw.xml </code> , section BaseApp
        Configuration Options.</p></li><li><p>The behaviour of ZIP file usage has been modified. <br> If a
        file <code class="code"> res.zip </code> exists at the root of a resource path,
        then it is used instead of the normal file system.</p></li><li><p>The behaviour of property <code class="code"> Proxy.client </code> has been
        modified. <br> Previously, if a proxy did not have a connected
        client, then it would not have this property. <br> Now, the proxy
        always has this attribute. If a client is not attached, then a dummy
        mailbox is returned, which will consume the method call. The new
        attribute <code class="code"> Proxy.hasClient </code> should now be used to check
        if a client is attached. <br> See Base Python API Documentation for
        more information.</p></li><li><p>For cell entities, the properties are no longer stored in the
        dictionary associated with the Python instance. <br> <code class="code">
        Entity.__dict__ </code> will no longer contain these values.</p></li><li><p>An extra packet will not be sent to the client when a player
        changes cells. <br> Besides the minor network overhead, this
        information could allow the client to infer the location of a cell
        boundary. This has now been changed so no extra packet is sent.</p></li><li><p>The <code class="code"> Flags </code> section in .DEF files no longer uses
        <code class="code"> enum.xml </code> . <br> Instead, it uses pre-defined
        property flags, as defined in the table below:</p><div class="altrow"><table border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>New Flag Names</th><th>Deprecated names</th></tr></thead><tbody><tr><td><code class="code"> ALL_CLIENTS </code></td><td><code class="code"> ALL_CLIENT </code></td></tr><tr><td><code class="code"> BASE </code></td><td>&nbsp;</td></tr><tr><td><code class="code"> BASE_AND_CLIENT </code></td><td>&nbsp;</td></tr><tr><td><code class="code"> CELL_PRIVATE </code></td><td><code class="code"> PRIVATE </code></td></tr><tr><td><code class="code"> CELL_PUBLIC </code></td><td><code class="code"> CELLGHOSTED </code></td></tr><tr><td><code class="code"> CELL_PUBLIC_AND_OWN </code></td><td><code class="code"> CELL_AND_OWNGHOSTED_AND_OWN </code></td></tr><tr><td><code class="code"> OTHER_CLIENTS </code></td><td><code class="code"> OTHER_CLIENT </code></td></tr><tr><td><code class="code"> OWN_CLIENT </code></td><td>&nbsp;</td></tr></tbody></table></div><p>Please note that a warning message is printed if a deprecated
        option is used. <br> See Server Overview, chapter Server
        Components, section CellApp, sub-section Scripting And Entities,
        Properties. <br> See also Server Programming Guide, chapter
        Properties, section Data Distribution.</p></li><li><p>The mapping of BigWorld types to MySQL column types has been
        changed, as described in the table below:</p><div class="altrow"><table border="0"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>BigWorld Type</th><th>Previous MySQLcolumn type</th><th>New MySQLcolumn type</th></tr></thead><tbody><tr><td><code class="code"> INT8 </code></td><td><code class="code"> INT </code></td><td><code class="code"> TINYINT </code></td></tr><tr><td><code class="code"> INT16 </code></td><td><code class="code"> INT </code></td><td><code class="code"> SMALLINT </code></td></tr><tr><td><code class="code"> UINT8 </code></td><td><code class="code"> INT </code></td><td><code class="code"> TINYINT UNSIGNED </code></td></tr><tr><td><code class="code"> UINT16 </code></td><td><code class="code"> INT </code></td><td><code class="code"> SMALLINT UNSIGNED </code></td></tr><tr><td><code class="code"> UINT32 </code></td><td><code class="code"> BIGINT </code></td><td><code class="code"> INT UNSIGNED </code></td></tr></tbody></table></div></li><li><p>Some redundant columns were removed from MySQL tables that store
        entity data. Entities without cell scripts no longer have columns for
        its position, direction and space ID.</p></li><li><p>Improved performance of DBMgr when using MySQL as the underlying
        database, with the features listed below:</p><div class="itemizedlist"><ul type="circle"><li><p>DBMgr is now multi-threaded.</p></li><li><p>DBMgr now supports using MySQL prepared statements as a
            compile-time option.</p></li><li><p>The <code class="code"> parentID </code> column of entity sub-tables is
            now indexed.</p></li><li><p>Non-persistent properties are no longer sent to and from the
            DBMgr.</p></li></ul></div></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6986"></a>4.&nbsp;Space Viewer</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6989"></a>4.1.&nbsp;New/Changed Features</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added the ability to scale different entity types to different
          sizes. <br> See Server Operations Guide, chapter Admin Tools,
          section Space Viewer, sub-section Menu Items, and sub-section
          Customising Entity And Display Colours.</p></li><li><p>Added a tooltip description of entities when hovering over
          them with the mouse. <br> See Server Operations Guide, chapter
          Admin Tools, section Space Viewer, sub-section Viewing
          Spaces.</p></li><li><p>Added ability to show or hide individual entity types. <br>
          See Server Operations Guide, chapter Admin Tools, section Space
          Viewer, sub-section Menu Items.</p></li><li><p>Added the offline logging capability. <br> <code class="code">
          svlogger.py </code> logs data without opening graphical interface.
          <br> <code class="code"> svreplay.py </code> reads data output by <code class="code">
          svlogger.py </code> and displays it in the regular Space Viewer
          interface. <br> Both scripts are located in folder <code class="code">
          bigworld/tools/server/space_viewer </code> . <br> See Server
          Operations Guide, chapter Admin Tools, section Space Viewer,
          sub-section Offline Mode.</p></li><li><p>Added the ability to overlay background image onto the
          display. <br> A sample image is in <code class="code">
          fantasydemo/res/server/space_images/main.png </code> , which matches
          the main space used in FantasyDemo.</p></li><li><p>Added the ability to overlay Bot waypoint graphs over the
          display. <br> Waypoint files should have the XML format accepted
          by the standard bots <code class="code"> Patrol </code> movement controller.
          <br> See Server Operations Guide, chapter Admin Tools, section
          Space Viewer, sub-section Menu Items. <br> See also Server
          Operations Guide, chapter Stress Testing With Bots, section
          Controlling Movement With <code class="code"> Patrol </code> .</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7054"></a>5.&nbsp;General Meter</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7057"></a>5.1.&nbsp;New/Changed Features</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added offline logging capability. <br> <code class="code"> gmlogger.py
          </code> logs data without opening the graphical interface. <br>
          <code class="code"> gmeter.py </code> reads data output by <code class="code"> gmlogger.py
          </code> and displays it in the regular General Meter interface.
          <br> See Server Operations Guide, chapter Admin Tools, section
          General Meter, sub-section Running Without Graphs.</p></li><li><p>Added the ability to display current sample values for the
          chosen machine or process. <br> See Server Operations Guide,
          chapter Admin Tools, section General Meter, sub-section Menu Items,
          Context Menu.</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7084"></a>6.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The connection between the client and server can now handle
        fragmented bundles. <br> Previously, this put a limit of about
        1,300 bytes on an individual message. This restriction has now been
        eliminated.</p></li><li><p>Reduced the likelihood of nearby entities not being in an
        entity's AoI when changing cells. <br> This could have occurred
        previously if the load balancing moved quickly and the ghost entities
        were not created before a real entity was offloaded. <br> This was
        a particular issue around areas where three cells meet.</p></li><li><p>Improved method <code class="code"> BWResource::purge </code> . <br> It
        increases performance and makes sure that purge is called for each
        node. <br> Previously, it would have problems if the names of the
        child nodes were not unique.</p></li><li><p>Fixed a problem with a cell not being removed from a space when
        its area becomes zero. <br> The server now can remove a cell from a
        space if it gets area and then returns to having no area.</p></li><li><p>The CellAppMgr no longer crashes if the configuration option
        <code class="code"> cellAppMgr/archivePeriod </code> is set to 0 in <code class="code"> bw.xml
        </code> .</p></li><li><p>A problem with the messages <code class="code"> createCellPlayer </code> and
        <code class="code"> createBasePlayer </code> being received out-of-order has been
        fixed. <br> If this situation occurs, then the message is buffered,
        so that the messages are handled in the correct order.</p></li><li><p>Eliminated a potential source for BaseApp crashes. <br>
        Previously, a BaseApp crash could occur if method <code class="code">
        BigWorld.createBaseFromDBID </code> received a base entity that
        existed on the same BaseApp as where the request came from when
        processed by DBMgr, but that entity was destroyed before the BaseApp
        received the result.</p></li><li><p>If <code class="code"> writeToDB </code> is <code class="code"> true </code> in the call
        to <code class="code"> Base.destroy </code> , then <code class="code"> onWriteToDB </code> is
        called before the base entity is marked as destroyed. <br> That is,
        <code class="code"> Base.isDestroyed </code> will be <code class="code"> false </code> during
        the <code class="code"> onWriteToDB </code> call, whereas previously this would
        have been <code class="code"> true </code> .</p></li><li><p>Fixed support for client-only entities.</p></li><li><p>Fixed a problem where a cell could be deleted from a space when
        there were real entities destined for it.</p></li><li><p>Fixed a problem where ghost entities did not have their
        positions updated when their real entities teleported to a different
        position in the same space. <br> This could cause a larger problem
        when the entity was offloaded to another new CellApp immediately--the
        real entity could have its position reverted to the original,
        pre-teleport position.</p></li><li><p>Fixed a problem where ghost entities could be left in the old
        space when teleporting between spaces.</p></li><li><p>The CellApp now waits for ChunkSpace to unload before deleting a
        space. <br> Previously, if a space with the same ID came back, then
        the CellApp would have to clear the ChunkSpace, which could take a
        long time. <br> Now, the space is reused if it has fully unloaded
        before the Cell comes back.</p></li><li><p>Fixed a problem where space data was not propagated to all
        cells. <br> It was possible for some CellApp's to not have any
        CellAppChannel's to other CellApp's sharing the same space. <br>
        This would cause changes in space data to not be fully
        propagated.</p></li><li><p>Fixed a possible distributed infinite loop of space data
        messages between CellApp's.</p></li><li><p>Added support for multiple levels of <code class="code"> ARRAY </code> 's and
        <code class="code"> TUPLE </code> 's when using MySQL as the underlying database.
        <br> This also fixes <code class="code"> USER_TYPE </code> 's that use multiple
        levels of sub-tables in their <code class="code"> bindSectionToDB </code>
        implementation.</p></li><li><p>Space data is no longer limited to 2048 bytes when writing to
        MySQL database.</p></li><li><p>Method <code class="code"> BigWorld.executeRawDatabaseCommand </code> now
        returns <code class="code"> false </code> when there is an error in the MySQL query
        syntax.</p></li><li><p>Changed the byte order of the <code class="code"> ip </code> and <code class="code"> port
        </code> columns of the <code class="code"> bigworldLogOns </code> table in MySQL
        database. <br> The following query will now display sensible
        results: <br> <code class="code"> select INET_NTOA(ip),port from bigworldLogOns;
        </code> <br> The columns <code class="code"> ip </code> , <code class="code"> port </code>
        and <code class="code"> salt </code> had their types changed to <code class="code"> unsigned
        </code> .</p></li><li><p>Fixed a problem with restoring cell entities that are
        passengers.</p></li><li><p>Fixed a bug where the correct direction was not always being
        sent to other clients and ghosts.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7271"></a>7.&nbsp;Known Bugs &amp; Limitations</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Server components do not run on CPU's that can dynamically alter
        their clock frequency. The dynamic frequency adjustment feature should
        be disabled for CPU's that support them.</p></li><li><p>Storing a Python source file inside a zip file system is not
        supported.</p></li><li><p>Packet filters cannot be used on bot connections.</p></li><li><p>NavGen stops the generation of navpolys when it finds a narrow
        passage, thus not generating the navigation mesh beyond that
        point.</p></li><li><p>DBMgr with XML database does not support a number of features
        supported by the MySQL database. These include:</p><div class="itemizedlist"><ul type="circle"><li><p>Disaster recovery.</p></li><li><p>Migration of data during an update.</p></li><li><p>Mapping of login names to entity names. It is assumed that
            the login name is the same as the entity name.</p></li><li><p>Entities without a name property (see <code class="code">
            dbMgr/nameProperty </code> setting).</p></li><li><p>Separate namespaces for different entity types. All entities
            must have unique names across all entity types.</p></li><li><p>Login names and passwords with '&lt;' and '&gt;'
            characters.</p></li></ul></div></li><li><p>DBMgr with MySQL database has the following limitations:</p><div class="itemizedlist"><ul type="circle"><li><p>Login names and passwords must be less than 255
            characters.</p></li><li><p>Limited length when chaining types. <br> For example, an
            <code class="code"> ARRAY </code> of <code class="code"> TUPLE </code> s of <code class="code">
            FIXED_DICT </code> s, etc... <br> The chain length is limited
            by the 64-character table name limit imposed by MySQL. <br> As
            type names are chained together to form the table name, long type
            chains or types with long names may exceed the 64-character
            limit.</p></li></ul></div></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e7337"></a>BigWorld Technology 1.6.4 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7340"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>New DbMgr configuration options to support Account
        entities.</p></li><li><p>Added <code class="code"> DataSection.readBlob </code> , <code class="code">
        DataSection.writeBlob </code> and <code class="code"> DataSection.asBlob </code>
        methods that carry out <code class="code"> BASE64 </code> string conversion.</p></li><li><p>Added options "dbmgr/loadUnknown", "dbmgr/createUnknown" and
        "dbmgr/rememberUnknown" in bw.xml. See server documentations for
        details</p></li><li><p>Added Python scripting functionality on bots application</p></li><li><p>Added new <code class="code"> Base.onRestoreCellFailed </code> callback when
        there is no alternative cell to replace a failed cell.</p></li><li><p>Added <code class="code"> onSpaceData </code> callback whenever a new space
        data is being added.</p></li><li><p>Added <code class="code"> BigWorld.addWatcher </code> PythonAPI.</p></li><li><p>Added Python script profiling functionality.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7389"></a>2.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a navigation controller bug that may cause intermittent
        CellApp crashes. Similar to previous controller fixes in 1.6.3.</p></li><li><p><code class="code"> onDestroy </code> callback is now invoked for cell-only
        entities when they are destroyed.</p></li><li><p><code class="code"> entity.navigateFollow </code> now should take eight
        arguments correctly. It used to take only seven arguments.</p></li><li><p>runScript now runs on CellApp instead of a cell on a CellApp.
        This prevents problem that scripts run multiple times on some cells
        but do not run on other cells.</p></li><li><p>Embedded Python server now takes multiple line input.</p></li><li><p>Performance improvement on <code class="code"> getEntitiesInRange </code>
        function.</p></li><li><p>Uses <code class="code"> callbacksPermitted </code> to avoid potential
        "re-entrancy" problems from script callbacks.</p></li><li><p><code class="code"> Matrix.writeMatrix </code> is now exposed in Python
        API.</p></li><li><p>Fixed problem with shutting down while an entity is
        selected.</p></li><li><p>Fixed problem with entity leaving the world while it is
        selected.</p></li><li><p>Various bug fix on bots application.</p></li><li><p>Better check for invalid incoming packets for LoginApp.</p></li><li><p><code class="code"> DataSectionIterator </code> now converts a NULL child
        into an empty BinSection</p></li><li><p>Fixed a problem in <em class="emphasis"> BSP </em> that
        closest point may not always be returned in a ray cast
        intersection</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e7452"></a>BigWorld Technology 1.6.3 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7455"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed the guest account functionality set up by tag <code class="code">
        isGuest </code> in the XML database. <br> NOTE: This tag will be
        deprecated in BW release 1.7.</p></li><li><p>Fixed the memory leak problem with XML sections. <br> As a
        result, freed XML sections can now be shared between main thread and
        loading thread. <br> NavGen is an example of program that uses this
        functionality.</p></li><li><p>Fixed problem with loading <code class="code"> ARRAY of PYTHON </code> , and
        <code class="code"> TUPLE of PYTHON </code> properties from XML section. <br> As
        a result, in method <code class="code"> PythonDataType::createFromSection() </code>
        , strings of a Base64-encoded pickled Python object that do not end in
        ' <code class="code"> = </code> ' are not treated as Python scripts.</p></li><li><p>dbMgr now correctly handles results from MySQL database
        containing NULL's.</p></li><li><p>Fixed the problem with inconsistent use of the default value for
        <code class="code"> USER_TYPE </code> . Now it will only use the default value
        specified in script if there is not one specified in the <code class="code"> def
        </code> file.</p></li><li><p>Fixed a problem with non-const entity values sharing default
        values. Previously, a change to one entity's value could affect other
        entities' values.</p></li><li><p><code class="code"> UINT32 </code> data type now works correctly. <br>
        Previously, problems could occur when handling values greater than
        2**31.</p></li><li><p>Relaxed chunk item lending criteria. <br> This fixes a
        problem that sporadically occurred in chunk item lending for large
        models sitting across multiple chunk boundaries.</p></li><li><p><code class="code"> BigWorld.configureConnection() </code> method now works
        correctly, i.e., portals in a chunk now correctly bind to the
        corresponding portals in the adjacent chunks.</p></li><li><p>CellApp now correctly checks physics for entities travelling in
        one move through multiple chunks .</p></li><li><p><code class="code"> BigWorld.reloadScript() </code> method now correctly
        reloads user-defined type modules.</p></li><li><p>Controller's <code class="code"> stopReal() </code> method now is not called
        more than once if the callback from another controller has already
        cancelled it.</p></li><li><p>Fixed intermittent CellApp crashes that happened due to
        controllers being cancelled in script callbacks while in the middle of
        range list shuffling.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e7540"></a>BigWorld Technology 1.6.2 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7543"></a>1.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>When teleporting, the CellApp always creates a ghost on
        destination CellApp.</p></li><li><p>Server now displays a warning message when there is a missing or
        corrupt primitive file.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e7553"></a>BigWorld Technology 1.6.1 Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7556"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Callbacks <code class="code"> onGetWitness </code> and <code class="code"> onLoseWitness
        </code> were added to the cell entity. This may be a convenient place
        for calling <code class="code"> Entity.setAoIRadius </code> and setting <code class="code">
        Entity.stealthFactor </code> , which is necessary since the entity
        does not have the witness when <code class="code"> __init__ </code> is
        called.</p></li><li><p>Configuration options in <code class="code"> bw.xml </code> can now be
        overridden by command-line arguments. To do this, add arguments in the
        format <code class="code"> <em class="emphasis"> +optionName value </em> </code>
        .</p></li><li><p>Folder <code class="code"> entities/common/lib-dynload </code> was added to
        the path where Python modules are loaded from.</p></li><li><p>BigWorld.Entity now has a read-only attribute hasWitness.</p></li><li><p>The attribute controlledBy can now be set on real entities that
        have a witness. This allows them to receive updates from server
        controllers or other clients.</p></li><li><p>Position changes to non-volatile entities are now sent down to
        clients.</p></li><li><p>FantasyDemo now uses Python 2.4 modules instead of Python
        2.3.</p></li><li><p>Configuration options of the noise generation functionality on
        CellApp were exposed (tags <code class="code"> standardRange </code> , <code class="code">
        horizontalSpeed </code> and <code class="code"> verticalSpeed </code> were added to
        <code class="code"> bw.xml/cellApp/noise </code> ).</p></li><li><p>Minor documentation improvements were made.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7626"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> Entity.writeToDB </code> on CellApp now also backs up
        cell entity's data to the base entity for fault tolerance. This
        ensures that the fault tolerance data is at least as up-to-date as the
        disaster recovery data.</p></li><li><p>File <code class="code"> bigworld/res/enum.xml </code> had unused
        enumerations removed from it.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7641"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The reference counting problem in callback to <code class="code">
        Base.writeToDB </code> was fixed.</p></li><li><p>The CellApp crash bug was fixed with the use of <code class="code">
        BigWorld.createEntity </code> .</p></li><li><p><code class="code"> BaseEntityMailBoxes </code> can now be created on
        Cellapp's for entity types that have no cell entity.</p></li><li><p>The Controlled Shutdown crash bug was fixed. It could occur when
        there was a big enough mix of entities that were to be written to the
        database and others that were not meant to.</p></li><li><p>The problem with time synchronisation functionality between
        server components was fixed. On occasions, components would attempt to
        adjust a large time skew error when none existed.</p></li><li><p>Problems when viewing multiple spaces with SpaceViewer were
        fixed. The titles are now set correctly and changes in the colour menu
        options are reflected in all windows.</p></li><li><p>Server components can now be started in any order again. A
        startup dependency of the CellApp on the DBMgr has been
        removed.</p></li><li><p>A problem which caused the load balancing to get stuck near the
        origin was solved by removing a cell from a CellApp that has multiple
        cells on it.</p></li><li><p>The <code class="code"> bw.xml/baseAppMgr/shouldShutDownOthers </code> option
        is now considered when BaseAppMgr receives a <code class="code"> SIGINT </code>
        .</p></li><li><p><code class="code"> BigWorld.configureConnection </code> was changed, so that
        it doesn't cause a crash when called with points that could not be
        resolved.</p></li><li><p><code class="code"> PyDataSection.write </code> now recognises Python long
        types and writes them as <code class="code"> int64 </code> .</p></li><li><p>Problem with restoration of entities in a Controlled Startup was
        fixed. Only entities with a cell and base entity were being restored
        in a Controlled Startup, because bases without a cell entity were
        being logged out in a Controlled Shutdown.</p></li><li><p>Fixed possible problem if a Python long whose size exceeds the
        range of int64 is used as an INT64 in a defined method or
        property.</p></li><li><p>Unpacking packed positions was not working correctly when
        compiled with gcc3.4.3. This showed up as egclient receiving incorrect
        positions for other entities when compiled on Linux with
        gcc3.4.3.</p></li><li><p>Fixed client-side bug with server-side teleporting between
        spaces</p></li><li><p>Fixed possible problem where the client could get stuck
        'dithering' when told of a physics correction.</p></li><li><p>ownClient (a.k.a client) property is no longer available on cell
        entities that do not have a witness.</p></li><li><p>A possible memory corruption could have occurred if a navigation
        controller was cancelled while it was moving the entity. This may have
        occurred, for example, by a range trigger being activated.</p></li><li><p>Fixed issue with having two range triggers at the same distance
        from the same entity.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7723"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><code class="code"> BigWorld.configureConnections </code> does not work with
        multiple CellApp's. The connection is only modified on the local
        CellApp, and the change is not propagated. This means that a
        connection may be open on one CellApp and closed on another
        one.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e7732"></a>BigWorld Technology 1.6 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7735"></a>1.&nbsp;Renamed Files</h2></div></div></div><p>A number of components and utilities have been renamed in BigWorld
    Technology 1.6, to make them more consistent or identifiable as a part of
    the BigWorld Technology middleware. We apologise for the inconvenience
    this will cause to customers who have modified source code.</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"> CellApp </em> is the new name for
        the cell.</p></li><li><p><em class="emphasis"> CellAppMgr </em> is the new name
        for the cellmgr.</p></li><li><p><em class="emphasis"> BaseApp </em> is the new name for
        the lcproxy, lproxy, lcpm, proxy, base, FEP.</p></li><li><p><em class="emphasis"> BaseAppMgr </em> is the new name
        for the gcproxy, gproxy, gcproxymgr, gcpm.</p></li><li><p><em class="emphasis"> DBMgr </em> is the new name for the
        database, db.</p></li><li><p><em class="emphasis"> LoginApp </em> is the new name for
        the loginsvr, login.</p></li><li><p><em class="emphasis"> bwmachined </em> is the new name
        for machined. Its conf files are <code class="code"> $HOME/.bwmachined.conf </code>
        (preferred) and <code class="code"> $SYS/bwmachined.conf' </code> .</p></li><li><p><em class="emphasis"> bots </em> is now built from the
        bots directory not the bot directory.</p></li><li><p><em class="emphasis"> bwlogger </em> is now built from
        the bwlogger directory not the logger directory.</p></li><li><p>Server tools that are not compiled have been moved to
        bigworld/tools/server from bigworld/src/server/tools.</p></li><li><p>Server tools that are compiled remain where they are as sources
        but install their compiled Hybrid config binary into
        bigworld/tools/server.</p></li><li><p>Server misc scripts have been moved to
        bigworld/tools/server/misc from bigworld/src/server/scripts.</p></li></ul></div><p>Additionally all components are now built from the same directory as
    their name. <br> The first letter of elements in the names of prime
    server components are capitalised when written. <br> The names of the
    background daemons bwlogger and bwmachined are not capitalised.
    <br></p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7808"></a>2.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The Controlled Startup and Shutdown system including Disaster
        Recovery has now been implemented. This adds the functionality that a
        running server can be shut down in a controlled manner with its
        complete state written to the database. The game can later be
        restarted with this state recovered. The game's state can also be
        written automatically over time as a form of disaster recovery, in the
        event of a total power failure or other catastrophe that is beyond the
        means of the Fault Tolerance system. Only entities which exist in the
        database (i.e. have a database ID) are subject to this scheme. All
        space data is also written out, backed up, and restored, as is the
        game time. When an entity is automatically backed up it will receive
        the 'onWriteToDB' callback as usual. When an entity is restored it
        will have its '__init__' method called with all its persistent
        properties in their last saved state. Base entities may create their
        cell entity counterparts during startup by calling
        'self.createCellEntity' without any arguments, as the previous space
        ID and the new ideal cell for it are known to the BaseApp. To shut
        down a server and stop the game smoothly, archiving all game data, use
        the control_cluster script with the 'stop' argument. When starting a
        server, to restore an old game, the bw.xml setting
        'dbMgr/clearRecoveryData' must be set to false, otherwise the saved
        data in the database will be cleared and a new 'blank' game will be
        started. See the Server Scripting Guide and Server Operations Guide
        for further details on this new system.</p></li><li><p>The maximum number of exposed client, base and cell methods has
        been increased from 62 or 64 up to 15872. For entities that use less
        methods than the old limit, there is no network efficiency penalty.
        For entities that use more, all the messages after (roughly) the old
        limit require an extra byte to identify them, so put the more
        frequently used methods first in the entity definition. The number of
        'efficient' methods and the highest user of each category is displayed
        when the entity definitions are loaded.</p></li><li><p>Inheritance in entity definition files has been improved. Any
        value not specified is now inherited from the parent definition. LoD
        levels are merged - any matching labels are modified by the child and
        any new levels are added. LoD levels no longer need to be sorted.
        Volatile information replaces any inherited definition. And lastly,
        parent types no longer need to be listed in entities.xml before child
        types that inherit from them.</p></li><li><p>Added example code for implementing a secure login, where
        passwords are not sent in the clear. The example uses the OpenSSL
        library's RSA public key encryption facilities. This code is disabled
        by default. It is enabled by defining USE_LOGIN_ENCRYPTION to 1 in the
        LoginApp Makefile. On client it is enabled by defining
        LOGIN_ENCRYPTION to 1 when compiling servconn.cpp, or defining
        USE_LOGIN_ENCRYPTION if using BigWorld
        makefiles(bigworld/src/server/common/common.mak).See the Server C++
        Programming Guide for further details.</p></li><li><p>Vehicles may now check the passengers that wish to board or
        alight them. The callbacks onPassengerBoardAttempt and
        onPassengerAlightAttempt are called on the vehicle with the passenger
        as their argument. If the method exists and returns false, the
        operation is disallowed, and a physics correction is sent to the
        client that attempted it. Note that this callback must be a ghost
        method, so it is not the place to reserve a place on a vehicle. It
        could however be the place to check that a place has been reserved by
        some other method.</p></li><li><p>Settings in bw.xml may now be inherited by specifying a
        'parentFile' section with the name of a file containing default
        settings. The feature is recursive, so the parentFile can have its own
        parentFile, and so on. The file bigworld/res/server/defaults.xml
        should be used as the end of the chain. The C++ API to BWConfig
        settings has also been improved, with the new methods BWConfig::update
        and BWConfig::get replacing the many old macro-generated methods.See
        the API documentation for further details.</p></li><li><p>Change the bw.xml setting 'debugConfigOptions' to either 1 or 2
        to debug the settings themselves.</p></li><li><p>To simplify the running of multiple LoginApps, there is now a
        bw.xml setting 'loginApp/shutdownSystemOnExit'.</p></li><li><p>To simplify the continuous running of a system, there are now
        the bw.xml settings 'dbMgr/shutdownBaseAppMgrOnExit' and
        'baseAppMgr/shouldShutDownOthers'.</p></li><li><p>Mercury now has an API 'drainSocketInput' to invert the priority
        of timers and network input, so that all network input is drained
        before any more timers are handled. The CellApp may call this method
        when it is overloaded.</p></li><li><p>Mercury has additional debugging information on the amount of
        various system calls made, which provide insight into the behaviour of
        a Nub under various conditions. The CellApp outputs some of these
        values to its log when it is overloaded.</p></li><li><p>Mercury now provides methods to reset just the local part or
        just the remote part of a Channel. This makes possible their
        asynchronous setup and teardown.</p></li><li><p>The number of ghosts created and reals offloaded to one CellApp
        per 'check' can now be limited with a setting in bw.xml.See the Server
        Operations Guide.</p></li><li><p>The maximum proportion of CPU to offload at a time can now be
        specified in bw.xml with the balance/maxCPUOffload option.</p></li><li><p>Mercury now has three new functions to probe the receive window
        in a Channel: lastReceivedSeq, holesBeforeSeq, nextHoleAfterSeq. These
        report on the quality and other conditions of the input side of a
        Channel.See the API reference for further information.</p></li><li><p>Added an option in the ServerConnection class to only deliver
        entity messages in order. Other messages (such as onEntityMove) will
        still be delivered out-of-order (if the packets are received
        out-of-order), but entity property updates and method calls will
        always be presented in order. This may be useful for games whose
        scripts cannot cope with out-of-order updates. Note however that
        dropping a single packet will then block the progress of the game (the
        scripted part at least) as the client will have to wait until the
        server receives notification of the dropped packet, and then resends
        it.</p></li><li><p>Further physics checking mechanisms have been implemented. The
        entity's speed is now checked against the specified 'self.topSpeed'
        value, with limited leniency to cope with network jitter. A network
        latency variance debt of up to 150ms may be accumulated. This default
        resulted from considerable research on the subject; nevertheless the
        limit may be modified using its watcher. Gateway traversals are also
        checked against the scene (as well as via 'gatekeep') by simulating
        movement to the gateway source, then from the gateway destination to
        the final position. A hook has also been added to validate
        game-specific physical laws: CellApp extensions can define a custom
        physics validator and set it into the g_customPhysicsValidator
        function pointer to impose their own rules on client entity
        movement.</p></li><li><p>The DBMgr's MySQL interface may now be compiled against the
        MySQL v4.1 client libraries.</p></li><li><p>The MySQL database interface now supports the BLOB property data
        type.</p></li><li><p>Whole populated spaces can now be safely removed from the
        CellAppMgr and destroyed. See the documentation for the entity method
        'self.destroySpace', and the callback 'onSpaceGone'.</p></li><li><p>Watchers of bools may now be set with the strings 'true' or
        'false' as well as the old '0' and '1'.</p></li><li><p>The methods of the complementary component of a MailBox may now
        be accessed through the name of that component on any mailbox. e.g. to
        access the methods of the corresponding cell entity from a
        BaseMailBox, simply use the '.cell' attribute on the BaseMailBox. The
        call is still sent to the base entity first and then automatically
        redirected to the cell part.See the Server Scripting Guide for
        restrictions on use.</p></li><li><p>Converting MailBoxes to strings in Python now yields useful
        human-readable debug output.</p></li><li><p>DataSections in Python now expose int64 type operations:
        readInt64, writeInt64, and asInt64.</p></li><li><p>The level of messages that server components send to bwlogger
        can now be adjusted via the outputFilterThreshold bw.xml setting or
        the 'logger/filterThreshold' watcher.</p></li><li><p>More detailed reasons for login failure are now available in the
        LogOnStatus enumeration, instead of only being available as
        strings.</p></li><li><p>A cell entity's client MailBox can now be accessed via
        'self.ownClient' as well as 'self.client'. This corresponds better to
        the OWN_CLIENT flag in entity definition files, and it is recommended
        that game scripts use the new name for code clarity. Also, in entity
        definition files, 'OTHER_CLIENTS' may be used as well as
        'OTHER_CLIENT', and 'ALL_CLIENTS' may be used as well as 'ALL_CLIENT',
        matching the related Python attribute names.</p></li><li><p>Binary data in DataSections can now be manipulated from Python
        with the 'asBinary' attribute. This is an expensive operation on XML
        files, equivalent to saving out the file to disk, so use it
        judiciously.</p></li><li><p>In entity definition files, the new HasDBNameKey can be set to
        false, to indicate that even though a entity has a property named the
        same as the database entity name key, it should not actually be used
        as such a key. In this case, no index on name will be created in the
        database, and it will be possible to add multiple entities with the
        same (possibly empty) name property. This is useful for backing up
        entities that have inherited the name property, but do not use it, or
        only use it generically (e.g. many entities derived from Avatar and
        called just 'Guard').</p></li><li><p>The last message that each component prints before terminating
        normally is now consistent. They are all now of the form 'Component
        Name has shut down.'</p></li><li><p>Chunks created from shells with custom hulls are fully supported
        by the server.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7905"></a>3.&nbsp;New Tool Features</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7908"></a>3.1.&nbsp;bots</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The bots tool has been extended to be capable of running
          scripts. This is enabled with the bw.xml setting 'bots/scripts'. The
          scripting environment does not approach the richness of the client
          scripting environment, but it is still very useful for large-scale
          testing of behaviours more complex than just moving around. There is
          however a performance penalty for tracking all the entities for each
          bot, so scripts should only be enabled when required. The scripts
          are read from the 'res/entities/bot' directory.</p></li><li><p>The bots tool now accepts a '-randomName' command line flag
          (or 'bots/randomName' in bw.xml) to generate random login names that
          start with "bot_", so that the option to allow logins with duplicate
          names need not be enabled. Various other improvements to the bots
          tool have also been made.See the Server Operations Guide for further
          details.</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7918"></a>3.2.&nbsp;control_cluster</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The control_cluster script can now start a server on a limited
          set of machines specified in the optional final argument as a
          regular expression. This includes starting on just one
          machine.</p></li><li><p>control_cluster can be instructed to create bots or not with
          the <code class="code"> -bots </code> and <code class="code"> -noBots </code>
          arguments.</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7934"></a>3.3.&nbsp;Space Viewer</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Space Viewer can control the updating of entity position in a
          space with its 'Update Entities' option. <br> It can also display
          the rectangle bounding 95% (or thereabouts, it's configurable) of
          the real entities on a Cell, which is used by the new load balancing
          algorithm.</p></li><li><p>The colours of elements and various other options can now be
          configured in Space Viewer.</p></li><li><p>If Space Viewer is started with a space ID but no user ID it
          assumes the current user ID.</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7949"></a>3.4.&nbsp;GMeter</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>A new tool gmlogger has been created. <br> This is a handy
          little console utility to save the log that gmeter would without
          actually running gmeter (which may fall foul of various Tk
          disturbances). The log can later be opened and viewed with
          gmeter.</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7958"></a>4.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>A new, global load balancing algorithm has been implemented. It
        is easier to direct than the previous algorithm, and thus more quickly
        converges on optimal cell configurations. This in turn leads to a more
        stabilised operating environment for cell entities. You may notice
        that Cells no longer have a site position or an id. The Cell state of
        'adding' or 'removing' is also gone. The Space Viewer tool has been
        revised to monitor the new algorithm.</p></li><li><p>The traditional management of adjacencies between Cells, whose
        existence was dictated by the CellAppMgr, has also changed into a
        system where CellApps determine the need for a Channel by themselves
        and based on demand of entities on their Cells, rather than just
        proximity of Cells. The new system avoids many of the synchronisation
        problems of the previous one, and is thus more robust.</p></li><li><p>The order of starting processes has been significantly relaxed.
        All global processes may be started at any time and in any order. The
        global processes must still however be present within a few seconds of
        starting CellApps and BaseApps (the CellAppMgr and BaseAppMgr
        respectively).</p></li><li><p>The game will now only start running after a specified number of
        BaseApps and CellApps have started. These values can be specified with
        the 'desiredBaseApps' and 'desiredCellApps' options in bw.xml. When
        the first Cell has been created, the 'onCellAppReady' method will be
        called on the cell personality script on its CellApp. It is passed a
        boolean value indicating True if the game has been resumed from the
        database. The previous 'startup' method is still called but is now
        considered obsolete. Neither of these methods are called if the
        default space option is disabled - in that case the game should be
        started from the database.</p></li><li><p>The system of client control of cell entity position has
        changed. Previously, a client always controlled its own entity, and
        could control other entities (without restrictions) by adding that
        entity to the list of wards maintained by its proxy. This had a number
        of problems which have been solved by a new and better design. Every
        real cell entity now maintains a BaseMailBox of the proxy for the
        client that is controlling it, in a new property 'controlledBy'. If
        the entity's position is not controlled by any client but rather by
        the server (through scripts, controllers, etc.), then the property's
        value is None. The list of wards on the BaseApp is still correct and
        reflects changes made to controlledBy properties of cell entities, but
        it is now read-only to scripts. This system leads to two important
        outcomes: Firstly, when physics checking is enabled, the entity that
        is being moved now knows who is moving it and thus who to send the
        physics correction to. Secondly, whenever an entity is being
        controlled by a client, and a server script intercedes and sets its
        position directly - such as for teleporting, especially when to
        separate spaces - the entity is then treated as if a (no fault)
        physics correction has just been made, so the new position details are
        sent down to the client and stale upstream positions are discarded.
        Note however, that using a server-side movement controller, or
        constant setting of entity position from script, on an entity
        controlled by a client, is neither recommended, efficient, nor
        supported. Also note that controlled entities must still remain within
        the AoI of the controlling client's entity.</p></li><li><p>Position updates from the client that indicate a teleport to a
        different space are now only allowed through gateways, which can
        additionally check that the traversal is allowed via the (ghost)
        callback method 'gatekeep'. Previously no gateway checks were made,
        and also the entity had to be lucky to find the destination space ID
        on the same CellApp, which would not always be the case. Note that if
        you do not use gateways, you will have to change from using
        client-side teleports to using server-side teleports, even if you have
        not enabled general physics checking. This is usually better from a
        script's point of view, and is more secure.</p></li><li><p>The client is kept informed of entities that it controls through
        new 'controlEntity' messages in the client interface. Also, physics
        corrections and other positions forced to clients for entities that
        they control no longer overload the 'detailedPosition' message,
        instead there is a new 'forcedPosition' message for those
        cases.</p></li><li><p>The concepts of RealType, BaseType and InstantiationType which
        were previously specified in entity definitions are no more. Any
        entity can now have a base if it has a base script and is instantiated
        on the BaseApp first (bases cannot be later added to entities which
        were instantiated on the CellApp first). On the BaseApp, a base entity
        is a proxy if its Python class derives from BigWorld.Proxy instead of
        BigWorld.Base. Any entity can now have a cell part if it has a cell
        script and is instantiated on the CellApp, either directly, or by an
        existing base. Any cell entity can now have witnesses, if its base is
        a proxy, and a client is attached to that proxy. Every entity that has
        a client script will now be instantiated on clients, when within the
        client entity's AoI. <em class="emphasis"> Important: </em> The
        client script is not parsed by the server, but must be present and
        non-empty in the 'res/entities/client' directory, even if the BigWorld
        Python scripting system is not used by the actual client
        application.</p></li><li><p>The presence of witnesses on a cell entity is now linked to
        demand. When the client attaches to a proxy, a Witness object is
        created by the CellApp on the cell entity to collect and manage the
        entity's AoI. When the client detaches from the proxy, the Witness
        object is destroyed, and the cell entity reverts to being an ordinary
        cell entity. If the client is already attached to the proxy when it
        creates its cell part (and it has called enableEntities), then the
        Witness object is created soon after the underlying entity, before any
        ticks have passed, but after the entity's <code class="code"> __init__ </code>
        method is called. This is intentionally before any data is sent to the
        client, so the script may set up client properties to their desired
        initial values - however the 'self.client' attribute is not yet
        available so client methods may not be called at that time. This means
        that clients can now move freely between proxies, and their AoI will
        be correctly managed on the CellApp, and correctly populated,
        maintained, and flushed as necessary to the client. The Python
        attributes 'stealthFactor', 'setAoIRadius', etc. are only available to
        cell entities that have a Witness.</p></li><li><p>The life cycle of an entity across the BigWorld Server
        components is now better defined. Most entities start out life on the
        BaseApp. They are read in from an entry in the DBMgr or created
        directly from script, and all their base properties are available as
        part of the base entity. Beginning in this version, all their cell
        properties are now also available in a special attribute of the base
        entity called 'cellData'. This attribute is accessed as if it were a
        dictionary. The cell properties can be manipulated to change anything
        about the future cell entity, including its built-in properties of
        position and direction. When the base entity creates its cell entity
        part with 'self.createCellEntity', 'self.createInNewSpace', or
        'self.createInDefaultSpace', the cell properties are no longer passed
        into those calls, instead they are taken back out of the cellData
        attribute and sent to the CellApp to create the entity. The cellData
        attribute then becomes inaccessible to the BaseApp. During this period
        with both entities in existence, either entity can initiate a write of
        its data to the database, with a call to 'self.writeToDB'. A database
        entry is created for the entity if it does not yet have one. The
        'onWriteToDB' callback is called on both entities to allow themselves
        to prepare their properties for archiving. Also in this state with
        both entities instantiated, either entity can destroy the cell entity.
        The cell entity can call 'self.destroy', and the base entity can call
        'self.destroyCellEntity'. In both cases, the cell entity will get an
        'onDestroy' callback (instead of 'onWriteToDB') to allow it to tidy
        itself up before it is destroyed. Its properties at that time are then
        returned to the base entity's cellData attribute, and the 'onLoseCell'
        callback is called on the base entity. The base entity is not
        automatically destroyed when the cell entity is destroyed. If it wants
        to destroy itself in this case it may do so from the 'onLoseCell'
        callback. Also, a base entity cannot destroy itself when it has a cell
        entity; it must first arrange for the cell entity to be destroyed.
        Instead of destroying itself when its cell entity does, the base
        entity may instead choose to recreate the cell entity at some later
        stage, potentially in another space, and possibly having further
        modified its cellData in the meantime. If the base calls
        'self.writeToDB' when it does not have a cell entity, then any changes
        it has made to the cellData are still written to the database.</p></li><li><p>The Base.destroy method on the BaseApp takes two optional
        keyword arguments that determine what to do with the entity's database
        entry. The first is 'writeToDB', which defaults to true if the entity
        exists in the database. If this is changed to false by 'self.destroy(
        writeToDB=False )' then any changes in the entity will not be written
        to the database. If it is changed to true, then they will be written
        even if the entity did not previously exist in the database. The
        second keyword argument is 'deleteFromDB', which defaults to false. If
        this changed to true by</p><pre class="programlisting">
          
          
          self.destroy( deleteFromDB=True )
        
        
        </pre><p>then the entry for the entity will be removed from the database,
        if it has one. The deleteFromDB argument takes precedence over the
        writeToDB argument.</p></li><li><p>The new bw.xml setting 'baseApp/oldStyleBaseDestroy' turns on
        some legacy code, that allows a base to call 'self.destroy' and have
        its cell entity destroyed first, and if it then doesn't implement
        onLoseCell, have itself destroyed after the cell entity has been
        destroyed. This makes destroying a base entity almost the same as it
        was in the previous version of the server, except that the base is not
        actually destroyed until after the cell entity has destroyed itself,
        so it may still receive some calls during that time window. This
        legacy setting will be removed in a future release, so it is
        recommended that the new entity lifecycle model be adopted in scripts
        as soon as practical. It is a much cleaner model with important
        benefits for the Fault Tolerance and Disaster Recovery systems.
        <br> <em class="emphasis"> Important: </em> Even with this
        setting on, the entity lifecycle improvements will require you to make
        changes to your base entity scripts. Most importantly, the base
        entity's <code class="code"> __init__ </code> method is no longer passed cellArgs
        since 'self.cellData' is there instead.</p></li><li><p>The MySQL database now stores BLOBs and PYTHON properties in
        binary format, instead of a wasteful base 64 encoded format. <em class="emphasis"> Important: </em> Any pickled PYTHON properties that
        you have in your BigWorld 1.5 database will cease to work in BigWorld
        1.6 due to this change. There is no provided mechanism to convert them
        automatically when you upgrade. If this is an issue for you, please
        contact us and we will work out a solution.</p></li><li><p>The chunk loading system has been rewritten. It now loads chunks
        by expanding and contracting the edges of a rectangle of loaded
        chunks. This is more efficient than the previous system which
        continuously scanned the whole area of the Cell. Mappings of multiple
        directories into a space are also better supported, and some race
        conditions and other problems with chunk unloading have been
        eliminated. The 'cellApp/shouldLoadAllChunks' and
        'cellApp/shouldUnloadChunks' are currently disabled - loading is
        always dynamic for now. The loaded area informs the load balancing
        algorithm too, such that it will avoid giving area to a Cell that has
        not been fully loaded by that Cell.</p></li><li><p>The PacketFilter system has been changed and its usability
        improved. A packet filter is now always associated with a Mercury
        Channel, and it is possible to extract extra information about the
        channel, such as the proxy that created it on the BaseApp. It is also
        possible to reserve some space in each packet for custom protocol
        layer overheads.See the Server C++ Programming Guide for further
        information.</p></li><li><p>The units of all absolute times and delays in bw.xml settings
        have now been standardised as seconds, instead of a mix of seconds,
        milliseconds, and microseconds. Various other cleanups, restructurings
        and name changes of options have also occurred, in particular the
        settings for each component are now in a subsection named after that
        component. See the Server Operations Guide and the server/defaults.xml
        file for all the current details. <br> <em class="emphasis">
        Important: </em> Make sure to upgrade your existing bw.xml file
        to use the new names and to specify server/defaults.xml as its
        parentFile. Consult the server/bw.xml file in fantasydemo/res for an
        example.</p></li><li><p>The BaseApp entity method 'self.writeToDB' now takes an optional
        completion callback function instead of an optional integer user
        argument. The callback is called with two arguments when the database
        write operation completes, a boolean indicating success (True) or
        failure (False), and the entity that the write was attempted on. Note
        that with the improved entity lifecycle architecture, all database
        writes begin at the cell entity, so when a base entity that has a cell
        entity calls 'self.writeToDB', its properties are not sampled (and its
        'self.onWriteToDB' is not called) until after the operation has been
        to visit the CellApp and returned to the BaseApp.</p></li><li><p>No warning is now generated for accessing the id or built-in
        properties (that start with an underscore: '_') on destroyed entities.
        These are OK to access for e.g. removing entities from lists after
        they are destroyed.</p></li><li><p>Server components embedding Python have upgraded to Python 2.4
        from Python 2.3. The source to Python in our distribution has moved to
        live in /src/lib/python from /src/lib/Python-2.3. Note that some of
        the server tools require wxWindows, which does not yet have a Python
        2.4 specific version, so take care if you intend to upgrade your
        installed Python executables. (However the version of Python used by
        the server tools is unrelated to that used by the server components
        internally.) Also, the automatic Python/C++ type converters now accept
        PyLongs when passed into ints, floats, etc., since Python 2.4 uses
        PyLong in more cases than Python 2.3, specifically for integers larger
        than 31 bits (e.g. the unsigned constant 0xFFFFFFFF now results in a
        PyLong).</p></li><li><p>All server binaries and object files are now compiled with gcc
        3.4.3. If you are compiling extensions it is recommended to use this
        same version of the compiler. The binaries are linked against
        libstdc++.6.so, so you will need to install this if you don't already
        have it (Fedora Core 2 and below). You will also need to update your
        gcc glue library 'libgcc_s.so.1' if it is older than the gcc 3.3
        version (RedHat 9 and below; RPMs from Fedora Core 2 work
        fine).</p></li><li><p>A number of generally uninteresting log messages have been
        disabled to reduce the amount of log output, especially when the
        system is overloaded.</p></li><li><p>The bwlogger daemon can now attach to components that were
        already running when it was started. So if a bwlogger is lost, the
        system no longer needs to be restarted to start seeing its log output
        again. A number of other features have also been added to bwlogger for
        filtering messages, attaching and detaching, etc. This necessitated
        changes to bwmachined which has made it incompatible with the old
        protocol, so the new version should be used consistently on all
        machines on a LAN.</p></li><li><p>The Entity::callback method on the CellApp now always consumes a
        reference to its args, even if the entity has been destroyed. This
        makes it easier on the caller of the method.</p></li><li><p>The default bots controller data is now
        'server/bots/test.bwp'.</p></li><li><p>Python types and other objects that do not naturally live in any
        module are now documented in a special 'NoModule' section in the
        Python documentation. Previously some were documented in the
        'BigWorld' module section, which is now reserved for the type objects
        that are actually present in that module.</p></li><li><p>The stampsPerSecond() C++ function now returns a uint64, since
        processors are approaching the magic 4.2GHz point where a uint32 would
        overflow. Also, a stampsPerSecondD() function has been added that
        returns the quantity as a double, as this form is frequently
        desirable.</p></li><li><p>The Python boolean objects True and False are now used (instead
        of 1 and 0) when boolean values are passed from C++ into
        script.</p></li><li><p>The old 'CellApp' module containing an alias for the
        'BigWorld.createEntity' function has now been retired. The
        createEntity function is now only accessible through its natural
        BigWorld module.</p></li><li><p>On the CellApp, 'BigWorld.createEntityOnBaseApp' is the new
        preferred name for 'BigWorld.createEntityOnBase', although the old
        name will continue to work for some time. Both methods now take cell
        properties as well as base properties, if the entity has a cell
        script. The cell properties will be transferred to the cellData object
        of the new base entity.</p></li><li><p>The BaseApp function 'BigWorld.lookupBaseByName' now has an
        alias 'BigWorld.lookUpBaseByName'.</p></li><li><p>For a base entity, 'self.databaseID' is now 0 instead of None
        when it does not have an entry in the database.</p></li><li><p>The maximum number of entity types has been reduced to 8192 from
        16384 to allow more MailBox permutations.</p></li><li><p>Watcher nubs now always bind to and listen only on the
        'monitoringInterface' setting from bw.xml. The same socket is now used
        to send log messages to bwlogger.</p></li><li><p>The bw.xml setting 'useSysLog' has been removed as has the
        corresponding functionality. <br> All logging should go through
        bwlogger.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8092"></a>5.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The case where the last CellApp is lost is now handled
        correctly. <br> At this point the system will need to be restarted
        and entities recovered from the database.</p></li><li><p>Fixed a subtle bug inserting range triggers into the range list
        on the CellApp. Some entities could be missed and/or counted twice
        when entities are very close together, which resulted in spurious
        enter and/or leave calls to the AoI and script.</p></li><li><p>Implemented some missing parts of BigWorld.lookupBaseByName on
        the BaseApp (missing in DBMgr).</p></li><li><p>Fixed some reference leaks building lists of entities in the
        CellApp for script calls (PyList_Append does not steal a
        reference)</p></li><li><p>Fixed a reference leak to non-ghosted properties when entities
        are offloaded.</p></li><li><p>Fixed a memory leak where remaining history event buffers were
        not disposed when an entity was destructed. Also a reference leak to
        the arguments of buffered script calls in the same case.</p></li><li><p>Fixed some other small reference and memory leaks.</p></li><li><p>Fixed a crash bug in Controller::standardCallback that occurred
        if the called function destroyed the entity, and took longer than a
        tick to do so.</p></li><li><p>Fixed a crash bug when a Python method argument could not be
        extracted from a stream. The value None is now substituted for the
        argument if there was a problem streaming it off, such as an
        unpickling error.</p></li><li><p>Implemented SafeReferenceCount in Linux, since there may be
        multiple threads concurrently accessing the same smart pointer. It is
        based on the efficient 'lock xadd' instruction just as in Windows.
        This solves a number of found bugs and a much greater number of
        potential bugs.</p></li><li><p>Fixed a problem with fault tolerance that occurred if a CellApp
        offloaded an entity to another CellApp that died before being able to
        onload it. When the CellApp's death is detected, every other CellApp
        checks for entities just offloaded to this dead CellApp and lets the
        BaseApp know that its information may be wrong, so the entity will be
        correctly restored.</p></li><li><p>Better handling of the case where entities riding on a vehicle
        arrive on a new cell before their vehicle is known to it. If the real
        entity is onloaded but the vehicle is still not found, then the entity
        will get off the vehicle. If the entity is controlled by a client, the
        client will be sent a forced position update (like a physics
        correction), just as for any position change made by the server to
        entities controlled by a client.</p></li><li><p>When boarding a vehicle, cyclical dependencies in the vehicle
        graph are checked for (as far as it is known), so an entity cannot
        board a vehicle that is riding on it.</p></li><li><p>Fixed a number of other bugs discovered when using vehicles with
        multiple cells, mostly related to the range list becoming unsorted.
        Currently, no two range triggers may be the same distance around the
        same entity.</p></li><li><p>Fixed an issue in Mercury where fragments of an unreliable
        multi-packet bundle that was never completed (because other fragments
        were lost) would stay in the bundle reconstruction table until the
        sequence number wrapped around, occasionally forming a corrupted
        bundle. Bundle fragments are now discarded if left untouched for more
        than a minute.</p></li><li><p>Fixed a bug in the CellApp where directed client messages that
        were still unsent when an entity was forced to offload (such as by a
        teleport) were lost. If there are any queued messages they are now
        sent right before the entity is offloaded.</p></li><li><p>Fixed a bug in BigWorld.lookupBaseByName/DBID where if a base
        was not found, then a mailbox for the last base that it did find was
        returned.</p></li><li><p>Fixed a bug in the MySQL database interface where getEntity
        assumed that an entity existed if it was specified by database
        ID.</p></li><li><p>Fixed a bug in the MySQL database interface where child table
        entries were not deleted when the main entry was.</p></li><li><p>Fixed a bug in DBMgr where when a new entity was written to the
        database, its mailbox could not be extracted since its id was not
        available.</p></li><li><p>Fixed a bug in the MySQL database when an update operation did
        not involve changing any data.</p></li><li><p>Removed the limitation of one packet on the length of the
        command string passed to executeRawDatabaseCommand. Larger strings
        previously crashed. The string may now be up to 64KB long.</p></li><li><p>Fixed a possible crash if 'self.destroy' is called by a base
        from its <code class="code"> __init__ </code> method.</p></li><li><p>Spaces are now destroyed when the last entity has left them, and
        they are thus no longer addressable.</p></li><li><p>Fixed a crash in the CellApp that happened when space data was
        added and revoked within one tick. The space data addition method is
        still sent to clients but without the data that has since been revoked
        (as the data is no longer available).</p></li><li><p>The CellApp's DELIVER_GHOSTS profile now monitors channel
        sending again.</p></li><li><p>A "CHEAT" log message is output if a client tries to send up
        more LoD levels than an entity has in requestEntityUpdate.</p></li><li><p>Fixed problem where game time could initially be out of sync, by
        performing script initialisation and loading before the game time is
        retrieved.</p></li><li><p>Fixed bug where messages to the proxy from the client were not
        sent reliably.</p></li><li><p>Fixed the '-f logfile' function of logaround.py.</p></li><li><p>Fixed problems with bwlogger and bwmachined rc scripts
        (especially bwlogger under Debian).</p></li><li><p>Fixed bug where runscript did not work with scripts edited on a
        Windows machine (line termination issues).</p></li><li><p>Fixed a bug where multiple simultaneous attempts to log in to
        the same account were allowed and would conflict. Only one outstanding
        attempt is now allowed. This is just a bug fix not a change in
        behaviour. It is unrelated to attempts to log in to an account which
        is currently logged in, whose handling is unchanged.</p></li><li><p>Fixed a bug in the navigation system where a ChunkWaypointSet
        whose chunk had been unloaded was still considered valid. This could
        lead to a crash when a chunk is unloaded while an entity is navigating
        through it.</p></li><li><p>Fixed an oversight where C++ exceptions generated by Mercury
        could escape to the calling application during login. The exception is
        now caught in LoginReplyHandler::pollForReply, so applications need
        not know anything about Mercury exceptions.</p></li><li><p>Fixed a bug accessing the back of a vector of bools. This is
        broken in VisualStudio .NET 2003's STL library if the number of
        elements is a multiple of 32. (Thanks to NetEase for this fix.)</p></li><li><p>Fixed a bug that prevented Server Viewer from displaying the
        Users page when not all user IDs running servers on the network
        existed on the machine where it was running.</p></li><li><p>Fixed a bug drawing patchy/incomplete graphs in gmeter.</p></li><li><p>Fixed infinite loop when searching for starting line by date in
        bw_log_viewer.cgi.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8218"></a>6.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>No two range triggers may be the same distance around the same
        entity. Doing so is likely to lead to the range list becoming
        unsorted. This includes range triggers added by the system. For
        example, if an entity has a witness attached and thus has an AoI range
        trigger of 400m, then a script may not add a visibility controller of
        the same 400m radius. Radii of 399m or 401m are fine (in a world less
        than 8000x8000 km). Note that LoD levels do not generate range
        triggers, only the entity's AoI radius does. The CellApp verifies that
        its range lists are still sorted every second or so.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e8225"></a>BigWorld Technology 1.5.1 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8228"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Base entities can now have up to 32256 internal methods.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8235"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Before offloading an entity to another cell, the CellApp now
        ensures that all necessary ghosts (from its own real entities) have
        been created there first.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8242"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The CellAppMgr always sends space data to new cells to make sure
        that they do not somehow miss out.</p></li><li><p>Fixed a possible infinite loop during entity offloading.</p></li><li><p>Fixed bigbangd crashes on second reconnection from the same
        client address.</p></li><li><p>Add missing MySQL database commit when deleteBaseByDBID is
        called, so entity is really deleted.</p></li><li><p>Fixed the crash that occurred when reloadScript was called on
        the CellApp.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8261"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>There is a small chance that some entities will not get restored
        when a CellApp is lost. If an entity is in the process being offloaded
        to the CellApp that is lost, it may not be restored.</p></li><li><p>Teleporting between spaces via upstream client movement messages
        does not work if the destination space of the teleport is not known to
        the CellApp that the entity is currently in.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e8271"></a>BigWorld Technology 1.5 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8274"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The cell now only uses a global for the chunk grid resolution,
        which is stored in the chunk library, instead of referencing the
        constant directly. This allows the grid resolution to be changed by
        recompiling just the chunk library (whose source is licensed) and not
        the whole cell (whose source is not licensed).</p></li><li><p>The start script interprets the 'hold' argument to hold xterms
        onscreen after the process it contains has quit.</p></li><li><p>Can now set watcher values in cells and bases on startup via
        bw.xml with the cellApp/watcherValues/ and baseApp/watcherValues/
        sections.</p></li><li><p>Entities and mailboxes are now passed correctly, identically and
        efficiently over the network regardless of the source: cell or base,
        and data type: PYTHON (i.e. pickled) or MAILBOX. (So when you pickle
        an Entity it looks like a Mailbox.)</p></li><li><p>The C++ Entity class now has a 'callback' method which should be
        used by cell extensions to call Python methods on an entity. During
        times when Python calls are not permitted (e.g. iterating over a
        sensitive list), the callback method buffers the request, and calls it
        as soon as Python calls are permitted again.</p></li><li><p>The bw.xml file is now fully documented in the
        fantasydemo/res/server/bw.xml file.</p></li><li><p>The machined.sh installation script now creates a RedHat or
        Debian startup script and installs it at the appropriate location for
        that distribution, including links for the various runlevels. It then
        copies the machined binary to /usr/local/sbin, and starts it running
        (first stopping the old version if it is running).</p></li><li><p>A Mailbox for the base of an entity which has no cell component
        (REAL_TYPE_NO_CELL) may now be passed to and used by the cell.</p></li><li><p>Entity database entries may now be deleted from the database
        with the BigWorld.deleteBaseByDBID method on the base. They may also
        be looked up (returning a base Mailbox if they are checked out) with
        the BigWorld.lookupBaseByDBID and BigWorld.lookupBaseByName methods.
        This involved a number of changes to the IDatabase interface
        implemented by database backends.</p></li><li><p>Base Python scripts may now execute arbitrary database commands,
        with the BigWorld.executeRawDatabaseCommand. It takes and returns (to
        a callback) a string, whose interpretation depends on the database
        backend used. Currently, the XML database executes the string as
        Python, and returns the Python result. The MySQL database executes the
        string as SQL, and returns an SQL table result.</p></li><li><p>Added a control_cluster.py script to start up and shut down a
        server on a cluster of machines, allocating processes to machines
        somewhat intelligently.</p></li><li><p>Space Viewer can display the IP addresses of the cells.</p></li><li><p>Added a 'pollForReply' method to the LoginReplyHandler, to
        simplify the client login process.</p></li><li><p>BaseApp extensions (dynamic libraries) are now loaded from the
        lcproxymgr-extensions directory just like CellApp extensions are
        loaded from the cell-extensions directory. The directory should be
        placed alongside the binary executable.</p></li><li><p>Added a '-u' option to mls to display only BigWorld processes
        running under the current (or specified) user id.</p></li><li><p>Added the 'confirmOnlineStatus' method to ServerConnection for
        use when it is not feasible to call processInput to get that
        information.</p></li><li><p>Added the script 'logaround.py', to extract data around a
        certain date+time (by binary search) from a log file saved out by
        logger. Similar functionality has been added to the bw_log_viewer.cgi
        cgi script.</p></li><li><p>The Default value of a PYTHON property in an entity def file may
        now be specified with a Python expression.</p></li><li><p>Added bot_op.py script to create and control bots. Also added
        various control features to bots.</p></li><li><p>Added an option to limit method calls from the base to the
        client to 512 bytes. This can be useful to debug !singlePacketOnly
        assertion crashes. The option is disabled by default and controlled by
        a define in the src/lib/entitydef/mailbox_base.cpp file.</p></li><li><p>The Python connection port that the CellApp and BaseApp listen
        on may now be set in bw.xml using cellApp/pythonPort and
        baseApp/pythonPort. If they are not specified then the old algorithm
        is used (50000 or 40000 plus cell app / base app id).</p></li><li><p>Added the bw.xml setting baseApp/writePythonLog</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8344"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Component name rationalisation: The LCProxyMgr process is now
        officially known as the BaseApp. However the executable name remains
        'lcproxymgr' and it continues to live in the 'lcproxy' directory. The
        Cell is now officially known as the CellApp, with executable 'cell'
        from the 'cell' directory. WPGen is now known as NavGen. mfpanel is
        now bwpanel. mflogger.cgi is now bw_log_viewer.cgi. The logger
        executable is now bwlogger but is still built from the 'logger'
        directory.</p></li><li><p>The daemon machined now uses the 'name' field in create messages
        to decide which process to launch. This may require updating operation
        scripts that use machined to launch processes.</p></li><li><p>The MF_ROOT and BW_RES_PATH that machined uses to launch a new
        processes are now sourced from either the file '.machined.conf' in the
        home directory of the user requesting the launch, or the system-wide
        file /etc/machined.conf. The latter has a list of MF_ROOT and
        BW_RES_PATH for each defined user id.</p></li><li><p>The enum.xml file now lives in the bigworld resource tree. This
        means that to run fantasydemo you must now have both fantasydemo/res
        and bigworld/res in your BW_RES_PATH. (This was already necessary for
        the client and tools).</p></li><li><p>Client/tools changes (see their release notes) means that
        terrain is now loaded from a binary section inside the '.cdata' file
        of a chunk by default, instead of from a separate '.terrain' file. The
        multidirectory chunk space layout has also changed with the addition
        of a separator folder to improve Windows Explorer browsing speed for
        really large spaces.</p></li><li><p>All base and cell (and client) mailboxes have the same
        properties: component (as a string like BigWorld.component), className
        and id. The clientDetails member that some mailboxes previous had has
        been removed. The BaseMailBox constructor on the base which was
        previously deprecated has now been removed.</p></li><li><p>The calculation of packetArrivalVariance_ in ServerConnection
        has been removed as it is redundant and was tied to an update rate of
        10 hertz.</p></li><li><p>The backupPeriod setting in bw.xml is now found at
        cellApp/backupPeriod and is in seconds instead of ticks. Also
        baseApp/backupFrequency is now baseApp/backupPeriod and is also now in
        seconds instead of ticks. Various other bw.xml settings have also been
        moved and/or renamed. Refer to the fantasydemo bw.xml file for the
        reference settings.</p></li><li><p>The onNoise entity Python method is no longer required for every
        cell entity type when the noise propagation system is used.</p></li><li><p>Optimised range list processing to not regularly allocate memory
        and use less of it.</p></li><li><p>Prints a warning if you use an ARRAY data type in a ghosted or
        own client property. The TUPLE data type should be used in this case
        instead.</p></li><li><p>The updateFrequency notification, when a client attaches to a
        proxy, is now sent reliably. Only the bandwidth notification is sent
        unreliably (to punch a hole through intermediate firewalls).</p></li><li><p>The messages.py and cluster_data.py files used by various server
        tools are now always sourced from
        mf/bigworld/src/server/tools/pycommon/. Make sure you delete old .py
        AND .pyc/.pyo versions of this file. It is really easy to leave behind
        a masking .pyc file so, go and check this now!</p></li><li><p>machined tries to make processes always leave cores, and the
        startup script tries to turn on including the executable name and pid
        in the core file name.</p></li><li><p>The deprecated environment variable BW_ROOT will no longer work
        to set the res path - use BW_RES_PATH instead.</p></li><li><p>There have been a number of minor changes to ServerConnection to
        allow multiple ServerConnections to exist and be in use in the one
        executable. This is related to the optimisation of the 'bots' process.
        The biggest change is that the processInput method no longer takes the
        ServerMessageHandler instance - instead the (previously unused)
        ServerMessageHandler parameter in the logOnComplete method is stored
        for callbacks received during processInput. It can be changed with the
        setMessageHandler mutator.</p></li><li><p>The desired socket receive buffer requested by the Nub has been
        increased to 16MB, due to the different accounting for this buffer in
        recent kernels, and the fact that machines are a bit faster now and
        the cpu is better at keeping up with the available network
        bandwidth.</p></li><li><p>Inter-cell mercury channels now have a window size of 4096
        packets (server-client channels remain at 256 packets). This allows
        more 'bursty' data to be sent over adjacencies between cells. The use
        of this channel is also controlled a bit more tightly by the cells,
        especially in relation to creating ghosts and offloading (see
        cellOffloadMaxPerCheck and cellGhostingMaxPerCheck in bw.xml).</p></li><li><p>Load balancing stability and algorithm revision. Scaleback has
        been replaced by emergency throttle.See the 'throttle' watcher
        directory on a CellApp.</p></li><li><p>The BaseAppMgr tracks the real BaseApp cpu load for load
        balancing instead of estimating from the number of bases on
        each.</p></li><li><p>When making the MySql database columns for a user data type
        property of an entity type, the names for the columns now include the
        name of the property, instead of just being the name bound to. This
        allows an entity to have more than one property of the same user data
        type. Binding to the empty string is now also supported in which case
        just the property name will be used as the column name.</p></li><li><p>The preference and view fields used by gmeter are now in xml
        format for easy review, instead of being pickled Python
        classes.</p></li><li><p>Conversions between integer property types and Python objects
        are now checked more carefully.</p></li><li><p>The filtering of debug messages has been changed to something
        saner. A debug message will now output if its level is greater than or
        equal to the sum of the component's level and the global level. e.g.
        to stop all TRACE messages, raise the global level to 1. To then stop
        DEBUG messages for just one component, raise its level to 1. It's a
        lot more usable now.</p></li><li><p>The output of dumpEntityDescription (a debug tool to analyse
        entity defs) has been improved.</p></li><li><p>The boundaryCheckTime setting in bw.xml has been replaced with
        cellApp/checkOffloadsPeriod (in seconds). There is also
        chunkLoadingPeriod (in seconds), which is how often to check to
        load/unload chunks, and reservedTickFraction (proportion from 0 to 1),
        if there is not this much of the tick left then various functions
        which can be delayed will not execute (loading chunks, creating new
        entities, etc.)</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8426"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed BaseApp crash bug in restoreClient, when the cell which
        contains the cell entity for one of its proxies dies, but that proxy
        had no attached client.</p></li><li><p>Fixed bugs cleaning up adjacencies on remaining cells when a
        cell dies.</p></li><li><p>Fixed problem starting a recovery CellMgr when the '-recover'
        flag was omitted.</p></li><li><p>Fixed race condition where reviver could deactivate before
        replacement component was started.</p></li><li><p>Fixed rare and illogical divide by zero issue in machined that
        nevertheless occasionally happened.</p></li><li><p>Fixed several cases where an entity in the middle of being
        created (or other delicate operation) could be passed to a Python
        method. Now the entity's __init__ method is always called before any
        controllers (e.g. ProximityControllers) pass it into a Python callback
        on another entity.</p></li><li><p>Fixed microseconds count in logger daemon output - they now wrap
        when the second increments, instead of some time in the middle of the
        second.</p></li><li><p>Removed many hardcoded assumptions of a game update/tick rate of
        10 hertz.</p></li><li><p>Fixed two floating point rounding errors when loading chunks
        into the cell, that caused some chunks to be missed.</p></li><li><p>The server now compiles and runs with gcc 3.4.1. We plan to move
        to using that compiler with BigWorld 1.6.</p></li><li><p>Fixed problems with running machined on machines with &gt;= 4GB
        of RAM</p></li><li><p>Many bug fixes to gmeter with adding statistics and components
        and using it under Windows. You can also delete things (statistics,
        etc.) that you have added now.</p></li><li><p>Fixed crash bugs with unloading chunks when an entity was in the
        chunk being unloaded.</p></li><li><p>Logger can now write logs files over 2GB in size.</p></li><li><p>Setting proper default value for position and direction
        properties in the MySQL database.</p></li><li><p>Fixed crash accessing entity.spaceID after the entity has been
        destroyed.</p></li><li><p>Added check to ensure that scripts can only set the position of
        a real entity.</p></li><li><p>Fixed bug where sometimes .pyc or .pyo files were not being
        generated.</p></li><li><p>The BaseAppMgr (aka GCProxyMgr) now synchronises its idea of
        game time with the CellMgr.</p></li><li><p>Fixed wide strings containing NUL characters in XML sections
        (problem was with decoding them from base64).</p></li><li><p>Fixed race condition with changeAdj message from CellMgr to both
        cells - now goes to controlling cell only.</p></li><li><p>Fixed a big memory leak deallocating EntityCache objects! The
        std STL deallocator does not use operator delete.</p></li><li><p>Fixed bug attempting to restore a cell entity that has never
        been backed up. The onLoseCell method is now called on the entity's
        base (if it had one).</p></li><li><p>Fixed bug where a client could overflow a bundle into a second
        packet if the Mercury channel was trying to resent some lost
        packets.</p></li><li><p>Fixed problem setting watcher values to a string with spaces in
        it. The provided string is now copied wholesale into the watched value
        when a string watcher is set.</p></li><li><p>Fixed window where a second createCellEntity requests could be
        made on a base entity before the first one had completed.</p></li><li><p>Make clean no longer deletes .o files that it doesn't know how
        to build (i.e. doesn't have the corresponding .cpp file)</p></li><li><p>The XML database now uses the database/nameProperty setting from
        bw.xml for the name key instead of hardcoded "playerName". The MySQL
        database did not have this bug. Also both databases can now have names
        containing high ASCII characters (above 0x7F).</p></li><li><p>The watcher server no longer hardcodes references to images on a
        host 'oi', instead text is used to indicate different watcher
        types.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8517"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>There is a small chance that some entities will not get restored
        when a Cell Application crashes. If an entity is in the process being
        offloaded to the Cell Application that crashes, it may not be
        restored.</p></li><li><p>Teleporting between spaces via movement messages does not work
        cleanly.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8527"></a>5.&nbsp;GMeter: New/Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Now stores preferences and views in XML files. Script
        pickle2xml.py can be used to convert your old preference files.</p></li><li><p>Statistics can now be deleted(!)</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8537"></a>6.&nbsp;GMeter: Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fixed a bug where log files could not be opened under
        Windows.</p></li><li><p>Fixed bug whereby Function watchers could not be
        displayed.</p></li><li><p>Fixed some stability issues under Windows.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8550"></a>7.&nbsp;Server Viewer: Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Doesn't draw "+" on nodes than cannot be open as
        directories.</p></li><li><p>Correctly determines UID under linux and windows (under windows
        uses text file to map UID to usernames).</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8560"></a>8.&nbsp;Space Viewer: New/Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Can display the IP address of the cells, along with the
        ID.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8567"></a>9.&nbsp;Logger: New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fast filtering of log files via time rather than number of
        lines.</p></li><li><p>Now supports files greater than 2GB.</p></li><li><p>Improved time format.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8580"></a>10.&nbsp;mls: New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added -u option to filter by UID.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8587"></a>11.&nbsp;Misc: New/Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added script to help control server clusters: onEach (see
        documentation in Server Operations Guide)</p></li><li><p>Added script
        bigworld/src/server/tools/scripts/control_cluster.py to control
        clusters (see Server Operations Guide)</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e8597"></a>BigWorld Technology 1.4.2 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8600"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added ability for server viewer to take user id, port, and cell
        id arguments from the command line.</p></li><li><p>Added scripts to launch and install machined on debian and
        redhat.</p></li><li><p>Can now start space viewer from server viewer by right-clicking
        on a <br> cellapp.</p></li><li><p>Added 'shouldUnloadChunks' option to disable unloading chunks
        from bw.xml, and 'shouldLoadAllChunks' option to load them all
        regardless of cell coverage.</p></li><li><p>Added 'Show Colours' option to gmeter to show the statistic
        associated with each colour.</p></li><li><p>Added 'cellmgr/balanceSpacesRate' setting in bw.xml to control
        how often load is balanced among spaces. Also
        'cellmgr/cellAppLoadUpperBound' and 'cellmgr/cellAppLoadLowerBound'
        proportion (0.0 - 1.0) settings.</p></li><li><p>Included some Python documentation that was previously omitted
        due to a syntax error, as well as new documentation of the callbacks
        made into Python scripts at various times.</p></li><li><p>Added a watcher for the load of a cellapp, and a watcher for
        shouldBalanceSpaces in the cellmgr.</p></li><li><p>Added cvskwmerger.py script to fix merge conflicts caused by cvs
        keyword differences (Id and Log) which can occur when importing a new
        release of BigWorld code into a customer's local repository.</p></li><li><p>Network interfaces (i.e. adapters) may now be specified by ip
        address or dns name plus netmask instead of just name, including those
        in bw.xml such as proxyExternalInterface. e.g. '192.168.17.0/8'
        instead of 'eth1'.</p></li><li><p>Added WeakPyPtr that makes a weak reference to a Python object
        look like a C++ smart pointer (for use in C++ classes).</p></li><li><p>Added an addBotsSlowly method to the bots process to add bots
        slowly over time at a specified rate.</p></li><li><p>Implemented backend for base.writeToDB with the XML
        database.</p></li><li><p>Can manipulate int64 values in DataSections through Python with
        the asInt64 attribute.</p></li><li><p>Can now specify a '-v' command line argument for mls, so it
        lists the components registered on each machine as well as just
        machine information.</p></li><li><p>The personality script of the base app now receives the
        'onBaseAppReady' callback with a boolean argument set to true for the
        first ('bootstrap') base app component, and false otherwise. The old
        'startup' method is still called solely on the bootstrap base
        app.</p></li><li><p>Added 'useDefaultSpace' option in bw.xml, which defaults to
        true. If this is set to false then no default space is created by the
        cellmgr on startup and the Base.createInDefaultSpace method is not
        available on the base app.</p></li><li><p>Can now pass strings containing NULL characters through the
        Python interface and associated BigWorld C++ APIs.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8660"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>The useSysLog option in bw.xml is set to false by
        default.</p></li><li><p>Renamed scamm to server viewer.</p></li><li><p>Reduced log output of space viewer.</p></li><li><p>Removed some source and scripts used by the old (defunct) bots
        system.</p></li><li><p>ID recycling has been disabled until it can be fixed
        conclusively.</p></li><li><p>Mercury interface registration and search messages are sent over
        the same network interface as their nub is bound to.</p></li><li><p>Improved binary diff algorithm used by the updater, and its
        source has moved to the resmgr directory.</p></li><li><p>space.settings can contain the 'singleDir' boolean to indicate
        that it is not a new multidir space (for legacy single directory large
        spaces).</p></li><li><p>Server dynamic library extensions are loaded in alphabetical
        order, to ensure any dependency problems between extensions are
        repeatable.</p></li><li><p>Smoothed sending of enterAoI and createEntity messages on the
        cell. They now go onto the priority queue and are sent in the normal
        client update loop, and thus are properly accounted and rate limited
        by the client's bandwidth settings. This greatly reduces the peakiness
        of both load for the cell and data rate for the client, especially
        after login and teleport.</p></li><li><p>Space viewer considers the height of the cell and its
        adjacencies when drawing the cell boundaries.</p></li><li><p>The simpleshutdown.sh and cleanup.sh scripts now only attempt to
        kill processes running under the user id of the invoker, to avoid
        incorrect error messages if multiple servers are being run on a single
        machine.</p></li><li><p>Cancellations of real controllers during onload and restore are
        buffered until the onload/restore is completed, to avoid a possible
        bug.</p></li><li><p>CellChunk is now a ChunkCache instead of deriving from Chunk
        (only affects C++ cell extensions)</p></li><li><p>The cellapp and lcproxymgr now wait to receive ids from the id
        broker before indicating that they are ready.</p></li><li><p>Checks are made that entity Python properties are of the correct
        type before adding them to a stream - instead of only when extracting
        them from the stream. Also an exception is thrown on the base app if a
        script attempts to set a persistent entity property to a value of the
        wrong type.</p></li><li><p>The 'server_entities_guide' has been split into two documents,
        one for Python scripters called 'server_scripting_guide' and one for
        authors of C++ extensions called 'server_cpp_programming'.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8715"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Improved error message in global components if machined is not
        running.</p></li><li><p>Both internal and external login interfaces are publicised so
        clients can discover servers running on their LAN again.</p></li><li><p>Fixed ChunkPortal reference leak when PyChunkCache creates
        them.</p></li><li><p>Fixed a crash when a proxy without a client creates a cell
        entity.</p></li><li><p>The CAT uses BW_RES_PATH now.</p></li><li><p>The cellmgr only adds/removes at most one cell per space at a
        time.</p></li><li><p>Fixed problems deciding if a space has multiple cells.</p></li><li><p>Bots update more smoothly than previously, and at 10Hz instead
        of 100Hz.</p></li><li><p>Cell correctly loads chunks from multidir spaces.</p></li><li><p>Fixed problem where time was not being written on output
        messages from the base and cell.</p></li><li><p>When a client transmits to the proxy from a different port to
        that with which it logged on (due to intermediate firewalls), the
        messages which had already been sent to the client on the first port
        are no longer lost - they are resent as necessary on the correct
        port.</p></li><li><p>Removed erroneous assert that int64s from Python be greater than
        0.</p></li><li><p>Fixed some bugs where -1 was used where INADDR_ANY should have
        been.</p></li><li><p>Fixed bug with opening and creating files via Python in the root
        of the res tree.</p></li><li><p>Fixed some hard to find floating point epsilon accuracy problems
        in the range list code, caused by floats staying in registers instead
        of passing through memory (the rounding is different). Also fixed some
        ordinary floating point problems due to arithmetic order
        differences.</p></li><li><p>Fixed problems compiling with VC++ 7.1 (Visual Studio
        2003)</p></li><li><p>Fixed bug with child database tables in UserDataTypes</p></li><li><p>Fixed bug using wrong transport for method call messages on
        ghost entities on the cell.</p></li><li><p>Fixed handling of default values from entitydef in the database,
        including for UserDataTypes.</p></li><li><p>Fixed bug sorting controllers to get their ids - ids could
        differ between libc's.</p></li><li><p>Worked around a problem with attempting to restore an entity
        that was thought to have been destroyed by a cell crash but which
        escaped just in time.</p></li><li><p>Fixed problem under linux where space viewer hung if a cell
        crashed.</p></li><li><p>Fixed type of parentID in database entity subtables - was
        bigint(11) instead of bigint(20).</p></li><li><p>Fixed operation of BigWorld.getSpaceDataForKey which could
        return values of the wrong key.</p></li><li><p>Fixed race conditions in adjacency shutdown and startup, at the
        inter-cell adjacency level. One cell is selected to always be in
        charge of controlling the adjacency.</p></li><li><p>Worked around race conditions in channel shutdown and startup,
        at the inter-cellapp channel level. CellAppChannels always remain once
        created, so one component cannot reset its Mercury channel sequence
        number when the other component has not.</p></li><li><p>Fixed problem passing cell mailboxes to the lcproxymgr, where
        the mailbox could not be created if the type of the entity to which
        the mailbox referred could not exist on a BaseApp (i.e. if it was
        BASE_TYPE_NONE).</p></li><li><p>Fixed offloading an entity that has another entity in its AoI,
        where the other entity has multiple LoD levels but does not exist on
        the new cell.</p></li><li><p>Fixed bug deleting EntityTypes in egclient4 and
        egclient2.</p></li><li><p>Fixed bug unloading chunks on the cell when entities were still
        in the chunk.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8809"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Script callbacks when creating or starting controllers during
        entity onload can cause a crash if the entity is destroyed or
        teleported to another cell (or etc.) by the callback. A fix has been
        prepared but has not yet been sufficiently tested and so was not
        included in this release.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e8816"></a>BigWorld Technology 1.4.1 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8819"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added support for logging on to an existing entity.</p></li><li><p>Added a new bot process.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8829"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added a proxy callback onClientGetCell. This is called when the
        message is sent to the client that it now has a cell entity.</p></li><li><p>The login process now has an internal and an external
        interface.</p></li><li><p>Exposed Entity.bandwidthPerUpdate script method.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8842"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>BigWorld.setSpaceTimeOfDay script method no longer incorrectly
        raises an exception.</p></li><li><p>isGuest attribute of an entity in the XML database is no longer
        clobbered.</p></li><li><p>EntityVision now behaves better when the controller is changed
        in response to an onStopSeeing or onStartSeeing call.</p></li><li><p>Reduced to amount of log output.</p></li><li><p>Improvements to MySQL database interface including writing
        position and direction.</p></li><li><p>Fixed possible server crash with having a proxy that does not
        have an associated client.</p></li><li><p>Proxy.giveClientTo script method now works if the destination
        entity does not have an associated cell entity.</p></li><li><p>Improved support for the case where there are two NATing
        firewalls between the server and the client.</p></li><li><p>Fixed reference-counting bug with the BigWorld.globalBases
        subscript operator.</p></li><li><p>Cancelling a proximity controller from proximity controller
        callback now works.</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e8876"></a>BigWorld Technology 1.4 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8879"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Fault tolerance for all server components.</p></li><li><p>Database support for reading and writing entities.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>onDBWrite is called on the script entity that is being
        written</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>MySQL support for the database process (including user data
        types).</p></li><li><p>Physics checking on the server.</p></li><li><p>Time synchronisation between all server processes.</p></li><li><p>Global bases visible to all base apps.</p></li><li><p>Client network latency statistics and call backs for
        proxies.</p></li><li><p>Online co-ordinated server resource updates</p></li><li><p>Client (and optionally server) authentication to prevent spoof
        attacks</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8915"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Improved load balancing - can now migrate spaces between cell
        applications</p></li><li><p>Better entity ID management</p></li><li><p>Improved script interface to space data / cell-only space
        data</p></li><li><p>Can get time of day for a space from script on the cell</p></li><li><p>Multiple res path aggregation per directory</p></li><li><p>Entities script can now be in any directory of
        BW_RES_PATH.</p></li><li><p>ResMgr now used to read files from Python</p></li><li><p>Updater can now send zips and diffs (and zipped diffs) instead
        of whole files</p></li><li><p>database/allowEmptyDigest and database/createUnknown options add
        to bw.xml</p></li><li><p>Can now specify a database entry as isGuest. This means that
        this account can be used more than once at a time.</p></li><li><p>BaseApp now has a personality script like CellApp</p></li><li><p>Players no longer have a fixed ObjectID</p></li><li><p>Improved cell fault tolerance - CellMgr also detects cell
        death</p></li><li><p>Login path mods and proxy features allowing account
        entities</p></li><li><p>Clients can connect to entities that do not have a cell entity
        (i.e. base only)</p></li><li><p>Improved egclient examples (including example of account)</p></li><li><p>Base.clientDead script callback renamed to
        Base.onClientDeath</p></li><li><p>Proxy does not need to be destroyed when client is lost.</p></li><li><p>BigWorld.createBase can now create entity of type Proxy</p></li><li><p>Base.onLoseCell script callback added.</p></li><li><p>Added more support for debugging entity defs.</p></li></ul></div><p></p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"> Interface changes </em></p></li><li><p>TimeQueueHandler::onRelease now takes TimerId and void *
        pUser</p></li><li><p>Controller::startReal and Controller::stopReal now take a bool
        parameter that indicates whether it is from an offload or not</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Base entity is now responsible for creating the cell
        entity.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Base script now creates the cell entity on the cell when logging
        in. <br></p></li><li><p><em class="emphasis"> Removed features </em></p></li><li><p>BigWorld.addTimer deprecated</p></li><li><p>mload no longer support. Should use runScript instead.</p></li><li><p>Disabled hard-coded bots</p></li><li><p>Removed old script related to friends.</p></li><li><p>Can now have relative paths in paths.xml</p></li><li><p>Using zlib 1.2.1, instead of 1.1.3</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9025"></a>3.&nbsp;Important Notes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>It is now the responsibility of the base entity to create the
        cell entity when a player logs in. Previously, the cell entity was
        created automatically in the default space. Something like the
        following should be added to the onEntitiesEnabled method on the base
        of the login entity type: <br> self.createInDefaultSpace(
        cellArgs["pos"], cellArgs["dir"], cellArgs )</p></li><li><p>When the cell entity is destroyed, the onLoseCell method is
        called on the base entity. Previously, the base entity was
        automatically destroyed. If this is the desired behaviour, you should
        add a call self.destroy() in the onLoseCell method.</p></li><li><p>Base.onClientDeath called when the client connection is lost. To
        log this player out, call self.destroy().</p></li><li><p>Make sure that Base methods that are called from the client are
        set as &lt;Exposed/&gt; in the def file.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9043"></a>4.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Mercury bullet-proofing</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Mercury can handle packets with all footers and no body data,
        also fixed problems with long (multipacket) messages</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p>Can now only call exposed methods on the base and cell from
        client</p></li><li><p>Removed built-in C++ 'group' from base (can now be done in
        script)</p></li><li><p>Fixed remainingLength in MemoryIStream</p></li><li><p>More efficient SimpleSemaphore</p></li><li><p>Can run Python multithreaded on proxy and base (for updates
        mainly)</p></li><li><p>Timer/callback ids no longer wrap around and are more
        efficient</p></li><li><p>Fixed problems offloading proximity and vision
        controllers</p></li><li><p>"create-entity" messages can be delayed on a queue if cell short
        on time. This helps with spikes in load.</p></li><li><p>Network interface indices no longer assumed to be
        consecutive</p></li><li><p>SpaceViewer now handles the case where the current cell is
        shutdown while we are connected to it.</p></li><li><p>Fixed problem with loss of space data when restoring a space
        that has lost all cells</p></li><li><p>Fixed memory leak when entities are destroyed</p></li><li><p>Fixed problem where errno could be changed by a PacketFilter
        before we inspected it in Nub::send</p></li></ul></div></div></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e9094"></a>BigWorld Technology 1.3 -- Server Release Notes</h2></div></div><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9097"></a>1.&nbsp;New Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Cells are now fault tolerant. Entities are backed up onto the
        base regularly, and can be restored into the world should the cell
        disappear. To have entities survive a cell crash, you must have a base
        entity instantiated.</p></li><li><p>Chunks are now dynamically loaded and unloaded, saving memory in
        large scale worlds.</p></li><li><p>Login process can be scripted to avoid creating a cell entity
        immediately, and to allow for multiple players on the same account;
        more documentation will be forthcoming.</p></li><li><p>PacketFilter class added to mercury. Can be attached to a
        Channel and has an opportunity to modify all incoming and outgoing
        packets; this is intended to be used to support packet encryption. To
        implement on the server side, add a file that links to lcproxymgr and
        implements the BaseProxyPacketFilter class's doCreate method, and
        creates a static instance of it. A template ProxyPacketFilter&lt;&gt;
        is provided for the case where no parameters need to be passed to the
        underlying PacketFilter instance.</p></li><li><p>Server initiated resource updating via the new "Updater"
        component is now supported on login.</p></li><li><p>Machined can now start and stop all server processes.See
        bigworld/src/server/tools/pycommon/bwstart for a simple script that
        can start server components on any machine running machined. Machined
        can also be run as a non-root user now, although in this configuration
        it does not support spawning processes under a different uid.</p></li><li><p>Logger can now display hostnames in its output, and better
        handle multiple line messages.</p></li><li><p>Entities can now detect when they have their cell part created
        on the base via the onGetCell notification method.</p></li><li><p>A bounding rectangle corresponding to the size of a space has
        been added to Space Viewer, as well as displays showing player
        entities AoI, and the currently loaded chunks.</p></li><li><p>Added the calcmd5 program to calculate the md5 hash of a
        file.</p></li><li><p>Added an attribute "component" to the BigWorld module on all
        components, to be the name of the component that the script is running
        on: client, cell, or base.</p></li><li><p>Can work around firewalls that reassign outgoing port
        numbers.</p></li><li><p>Can have lcproxymgr bind to a specific interfaces for both the
        internal and external interfaces, and bind its external interface to
        an fixed port.</p></li><li><p>Added an entity extra and controller example, egextra.</p></li><li><p>Added a mini-scripted client example, egclient4.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9146"></a>2.&nbsp;Changed Features</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Added a closeEnough parameter to Entity.navigate method on the
        cell, to help cut short navigation.</p></li><li><p>Changed isDead Python property on base to isDestroyed to better
        reflect its usage.</p></li><li><p>REAL_TYPE_SIMPLE is deprecated - to simulate the functionality,
        use REAL_TYPE_WITH_BASE without instantiating the base entity.</p></li><li><p>Qmeminfo was removed as it is no longer required.</p></li><li><p>The eload tool now instantiates entities on the base, and can
        read entities from .chunk files. It is no longer compatible with .mfo
        files.</p></li><li><p>The runscript tool can now run scripts on either the cell or the
        base. It can also run a single script on all bases.</p></li><li><p>Mload has been removed as the functionality in runscript is
        superior.</p></li><li><p>BWMachined now detects the default broadcast route
        interface.</p></li><li><p>Server components query BWMachined for the internal interface
        when none is specified in bw.xml</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9177"></a>3.&nbsp;Bug Fixes</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Multiple logins and disconnects are now much more robust.</p></li><li><p>Server crash when passing None as the fifth argument of
        BigWorld.createEntity on the cell is gone.</p></li><li><p>Manual cell deletion is much less intensive on server cluster
        resources.</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9190"></a>4.&nbsp;Known Issues</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>SCCAM start single machine server option is currently
        broken.</p></li><li><p>Cell process dieing can occasionally cause a neighbouring cell
        to also be removed.</p></li></ul></div></div></div></div></div></body></html>