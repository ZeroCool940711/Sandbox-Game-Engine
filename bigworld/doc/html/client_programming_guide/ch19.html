<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>Chapter&nbsp;19.&nbsp;Input Method Editors (IME)</title>
      <link rel="stylesheet" type="text/css" href="../css/bigworld.css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.76.1">
      <link rel="home" href="index.html" title="Client Programming Guide">
      <link rel="up" href="index.html" title="Client Programming Guide">
      <link rel="prev" href="ch18.html" title="Chapter&nbsp;18.&nbsp;Fonts">
      <link rel="next" href="ch20.html" title="Chapter&nbsp;20.&nbsp;BigWorld Web Integration">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div id="bigworld-header"><img src="http://try.bigworldtech.com/bigworld/image.php?img=bigworld_logo.gif&amp;svn=$HeadURL: http://patchsvn/svn/evaluation/official/IndiePackage/2.1/current/bigworld/doc/html/client_programming_guide/ch19.html $" alt="bw logo"></div>
      <div id="content">
         <div class="navheader">
            <table width="95%" align="center" summary="Navigation header">
               <tr>
                  <th colspan="3" align="center">Chapter&nbsp;19.&nbsp;Input Method Editors (IME)</th>
               </tr>
               <tr>
                  <td width="20%" align="left"><a accesskey="p" href="ch18.html">Prev</a>&nbsp;
                  </td>
                  <th width="55%" align="center">&nbsp;</th>
                  <td width="20%" align="right">&nbsp;<a accesskey="n" href="ch20.html">Next</a></td>
               </tr>
            </table>
            <hr class="navheaderline">
         </div>
         <div class="chapter" title="Chapter&nbsp;19.&nbsp;Input Method Editors (IME)">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="xref_IME"></a>Chapter&nbsp;19.&nbsp;Input Method Editors (IME)
                     </h2>
                  </div>
               </div>
            </div>
            <div class="toc">
               <p><b>Table of Contents</b></p>
               <dl>
                  <dt><span class="section"><a href="ch19.html#d0e8282">19.1. Components of an IME interface</a></span></dt>
                  <dd>
                     <dl>
                        <dt><span class="section"><a href="ch19.html#d0e8307">19.1.1. Examples</a></span></dt>
                        <dt><span class="section"><a href="ch19.html#d0e8324">19.1.2. Recommended Reading</a></span></dt>
                     </dl>
                  </dd>
                  <dt><span class="section"><a href="ch19.html#d0e8337">19.2. IME Python API</a></span></dt>
                  <dd>
                     <dl>
                        <dt><span class="section"><a href="ch19.html#d0e8350">19.2.1. Enabling IME</a></span></dt>
                        <dt><span class="section"><a href="ch19.html#d0e8365">19.2.2. Receiving IME events</a></span></dt>
                        <dt><span class="section"><a href="ch19.html#d0e8442">19.2.3. Displaying the IME</a></span></dt>
                     </dl>
                  </dd>
               </dl>
            </div>
            <p>An Input Method Editor (IME) is an advanced user interface which is
                 used to enter input text for East Asian such as Chinese where the character
                 set is much larger than can be practically mapped directly to keyboard
                 buttons. This is a mechanism provided by Windows and is determined by the
                 currently installed keyboard layout.
            </p>
            <p>Unfortunately the default IME interfaces used by Windows overlay
                 additional child pop-up windows which do not work well within the context of
                 a game. These pop-ups will conflict with the Direct3D device (especially in
                 full-screen mode), are not skinnable, and, since Windows has no knowledge
                 about your in-game user interface, it will not be positioned to line up with
                 your in-game edit controls. Thus in order to integrate nicely with a game
                 and deliver a smooth experience for the user, the IME interface should be
                 rendered using the in-game GUI system.
            </p>
            <p>The BigWorld engine provides an API which allows the Python scripts to
                 respond to IME events generated by the operating system and populate an
                 in-game IME based on the current state of the system input driver.
            </p>
            <p>The currently supported IME types are: </p>
            <div class="itemizedlist">
               <ul class="itemizedlist" type="disc">
                  <li class="listitem">
                     <p>Chinese Simplified (PRC)</p>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="circle">
                           <li class="listitem">
                              <p>Microsoft Pinyin</p>
                           </li>
                           <li class="listitem">
                              <p>QuanPin</p>
                           </li>
                           <li class="listitem">
                              <p>Sogou Pinyin</p>
                           </li>
                           <li class="listitem">
                              <p>Sogou Wubi</p>
                           </li>
                           <li class="listitem">
                              <p>Google Pinyin</p>
                           </li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <p>Chinese Traditional (Taiwan)</p>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="circle">
                           <li class="listitem">
                              <p>Microsoft New Phonetic IME</p>
                           </li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <p>Japanese</p>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="circle">
                           <li class="listitem">
                              <p>Microsoft IME</p>
                           </li>
                        </ul>
                     </div>
                  </li>
                  <li class="listitem">
                     <p>Korean</p>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="circle">
                           <li class="listitem">
                              <p>Microsoft IME</p>
                           </li>
                        </ul>
                     </div>
                  </li>
               </ul>
            </div>
            <p>This chapter describes how to setup Python scripts to respond to IME
                 events and display an interface accordingly.
            </p>
            <p>In addition to this document, there is an example implementation
                 located at
                 <code class="filename">fantasydemo/res/scripts/client/Helpers/PyGUI/IME.py</code>.
                 This script is used by the <code class="code">PyGUI.EditField</code> class.
            </p>
            <p>Please note that the BigWorld IME system will be disabled if the
                 Scaleform IME library is enabled.
            </p>
            <div class="section" title="19.1.&nbsp;Components of an IME interface">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="d0e8282"></a>19.1.&nbsp;Components of an IME interface
                        </h2>
                     </div>
                  </div>
               </div>
               <p>There are three main components that make up an Input Method
                      Editor:
               </p>
               <div class="itemizedlist">
                  <ul class="itemizedlist" type="disc">
                     <li class="listitem">
                        <p>Composition string. This contains the characters that the user
                                   has composed with the IME and is the string that will be sent to the
                                   application once it has been finalised by the user. The composition
                                   string is usually drawn on top of the edit control at the current
                                   location of the input cursor.
                        </p>
                     </li>
                     <li class="listitem">
                        <p>Reading window. Typically used only by Chinese IME's, this
                                   contains the most recent keystrokes which have not yet been translated
                                   to the target language.
                        </p>
                     </li>
                     <li class="listitem">
                        <p>Candidate list. This is a list of candidate characters based on
                                   the current contents of the composition string. The user can use the
                                   arrow keys to cycle through the available options and can use page-up
                                   and page-down if there are multiple pages of options. The desired
                                   candidate is selected by pressing the number key corresponding to the
                                   candidate list item, or by pressing enter on the highlighted
                                   item.
                        </p>
                     </li>
                  </ul>
               </div>
               <p>A particular IME may use all or only some of these components. The
                      <code class="code">PyIME</code> object is used by the Python scripts to determine when
                      a particular component needs to be drawn (e.g. the
                      <code class="code">BigWorld.ime.readingVisible</code> flag can be used to determine
                      whether or not the reading window should be drawn at any particular
                      time).
               </p>
               <p>While not strictly part of the IME itself, including a language
                      indicator on your edit control is useful as a visual aid to keep track of
                      which language is currently active. By changing its colour, you can also
                      indicate the current state of the IME (e.g. whether or not the IME is
                      currently in alpha-numeric mode).
               </p>
               <div class="section" title="19.1.1.&nbsp;Examples">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8307"></a>19.1.1.&nbsp;Examples
                           </h3>
                        </div>
                     </div>
                  </div>
                  <div class="informalfigure">
                     <div class="mediaobject"><img src="images/ime_japanese.png"><span class="caption">
                           <p>Japanese IME</p></span></div>
                  </div>
                  <div class="informalfigure">
                     <div class="mediaobject"><img src="images/ime_chinese.png"><span class="caption">
                           <p>Chinese IME</p></span></div>
                  </div>
               </div>
               <div class="section" title="19.1.2.&nbsp;Recommended Reading">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8324"></a>19.1.2.&nbsp;Recommended Reading
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>[<span class="citation">Installing and Using Input Method Editors, MSDN - <a class="ulink" href="http://msdn.microsoft.com/en-us/library/bb174599%28VS.85%29.aspx" target="_top">http://msdn.microsoft.com/en-us/library/bb174599%28VS.85%29.aspx</a></span>]
                  </p>
                  <p>[<span class="citation">Using an Input Method Editor in a Game, MSDN - <a class="ulink" href="http://msdn.microsoft.com/en-us/library/bb206300%28VS.85%29.aspx" target="_top">http://msdn.microsoft.com/en-us/library/bb206300%28VS.85%29.aspx</a></span>]
                  </p>
               </div>
            </div>
            <div class="section" title="19.2.&nbsp;IME Python API">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="d0e8337"></a>19.2.&nbsp;IME Python API
                        </h2>
                     </div>
                  </div>
               </div>
               <p>The BigWorld IME Python API is accessed via the
                      <code class="code">BigWorld.ime</code> object. This is a singleton instance of the
                      <code class="code">PyIME</code> class.
               </p>
               <p>See the Python client API documentation for details on all methods
                      and properties mentioned here.
               </p>
               <div class="section" title="19.2.1.&nbsp;Enabling IME">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8350"></a>19.2.1.&nbsp;Enabling IME
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Disabled by default, IME can be enabled and disabled from the
                           Python script. Typically, an application would enable IME when a
                           text-input interface comes into focus (e.g. an edit box), and disable it
                           again once it has lost focus. The <code class="code">enabled</code> property on the
                           <code class="code">PyIME</code> object controls the current state:
                  </p><pre class="programlisting">BigWorld.ime.enabled = enableBoolean</pre><p>The internal state will be reset when IME is disabled.</p>
               </div>
               <div class="section" title="19.2.2.&nbsp;Receiving IME events">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8365"></a>19.2.2.&nbsp;Receiving IME events
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Once the IME system is enabled, the engine will start posting
                           events to the personality script.
                  </p>
                  <div class="section" title="19.2.2.1.&nbsp;BWPersonality.handleInputLangChangeEvent">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="d0e8370"></a>19.2.2.1.&nbsp;BWPersonality.handleInputLangChangeEvent
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>The <code class="code">BWPersonality.handleInputLangChangeEvent</code> will
                                be called whenever the user has switched the current input language.
                                The function does not take any parameters, so the handler should check
                                the <code class="code">BigWorld.ime.language</code> property and the
                                <code class="code">BigWorld.localeInfo</code> function to check the new language
                                and update accordingly.
                     </p>
                     <p>Typically, an application would update language indicators
                                and/or fonts based on the new language.
                     </p>
                  </div>
                  <div class="section" title="19.2.2.2.&nbsp;BWPersonality.handleIMEEvent">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="d0e8386"></a>19.2.2.2.&nbsp;BWPersonality.handleIMEEvent
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>The <code class="code">BWPersonality.handleIMEEvent</code> gets called
                                whenever the user performs some action (usually a keystroke) that
                                causes the internal IME state to be changed. The only parameter to the
                                <code class="code">handleIMEEvent</code> is a <code class="code">PyIMEEvent</code> object. The
                                event object itself does not have any data, rather it has a set of
                                flags which indicate which <code class="code">BigWorld.ime</code> properties have
                                been updated. The <code class="code">handleIMEEvent</code> function will be called
                                when the following events occur:
                     </p>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              <p>The current IME state has been changed (e.g. switching
                                             between alpha-numeric mode and Hiragana mode whilst in the
                                             Japanese language).
                              </p>
                           </li>
                           <li class="listitem">
                              <p>The composition string has been modified.</p>
                           </li>
                           <li class="listitem">
                              <p>The cursor position within the composition string has been
                                             modified.
                              </p>
                           </li>
                           <li class="listitem">
                              <p>The reading window string has changed.</p>
                           </li>
                           <li class="listitem">
                              <p>The reading window visibility has changed.</p>
                           </li>
                           <li class="listitem">
                              <p>The candidate list visibility has changed.</p>
                           </li>
                           <li class="listitem">
                              <p>The candidate list items have changed.</p>
                           </li>
                           <li class="listitem">
                              <p>The user has changed the highlighted item within the
                                             candidate list.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="section" title="19.2.2.3.&nbsp;Finalising characters">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="d0e8431"></a>19.2.2.3.&nbsp;Finalising characters
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>When the user has finished entering their desired text into the
                                method editor they will press enter to commit the string. When this
                                occurs, <code class="code">BWPersonality.handleKeyEvent</code> will be called for
                                each unicode character in the finalised string, and will be posted
                                with the key code <code class="code">Keys.KEY_IME_CHAR</code>.
                     </p>
                  </div>
               </div>
               <div class="section" title="19.2.3.&nbsp;Displaying the IME">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8442"></a>19.2.3.&nbsp;Displaying the IME
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The task of actually displaying the IME interface based on the
                           current underlying state is a task for the Python script programmer. The
                           complexity of the IME presentation scripts will be determined by how
                           many languages need to be supported, as each language has their own
                           standard way of presenting the IME.
                  </p>
                  <p>Note that due to the number of different IME's available for a
                           single language, and due to differences between Windows XP and Windows
                           Vista, it is recommended to test across these different configurations
                           as much as possible.
                  </p>
                  <p>Generally, when constructing an IME interface, the scripts will do
                           the following:
                  </p>
                  <div class="itemizedlist">
                     <ul class="itemizedlist" type="disc">
                        <li class="listitem">
                           <p>Build a composition string window based on the contents of
                                        <code class="code">BigWorld.ime.composition</code>. Each character in the
                                        composition string will have a different attribute associated with
                                        it which determine its state (e.g. whether or not it is
                                        highlighted). This is determined by the
                                        <code class="code">BigWorld.ime.compositionAttr</code> property (an array of the
                                        same length as the composition string).
                           </p>
                           <p>A cursor should be drawn within the composition string based
                                        on the <code class="code">BigWorld.ime.compositionCursorPosition</code>
                                        attribute.
                           </p>
                        </li>
                        <li class="listitem">
                           <p>If <code class="code">BigWorld.ime.readingVisible</code> is True, build a
                                        reading window based on the contents of
                                        <code class="code">BigWorld.ime.reading</code>.
                           </p>
                           <p>The orientation of the reading window is determined by the
                                        <code class="code">BigWorld.ime.readingVertical</code> property.
                           </p>
                        </li>
                        <li class="listitem">
                           <p>If <code class="code">BigWorld.ime.candidatesVisible</code> is True, build
                                        a candidate window based on the contents of
                                        <code class="code">BigWorld.ime.candidates</code>. This is an array of candidate
                                        strings for the current page (each page has a maximum of 9 entries).
                                        The highlighted item of the composition is determined by the
                                        <code class="code">BigWorld.ime.selectedCandidate</code> property.
                           </p>
                           <p>The candidate window should be placed so it appears just under
                                        the location of the composition window cursor.
                           </p>
                           <p>The orientation of the candidate window is determined by the
                                        <code class="code">BigWorld.ime.candidatesVertical</code> property.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="section" title="19.2.3.1.&nbsp;Japanese">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="d0e8499"></a>19.2.3.1.&nbsp;Japanese
                              </h4>
                           </div>
                        </div>
                     </div>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              <p>Rather than placing the candidate window at the location of
                                             the composition string cursor, the candidate window should be
                                             placed below the first target converted character (determined via
                                             the <code class="code">compositionAttr</code> property).
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="section" title="19.2.3.2.&nbsp;Korean">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="d0e8509"></a>19.2.3.2.&nbsp;Korean
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Korean IME's require a bit more specialisation than Chinese and
                                Japanese. The main considerations for creating a Korean IME
                                are:
                     </p>
                     <div class="itemizedlist">
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              <p>The composition string is edited in-line. In other words,
                                             the composition character is directly inserted into the edit box
                                             immediately so that the character to the right of the cursor is
                                             moved across. The underlying Korean IME implements this by
                                             injecting keystrokes such as <code class="code">LEFTARROW</code>,
                                             <code class="code">RIGHTARROW</code> and <code class="code">BACKSPACE</code> into the input
                                             stream to automatically insert and remove a character into your
                                             edit box.
                              </p>
                           </li>
                           <li class="listitem">
                              <p>The composition string background blinks, itself acting as
                                             the cursor. As such,
                                             <code class="code">BigWorld.ime.compositionCursorPosition</code> can be
                                             ignored.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="navfooter">
            <hr class="navheaderline">
            <table width="95%" align="center" summary="Navigation footer">
               <tr>
                  <td width="38%" align="left"><a accesskey="p" href="ch18.html">Prev</a>&nbsp;
                  </td>
                  <td width="20%" align="center">&nbsp;</td>
                  <td width="37%" align="right">&nbsp;<a accesskey="n" href="ch20.html">Next</a></td>
               </tr>
               <tr>
                  <td width="40%" align="left" valign="top">Chapter&nbsp;18.&nbsp;Fonts&nbsp;</td>
                  <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
                  <td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;20.&nbsp;BigWorld Web Integration</td>
               </tr>
               <tr>
                  <td colspan="3">Copyright 1999-2012 BigWorld Pty. Ltd. All rights reserved. Proprietary commercial in confidence.
                     		   
                  </td>
               </tr>
            </table>
         </div>
      </div>
   </body>
</html>