<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>Chapter&nbsp;8.&nbsp;Stress Testing with Bots</title>
      <link rel="stylesheet" href="../css/bigworld.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="Server Operations Guide">
      <link rel="up" href="index.html" title="Server Operations Guide">
      <link rel="prev" href="ch07.html" title="Chapter&nbsp;7.&nbsp;Controlled Startup and Shutdown">
      <link rel="next" href="ch09.html" title="Chapter&nbsp;9.&nbsp;Security"><script type="text/javascript" src="../css/bigworld.js"></script></head>
   <body onLoad="loader();">
      <div id="bigworld-header"><img src="bigworld_logo.gif" id="bwLogo" alt="bw logo"></div>
      <div id="content">
         <div class="navheader">
            <table width="95%" align="center" summary="Navigation header">
               <tr>
                  <th colspan="3" align="center">Chapter&nbsp;8.&nbsp;Stress Testing with Bots</th>
               </tr>
               <tr>
                  <td width="20%" align="left"><a accesskey="p" href="ch07.html">Prev</a>&nbsp;
                  </td>
                  <th width="55%" align="center">&nbsp;</th>
                  <td width="20%" align="right">&nbsp;<a accesskey="n" href="ch09.html">Next</a></td>
               </tr>
            </table>
            <hr class="navheaderline">
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="xref_Stress_Testing_With_Bots"></a>Chapter&nbsp;8.&nbsp;Stress Testing with Bots
                     </h2>
                  </div>
               </div>
            </div>
            <div class="toc">
               <p><b>Table of Contents</b></p>
               <dl>
                  <dt><span class="sect1"><a href="ch08.html#d0e9535">8.1. The Login Process</a></span></dt>
                  <dt><span class="sect1"><a href="ch08.html#d0e9654">8.2. Watcher Interface</a></span></dt>
                  <dt><span class="sect1"><a href="ch08.html#d0e9780">8.3. Python Interface</a></span></dt>
                  <dd>
                     <dl>
                        <dt><span class="sect2"><a href="ch08.html#d0e9792">8.3.1. Python Controller (<span class="literal">bot_op.py</span>)</a></span></dt>
                        <dt><span class="sect2"><a href="ch08.html#d0e9898">8.3.2. Methods and Attributes</a></span></dt>
                     </dl>
                  </dd>
                  <dt><span class="sect1"><a href="ch08.html#xref_Controlling_Movement">8.4. Controlling Movement</a></span></dt>
                  <dd>
                     <dl>
                        <dt><span class="sect2"><a href="ch08.html#xref_NodeProperties_Section">8.4.1. NodeProperties Section</a></span></dt>
                     </dl>
                  </dd>
                  <dt><span class="sect1"><a href="ch08.html#d0e10417">8.5. Extending Bots</a></span></dt>
                  <dd>
                     <dl>
                        <dt><span class="sect2"><a href="ch08.html#d0e10420">8.5.1. Creating New Movement Controllers</a></span></dt>
                     </dl>
                  </dd>
               </dl>
            </div>
            <p>The Bots application is a process that can command arbitrary numbers
                 of simulated clients to log into the server and perform activities. It is
                 written in C++, but controlled through Python, like the BigWorld
                 Client.
            </p>
            <div class="sect1" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="d0e9535"></a>8.1.&nbsp;The Login Process
                        </h2>
                     </div>
                  </div>
               </div>
               <p>The bots are designed to log in a server just like a real client. By
                      default, the Bots process locates a LoginApp by broadcasting a message
                      requesting all LoginApps to respond, and then using the first one to
                      reply. This is the simplest method to log in if there is only one instance
                      of a BigWorld server running.
               </p>
               <p>The script is located in folder
                      <span class="literal">bigworld/bin/$MF_CONFIG</span>, and has the following
                      syntax:
               </p><pre class="programlisting">bots [-serverName &lt;srv&gt; [-port &lt;port&gt;]]
     [-username &lt;user&gt; [-password &lt;pwd&gt;] [-randomName]] [-scripts]</pre><p>The options for invoking bots are described in the list
                      below:
               </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><em class="emphasis"><span class="literal">-serverName
                                         <em class="replaceable"><code>&lt;srv&gt;</code></em></span></em></p>
                        <p>Server that the bot clients will login to (overrides the
                                   auto-locate method).
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">-port
                                         <em class="replaceable"><code>&lt;port&gt;</code></em></span></em></p>
                        <p>Login port. Ignored if Bots is using auto-locate method.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">-username
                                         <em class="replaceable"><code>&lt;user&gt;</code></em></span></em></p>
                        <p>Username that the bot clients will log in as.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">-password
                                         <em class="replaceable"><code>&lt;pwd&gt;</code></em></span></em></p>
                        <p>Password for bot clients' login.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">-randomName</span></em></p>
                        <p>Randomises the login name based on the specified
                                   &lt;username&gt;.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">-scripts</span></em></p>
                        <p>Enables Bots to run scripts. This has a considerable performance
                                   cost.
                        </p>
                     </li>
                  </ul>
               </div>
               <p>The auto-locate procedure can be overridden by specifying the option
                      <span class="literal">-serverName
                         <em class="replaceable"><code>&lt;serverName&gt;</code></em></span> on the command
                      line. If both methods fail, then the Bots process requests the server name
                      on stdin (if attached to a terminal). If all these methods fail, then the
                      process starts, but cannot create new bots until the server is set (via
                      the Python method <span class="literal">setDefaultServer</span>).
               </p>
               <p>If the option <span class="literal">-scripts</span> is specified then Bots
                      looks for the entity definition files under folder
                      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/entity_defs</span>,
                      and for scripts under folder
                      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/bot</span>.
               </p>
               <p>Specific scripts can be created for Bots, but if a client script
                      does not reference the client's C++ modules, then it can be reused. Note
                      that the bots process does not support the BigWorld Client APIs, since it
                      is intended to be lightweight.
               </p>
               <p>In many operation scenarios the entity definition file for Bots
                      could be either missing or different from the definition files for the
                      server. The Bots would use an incorrect message digest for login; and
                      hence the login will fail because LoginApp relies on the digest for
                      verifying entity definition consistency. Previously, only way around this
                      problem is turn the digest checking on the server off in
                      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>'s
                      <span class="literal">dbMgr</span> options section (for details check
                      <span class="literal">allowEmptyDigest</span> option in <a href="ch02.html#xref_DBMgr_Configuration_Options" title="2.12.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>. This option can also be
                      changed on the fly via a watcher, using WebConsole's ClusterControl
                      module; see <a href="ch03.html#xref_ClusterControl" title="3.1.1.1.&nbsp;ClusterControl">ClusterControl</a>). However, this is not
                      a viable option, if you want to use Bots on production servers. You can
                      now set custom MD5 digest in the
                      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>'s
                      <span class="literal">bots</span> section under option loginMD5Digest. This option
                      can also be modified on the fly through WebConsole.
               </p>
               <p>Bots can now realistically simulate general Internet networking
                      environment by introduce artificial packet loss, network delays, sudden
                      disconnections and frequent relogins. All this simulation can be
                      programmed with Bots' personality script.
               </p>
            </div>
            <div class="sect1" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="d0e9654"></a>8.2.&nbsp;Watcher Interface
                        </h2>
                     </div>
                  </div>
               </div>
               <p>It is possible to control Bots using WebConsole's <em class="emphasis">ClusterControl</em> module (for details, see <a href="ch03.html#xref_WebConsole" title="3.1.&nbsp;WebConsole">WebConsole</a>).
               </p>
               <p>The list below describes the watchers exposed by Bots:</p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><em class="emphasis"><span class="literal">command/addBots</span></em> (Data type &#8212;
                                   <span class="literal">int</span>, Access &#8212; Write only)
                        </p>
                        <p>Adds to the system the specified number of bots.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">command/delBots</span></em> (Data type &#8212;
                                   <span class="literal">int</span>, Access &#8212; Write only)
                        </p>
                        <p>Deletes from the system the specified number of bots.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">command/updateMovement</span></em> (Data
                                   type &#8212; <span class="literal">string</span>, Access &#8212; Write only)
                        </p>
                        <p>Updates the movement controllers of all bots matching the input
                                   tag, based on the current default values. If the input tag is empty,
                                   all bots are changed.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">defaultControllerData</span></em> (Data
                                   type &#8212; <span class="literal">string</span>, Access &#8212; Read/Write)
                        </p>
                        <p>The argument string that default movement controllers are to be
                                   constructed with.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">defaultControllerType</span></em></p>
                        <p>The name of the movement controller for the bots, if that is not
                                   specified individually.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis">defaultStandinEntity</em></p>
                        <p>Default entity script to be used when a specific Entity type
                                   does not have its corresponding game script.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis">loginMD5Digest</em></p>
                        <p>32 character long MD5 digest string (in hex readable form) for
                                   server login.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">delTaggedEntities</span></em> (Data type
                                   &#8212; <span class="literal">string</span>, Access &#8212; Write only)
                        </p>
                        <p>Deletes all bots matching the input tag.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">numBots</span></em>
                                   (Data type &#8212; <span class="literal">int</span>, Access &#8212; Read only)
                        </p>
                        <p>Number of bots being controlled by this process.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">pythonServerPort</span></em> (Data type
                                   &#8212; <span class="literal">int</span>, Access &#8212; Read only)
                        </p>
                        <p>The telnet port the process is listening on (if it was available
                                   when the application started).
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">tag</span></em> (Data
                                   type &#8212; <span class="literal">string</span>, Access &#8212; Read/Write)
                        </p>
                        <p>The current tag.</p>
                     </li>
                  </ul>
               </div>
               <p>Note the unusual use of write-only fields to perform actions. The
                      Watcher interface is rarely used, since bots are easier to control with
                      the script bigworld/tools/server/ bot_op.py, or the Python
                      interface.
               </p>
               <p>For more details on changing a watcher via WebConsole, see <a href="ch03.html#xref_ClusterControl" title="3.1.1.1.&nbsp;ClusterControl">ClusterControl</a>.
               </p>
            </div>
            <div class="sect1" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="d0e9780"></a>8.3.&nbsp;Python Interface
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Bots was designed to be controlled programmatically via Python, but
                      since Python can be used interactively, it is also a quick way to get some
                      bots into the system and control them.
               </p>
               <p>You can telnet to port 6075 to talk to the bots process, as
                      illustrated below:
               </p><pre class="programlisting">$ telnet 10.40.7.12 6075
Welcome to the Bot process
&gt;&gt;&gt; BigWorld.getDefaultServer()
10.40.7.1
&gt;&gt;&gt; BigWorld.setDefaultServer('server2')
&gt;&gt;&gt; BigWorld.setDefaultTag('red')
&gt;&gt;&gt; BigWorld.addBotsSlowly(500, 0.1)
&gt;&gt;&gt; BigWorld.setDefaultTag('blue')
&gt;&gt;&gt; BigWorld.addBotsSlowly(500, 0.1)
&gt;&gt;&gt; BigWorld.addBotsWithName( [('Bot_01', '01'), ('Bot_02', '02')] )</pre><p><span class="citetitle">Example of use of Python interface to
                         Bots</span></p>
               <div class="sect2" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e9792"></a>8.3.1.&nbsp;Python Controller (<span class="literal">bot_op.py</span>)
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>BigWorld provides a Python program to simplify the management of
                           large numbers of bots.
                  </p>
                  <p>It automatically starts bot processes as needed, load balancing
                           (based on CPU load) on all available machines not running any other
                           BigWorld components.
                  </p>
                  <p>The script is located in folder bigworld/tools/server and has the
                           following syntax:
                  </p><pre class="programlisting">python bot_op.py [add [&lt;number_of_bots&gt;]]
                 [del [&lt;number_of_bots&gt;]]
                 [movement &lt;controller_type&gt; &lt;controller_data&gt; [&lt;bot_tag&gt;]]
                 [set (&lt;watcher_name&gt; &lt;value&gt;)+]
                 [run [&lt;command&gt;]]
                 [addprocs [&lt;num_of_procs&gt;]]
                 -u [username or uid]</pre><p>The options for invoking <span class="literal">bot_op.py</span> are
                           described in the list below:
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><em class="emphasis"><span class="literal">add
                                              [<em class="replaceable"><code>&lt;number_of_bots&gt;</code></em>]</span></em></p>
                           <p>Adds the specified number of bots to the system. If
                                        &lt;number_of_bots&gt; is not specified, then one bots is
                                        added.
                           </p>
                           <p>Bots are added 16 at a time, up to a maximum of 256 per bots
                                        process.
                           </p>
                           <p>The script waits 1 second after each add, to check it a bot
                                        was effectively added. When all bots processes are full, it creates
                                        a new process on an available machine that is using less than 80%
                                        CPU (preferably one that is already running some bots
                                        processes).
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">addprocs
                                              [<em class="replaceable"><code>&lt;num_of_procs&gt;</code></em>]</span></em></p>
                           <p>Spawns the given number of bots processes on each machine that
                                        is considered eligible for running them, or 1 on each if no number
                                        is given.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">del
                                              [<em class="replaceable"><code>&lt;number_of_bots&gt;</code></em>]</span></em></p>
                           <p>Deletes the specified number of bots from the system. If
                                        &lt;number_of_bots&gt; is not specified, then it defaults to 1. The
                                        number of bots will be ceiling clamped to the actual number of bots
                                        on the server.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">movement
                                              <em class="replaceable"><code>&lt;controller_type&gt;</code></em>
                                              <em class="replaceable"><code>&lt;controller_data&gt;</code></em>
                                              [<em class="replaceable"><code>&lt;bot_tag&gt;</code></em>]</span></em></p>
                           <p>Changes the bot's movement controller. If option
                                        &lt;bot_tag&gt; is specified, then only bots matching it will be
                                        changed. Otherwise, all bots will be changed.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">set
                                              (<em class="replaceable"><code>&lt;watcher_name&gt;</code></em>
                                              <em class="replaceable"><code>&lt;value&gt;</code></em>)+</span></em></p>
                           <p>Sets the watcher to specified value on all bot
                                        applications.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">run
                                              [<em class="replaceable"><code>&lt;command&gt;</code></em>]</span></em></p>
                           <p>Runs the specified Python command on all bots. If
                                        &lt;command&gt; is not specified, then it is read from stdin.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">-u
                                              [<em class="replaceable"><code>username</code></em>|<em class="replaceable"><code>uid</code></em>]</span></em></p>
                           <p>Manually specify the UID of the server that the script will
                                        take action on.
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect2" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e9898"></a>8.3.2.&nbsp;Methods and Attributes
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The list below describes the bots' attributes and methods on
                           ClientApp and BigWorld:
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><em class="emphasis">ClientApp Attributes</em></p>
                           <div class="itemizedlist">
                              <ul type="circle">
                                 <li>
                                    <p><em class="emphasis"><span class="literal">id</span>
                                                        (<span class="literal">int</span>)</em> &#8212; Bot ID (read-only).
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">spaceID(int)</em> &#8212; ID of the
                                                     space the bot is currently in. 0 means not in any space
                                                     (read-only).
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">loginName(string)</em> &#8212; Bot's
                                                     login name.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">loginPassword(string)</em> &#8212;
                                                     Bot's login password.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">tag</span>
                                                        (<span class="literal">string</span>)</em> &#8212; Bot's user-specified
                                                     tag. Allows the control of partial sets of bots.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">speed</span>
                                                        (<span class="literal"><span class="literal">float</span></span>)</em> &#8212; Bot's
                                                     speed.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">position</span>
                                                        (<span class="literal">Vector3</span>)</em> &#8212; Bot's position.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">yaw</span>
                                                        (<span class="literal">float</span>)</em> &#8212; Bot's yaw.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">pitch</span>
                                                        (<span class="literal">float</span>)</em> &#8212; Bot's pitch.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">roll</span>
                                                        (<span class="literal">float</span>)</em> &#8212; Bot's roll.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">isOnline(bool)</em> &#8212;
                                                     Indicates whether the bot is connected to a server
                                                     (read-only).
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">isDestroyed(bool)</em> &#8212;
                                                     Indicates whether the bot has been destroyed (read-only).
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">entities(PyObject)</em></p>
                                    <p>Dictionary-like attribute containing the list of entities
                                                     that are in the simulated client's current AOI.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li>
                           <p><em class="emphasis">ClientApp Methods</em></p>
                           <div class="itemizedlist">
                              <ul type="circle">
                                 <li>
                                    <p><em class="emphasis">logOn()</em></p>
                                    <p>Initiate log on process for the simulated client to
                                                     connect to a BW server.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">logOff()</em></p>
                                    <p>Make a simulate client disconnect from server gracefully.
                                                     If the simulated client is not online, it will do
                                                     nothing.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">dropConnection()</em></p>
                                    <p>Make a simulate client drop the connection with the
                                                     server. If the simulated client is not online, it will do
                                                     nothing.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">setConnectionLossRatio( float
                                                        lossRatio )</em></p>
                                    <p>Set up network packet loss ratio for simulating unstable
                                                     network environment. Range between 0.0 and 1.0. 0.0 means no
                                                     packet loss. 1.0 mean 100 percent packet loss.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">setConnectionLatency( float
                                                        minLatency, float maxLatency )</em></p>
                                    <p>Set up simulated network data latency (in
                                                     milliseconds).
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">moveTo( Math.Vector3 position
                                                        )</em></p>
                                    <p>Set next destination position for the player avatar of the
                                                     simulated client.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">snapTo( Math.Vector3 position
                                                        )</em></p>
                                    <p>Set the player avatar position for the simulated
                                                     client.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">stop()</em></p>
                                    <p>Stop the player avatar of the simulated client
                                                     moving.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">faceTowards( Math.Vector3 direction
                                                        )</em></p>
                                    <p>Set the direction of avatar of the simulated
                                                     client.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">addTimer()</em></p>
                                    <p>Add a timer for the bot client. This function returns an
                                                     integer timer id; otherwise it returns -1.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">delTimer( int timerID
                                                        )</em></p>
                                    <p>deletes an active timer corresponding the timerID.</p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">onTick()</em></p>
                                    <p>This optional function is invoked every game tick, should
                                                     it be defined in the player Avatar script.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li>
                           <p><em class="emphasis">BigWorld Attrbutes</em></p>
                           <div class="itemizedlist">
                              <ul type="circle">
                                 <li>
                                    <p><em class="emphasis"><span class="literal">bots</span></em></p>
                                    <p>Dictionary-like attribute containing the list of simulated
                                                     clients. The key is the player's ID, and value is an instance of
                                                     ClientApp.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">bots
                                                           [<em class="replaceable"><code>&lt;player_id&gt;</code></em>].
                                                           entities</span></em></p>
                                    <p>Dictionary-like attribute containing the list of entities
                                                     created under the simulated client specified by
                                                     <span class="literal"><em class="replaceable"><code>&lt;player_id&gt;</code></em></span>.
                                                     The key is the entity's ID, and the value is the reference to
                                                     the entity.
                                    </p>
                                    <p>In non-script bots, only the player entity is created and
                                                     stored in this attribute.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis"><span class="literal">bots
                                                           [<em class="replaceable"><code>&lt;player_id&gt;</code></em>].entities[<em class="replaceable"><code>&lt;ent_id&gt;</code></em>].clientApp</span></em></p>
                                    <p>Attribute referring to the ClientApp that owns the entity.
                                                     An entity can access its owner ClientApp via this attribute.
                                                     <span class="literal">BigWorld.bots[<em class="replaceable"><code>&lt;player_id&gt;</code></em>].entities[<em class="replaceable"><code>&lt;ent_id&gt;</code></em>].clientApp</span>
                                                     equals to
                                                     <span class="literal">BigWorld.bots[<em class="replaceable"><code>&lt;player_id&gt;</code></em>]</span>.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li>
                           <p><em class="emphasis">BigWorld Methods</em></p>
                           <div class="itemizedlist">
                              <ul type="circle">
                                 <li>
                                    <p><em class="emphasis">setMovementController(string type,
                                                        string data)</em> &#8212; Context: ClientApp
                                    </p>
                                    <p>Sets a new movement controller for the bot. On failure,
                                                     the controller is left unchanged. Returns
                                                     <span class="literal">true</span> on success, <span class="literal">false</span> on
                                                     failure.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">setLoginMD5Digest(string
                                                        MD5Digest)</em> &#8212; Context: BigWorld
                                    </p>
                                    <p>Set the 32 character long MD5Digest (in hex readable form)
                                                     for server login. If the input string length is not exactly 32
                                                     character, the MD5 digest will be reset to empty.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">addBots( int numBots )</em> &#8212;
                                                     Context: BigWorld
                                    </p>
                                    <p>Immediately adds the specified number of simulated clients
                                                     to the application. If too many bots are added at once, then
                                                     some of them may time out, depending on how long it takes to log
                                                     in all of them.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">addBotsSlowly(int numBots,float
                                                        delayBetweenAdd,int groupSize=1)</em> &#8212; Context:
                                                     BigWorld
                                    </p>
                                    <p>Adds bots to the system in groups of groupSize, and add a
                                                     delay between each group. This method returns immediately,
                                                     adding the bots in the background, and is the best way to add
                                                     bots to a system.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">addBotsWithName( PyObject loginInfo
                                                        )</em></p>
                                    <p>Immediately add a set of bots with login name and login
                                                     password specified from loginInfo. The structure of the
                                                     loginInfo is a list of tuples which consist of two strings. The
                                                     first string is the login name and the second one is login
                                                     password. In the event of incorrect loginInfo, a Python
                                                     exception will be thrown.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">delBots( int numBots)</em> &#8212;
                                                     Context: BigWorld
                                    </p>
                                    <p>Deletes the specified number of simulated clients from the
                                                     application. The method onClientAppDestroy() of the personality
                                                     module is called.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">getDefaultServer()</em> &#8212;
                                                     Context: BigWorld
                                    </p>
                                    <p>Returns the server name that the bots try to log
                                                     in.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">setDefaultServer( string serverName
                                                        )</em> &#8212; Context: BigWorld
                                    </p>
                                    <p>Sets the server name that the bots try to log in.</p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">onTick()</em> &#8212; Context:
                                                     BWPersonality
                                    </p>
                                    <p>This optional function is invoked every game tick, should
                                                     it be defined in the personality module in
                                                     &lt;res&gt;/server/bw.xml.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">onLoseConnection( int playerID )
                                                        </em>&#8212; Context: BWPersonality
                                    </p>
                                    <p>If this callback function is defined in the personality
                                                     module specified in file &lt;res&gt;/server/bw.xml, it will be
                                                     invoked when a simulated client loses its connection with a
                                                     server abnormally. The personality script can decide whether the
                                                     client should be destroyed or remain dormant for later
                                                     reactivation by return True or False respectively. <em class="emphasis">NOTE</em>: if this callback is not defined,
                                                     bots that lose connection will be automatically
                                                     destroyed.
                                    </p>
                                 </li>
                                 <li>
                                    <p><em class="emphasis">onClientAppDestroy( int playerID
                                                        )</em> &#8212; Context: BWPersonality
                                    </p>
                                    <p>If defined in the personality module specified in file
                                                     &lt;res&gt;/server/bw.xml, this callback method is called for
                                                     each destroyed bot client. The argument is the ID of the deleted
                                                     player entity. A bot client may be destroyed due to either loss
                                                     of server connection or by BigWorld.delBots() method call. If a
                                                     bot client is destroyed by BigWorld.delBots() method call, it
                                                     will be disconnected from the server gracefully. We recommend
                                                     client should execute additional log off procedure in this
                                                     onClientAppDestroy callback function. An example is as
                                                     following:
                                    </p><pre class="programlisting">def onClientAppDestroyed( playerID ):
  bot = BigWorld.bots[playerID]
  if bot.isOnline:
    bot.entities[playerID].base.logOff()</pre><p>The implementation
                                                     above assumes that the player entity on the server has an
                                                     exposed base method logOff(), which will then destroy the player
                                                     cell and base entities on the server. The script must to be
                                                     placed under the script folder
                                                     <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/bot</span>.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="xref_Controlling_Movement"></a>8.4.&nbsp;Controlling Movement
                        </h2>
                     </div>
                  </div>
               </div>
               <p>The default movement controller Patrol moves the bots along a graph
                      read from a file.
               </p>
               <p>The name of the file containing the movement graph is specified in
                      file &lt;res&gt;/server/ bw.xml, on section &lt;bots&gt;, by the
                      configuration option controllerData.
               </p><pre class="programlisting">&lt;root&gt;
  ...
  &lt;bots&gt;
    &lt;controllerData&gt;  server/bots/test.bwp  &lt;/controllerData&gt;
    &lt;controllerType&gt;  Patrol                &lt;/controllerType&gt;
    &lt;password&gt;        passwd                &lt;/password&gt;
    &lt;username&gt;        Bot                   &lt;/username&gt;
    &lt;shouldLog&gt;       true                  &lt;/shouldLog&gt;
    &lt;serverName&gt;                            &lt;/serverName&gt;
    &lt;randomName&gt;      false                 &lt;/randomName&gt;
    &lt;scripts&gt;         false                 &lt;/scripts&gt;
    &lt;port&gt;            0                     &lt;/port&gt;
    &lt;publicKey&gt;       loginapp.pubkey       &lt;/publicKey&gt;
  &lt;/bots&gt;
  ...
&lt;/root&gt;</pre><p><span class="citetitle">Example file
                         <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span></span></p>
               <p>The file name might have the suffix random, in which case the start
                      position of the bot is chosen randomly from the set of node positions in
                      the graph.
               </p>
               <p>The format specification for the movement graph file is illustrated
                      below:
               </p><pre class="programlisting">&lt;controller&gt;

  &lt;nodeDefaults&gt;
    ?NodeProperties
  &lt;/nodeDefaults&gt;

  &lt;nodes&gt;
    *&lt;node&gt;
         &lt;pos&gt;   integer integer integer  &lt;/pos&gt;
        ?&lt;name&gt;  string_node_name         &lt;/name&gt;
        ?NodeProperties
        *&lt;edges&gt;
           &lt;edge&gt;  string_node_name  &lt;/edge&gt;
         &lt;/edges&gt;
     &lt;/node&gt;
  &lt;/nodes&gt;

&lt;/controller&gt;</pre><p><span class="citetitle">Grammar of movement graph files</span></p>
               <p>The list below describes the tags in the movement graph file:</p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><em class="emphasis"><span class="literal">edge</span> (section
                                      <span class="literal">nodes/node/edges</span>)</em></p>
                        <p>Name of one of the nodes that this node borders. Must be the
                                   same value specified for a name section in the file.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">edges</span> (section
                                      <span class="literal">nodes/node</span>)</em></p>
                        <p>Tag specifying all the nodes that this node borders.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">name</span> (section
                                      <span class="literal">nodes/node</span>)</em></p>
                        <p>Name used to refer to the node. If this tag is not specified for
                                   a node, then you can refer to it by an integer sequential number, with
                                   the first node having an index of zero.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">node</span> (section
                                      <span class="literal">nodes</span>)</em></p>
                        <p>Tag for section specifying a specific node in the graph.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">nodeDefaults</span></em></p>
                        <p>Tag for section specifying default values for all nodes. These
                                   values can be overridden on a per-node basis in section
                                   nodes/node.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">NodeProperties</span> (section
                                      <span class="literal">NodeDefaults</span> and
                                      <span class="literal">nodes/node</span>)</em></p>
                        <p>For details, see <a href="ch08.html#xref_NodeProperties_Section" title="8.4.1.&nbsp;NodeProperties Section">NodeProperties Section</a>.
                        </p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">nodes</span></em></p>
                        <p>Tag for section specifying all the nodes in the graph.</p>
                     </li>
                     <li>
                        <p><em class="emphasis"><span class="literal">pos</span> (section
                                      <span class="literal">nodes/node</span>)</em></p>
                        <p>XYZ position of the centre of the node. The node is the area
                                   around pos, extending for n metres around it (n being the value of
                                   NodeProperties' tag radius).
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="sect2" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="xref_NodeProperties_Section"></a>8.4.1.&nbsp;NodeProperties Section
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The format specification for the NodeProperties section is
                           illustrated below:
                  </p><pre class="programlisting">?&lt;minStay&gt;   float  &lt;/minStay&gt;
?&lt;maxStay&gt;   float  &lt;/maxStay&gt;
?&lt;radius&gt;    float  &lt;/radius&gt;
?&lt;minSpeed&gt;  float  &lt;/minSpeed&gt;
?&lt;maxSpeed&gt;  float  &lt;/maxSpeed&gt;</pre><p><span class="citetitle">Grammar of <em class="emphasis">NodeProperties</em> section</span></p>
                  <p>The list below describes the tags in the
                           <span class="literal">NodeProperties</span> section:
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><em class="emphasis"><span class="literal">maxSpeed</span></em></p>
                           <p>Maximum speed of the bot.</p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">maxStay</span></em></p>
                           <p>Maximum number of seconds that the bot should stay in the
                                        node.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">minSpeed</span></em></p>
                           <p>Minimum speed of the bot.</p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">minStay</span></em></p>
                           <p>Minimum number of seconds that the bot should stay in the
                                        node.
                           </p>
                        </li>
                        <li>
                           <p><em class="emphasis"><span class="literal">radius</span></em></p>
                           <p>Number of metres around the node's pos location to be
                                        considered as the node. When a bot is travelling between two nodes,
                                        it chooses a random point of arrival in the destination node. This
                                        way, the bots do not follow the exact same line. The point is chosen
                                        to lie within the radius of the destination node.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>An example movement graph file is displayed below:</p><pre class="programlisting">&lt;patrolGraph&gt;
  &lt;nodeDefaults&gt;
    &lt;minStay&gt;   5  &lt;/minStay&gt;
    &lt;maxStay&gt;  10  &lt;/maxStay&gt;
    &lt;radius&gt;   20  &lt;/radius&gt;
  &lt;/nodeDefaults&gt;
  &lt;nodes&gt;
    &lt;node&gt;
      &lt;name&gt;      Town1      &lt;/name&gt;
      &lt;minStay&gt;   7          &lt;/minStay&gt;
      &lt;pos&gt;       5000 0 0   &lt;/pos&gt;
      &lt;edges&gt;&lt;edge&gt;  Town2        &lt;/edge&gt;&lt;/edges&gt;
    &lt;/node&gt;
    &lt;node&gt;
      &lt;name&gt;      Town2        &lt;/name&gt;
      &lt;pos&gt;       5000 0 5000  &lt;/pos&gt;
    &lt;/node&gt;
  &lt;/nodes&gt;
&lt;/patrolGraph&gt;</pre><p><span class="citetitle">Example movement graph file</span></p>
               </div>
            </div>
            <div class="sect1" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="d0e10417"></a>8.5.&nbsp;Extending Bots
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e10420"></a>8.5.1.&nbsp;Creating New Movement Controllers
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The default movement controller is Patrol, but you might want to
                           create one that better represents the expected traffic patterns and
                           entity distributions of your game, or to stress test other aspects of
                           the system.
                  </p>
                  <p>To create a new movement Controller, derive its class from the
                           MovementController class. Also derive a class from the MovementFactory
                           class. The factory is used to parse the Controller data argument, and
                           instantiate a new movement controller, while the movement controller
                           moves the bot around.
                  </p>
                  <p>The fragments below list the relevant methods in the base
                           classes:
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><em class="emphasis">Class
                                           MovementController</em></p><pre class="programlisting">bool nextStep( float speed, float dTime, Vector3&amp; position, Direction3D&amp; direction)</pre></li>
                     </ul>
                  </div>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><em class="emphasis">Class
                                           MovementFactory</em></p><pre class="programlisting">MovementFactory(const char* name)

MovementController* create(
  const std::string&amp;  data,
  const Vector3&amp;      startPosition)</pre></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
         <div class="navfooter">
            <hr class="navheaderline">
            <table width="95%" align="center" summary="Navigation footer">
               <tr>
                  <td width="38%" align="left"><a accesskey="p" href="ch07.html">Prev</a>&nbsp;
                  </td>
                  <td width="20%" align="center">&nbsp;</td>
                  <td width="37%" align="right">&nbsp;<a accesskey="n" href="ch09.html">Next</a></td>
               </tr>
               <tr>
                  <td width="40%" align="left" valign="top">Chapter&nbsp;7.&nbsp;Controlled Startup and Shutdown&nbsp;</td>
                  <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
                  <td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;9.&nbsp;Security</td>
               </tr>
               <tr>
                  <td colspan="3">Copyright 1999-2008 BigWorld Pty. Ltd. All rights reserved. Proprietary commercial in confidence.
                     		   
                  </td>
               </tr>
            </table>
         </div>
      </div>
   </body>
</html>